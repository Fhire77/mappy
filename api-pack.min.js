!function(){var t,e,n="mappy";!function(t,e){var i=t.document,n=function(){var n,o,s,r,a=function(t,e){return new a.fn.init(t,e,n)},l=t.jQuery,h=t.$,c=/^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/,u=/\S/,d=/^\s+/,p=/\s+$/,f=/\d/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,g=/^[\],:{}\s]*$/,v=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,y=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,_=/(?:^|:|,)(?:\s*\[)+/g,b=/(webkit)[ \/]([\w.]+)/,w=/(opera)(?:.*version)?[ \/]([\w.]+)/,x=/(msie) ([\w.]+)/,T=/(mozilla)(?:.*? rv:([\w.]+))?/,S=navigator.userAgent,k=!1,L="then done fail isResolved isRejected promise".split(" "),C=Object.prototype.toString,M=Object.prototype.hasOwnProperty,A=Array.prototype.push,P=Array.prototype.slice,z=String.prototype.trim,E=Array.prototype.indexOf,N={};function D(){if(!a.isReady){try{i.documentElement.doScroll("left")}catch(t){return void setTimeout(D,1)}a.ready()}}return a.fn=a.prototype={constructor:a,init:function(t,n,o){var s,r,l,h;if(!t)return this;if(t.nodeType)return this.context=this[0]=t,this.length=1,this;if("body"===t&&!n&&i.body)return this.context=i,this[0]=i.body,this.selector="body",this.length=1,this;if("string"==typeof t){if(!(s=c.exec(t))||!s[1]&&n)return!n||n.jquery?(n||o).find(t):this.constructor(n).find(t);if(s[1])return h=(n=n instanceof a?n[0]:n)?n.ownerDocument||n:i,(l=m.exec(t))?a.isPlainObject(n)?(t=[i.createElement(l[1])],a.fn.attr.call(t,n,!0)):t=[h.createElement(l[1])]:t=((l=a.buildFragment([s[1]],[h])).cacheable?a.clone(l.fragment):l.fragment).childNodes,a.merge(this,t);if((r=i.getElementById(s[2]))&&r.parentNode){if(r.id!==s[2])return o.find(t);this.length=1,this[0]=r}return this.context=i,this.selector=t,this}return a.isFunction(t)?o.ready(t):(t.selector!==e&&(this.selector=t.selector,this.context=t.context),a.makeArray(t,this))},selector:"",jquery:"1.5.1",length:0,size:function(){return this.length},toArray:function(){return P.call(this,0)},get:function(t){return null==t?this.toArray():t<0?this[this.length+t]:this[t]},pushStack:function(t,e,i){var n=this.constructor();return a.isArray(t)?A.apply(n,t):a.merge(n,t),n.prevObject=this,n.context=this.context,"find"===e?n.selector=this.selector+(this.selector?" ":"")+i:e&&(n.selector=this.selector+"."+e+"("+i+")"),n},each:function(t,e){return a.each(this,t,e)},ready:function(t){return a.bindReady(),s.done(t),this},eq:function(t){return-1===t?this.slice(t):this.slice(t,+t+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(P.apply(this,arguments),"slice",P.call(arguments).join(","))},map:function(t){return this.pushStack(a.map(this,function(e,i){return t.call(e,i,e)}))},end:function(){return this.prevObject||this.constructor(null)},push:A,sort:[].sort,splice:[].splice},a.fn.init.prototype=a.fn,a.extend=a.fn.extend=function(){var t,i,n,o,s,r,l=arguments[0]||{},h=1,c=arguments.length,u=!1;for("boolean"==typeof l&&(u=l,l=arguments[1]||{},h=2),"object"==typeof l||a.isFunction(l)||(l={}),c===h&&(l=this,--h);h<c;h++)if(null!=(t=arguments[h]))for(i in t)n=l[i],l!==(o=t[i])&&(u&&o&&(a.isPlainObject(o)||(s=a.isArray(o)))?(s?(s=!1,r=n&&a.isArray(n)?n:[]):r=n&&a.isPlainObject(n)?n:{},l[i]=a.extend(u,r,o)):o!==e&&(l[i]=o));return l},a.extend({noConflict:function(e){return t.$=h,e&&(t.jQuery=l),a},isReady:!1,readyWait:1,ready:function(t){if(!0===t&&a.readyWait--,!a.readyWait||!0!==t&&!a.isReady){if(!i.body)return setTimeout(a.ready,1);if(a.isReady=!0,!0!==t&&--a.readyWait>0)return;s.resolveWith(i,[a]),a.fn.trigger&&a(i).trigger("ready").unbind("ready")}},bindReady:function(){if(!k){if(k=!0,"complete"===i.readyState)return setTimeout(a.ready,1);if(i.addEventListener)i.addEventListener("DOMContentLoaded",r,!1),t.addEventListener("load",a.ready,!1);else if(i.attachEvent){i.attachEvent("onreadystatechange",r),t.attachEvent("onload",a.ready);var e=!1;try{e=null==t.frameElement}catch(t){}i.documentElement.doScroll&&e&&D()}}},isFunction:function(t){return"function"===a.type(t)},isArray:Array.isArray||function(t){return"array"===a.type(t)},isWindow:function(t){return t&&"object"==typeof t&&"setInterval"in t},isNaN:function(t){return null==t||!f.test(t)||isNaN(t)},type:function(t){return null==t?String(t):N[C.call(t)]||"object"},isPlainObject:function(t){if(!t||"object"!==a.type(t)||t.nodeType||a.isWindow(t))return!1;if(t.constructor&&!M.call(t,"constructor")&&!M.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(i in t);return i===e||M.call(t,i)},isEmptyObject:function(t){for(var e in t)return!1;return!0},error:function(t){throw t},parseJSON:function(e){return"string"==typeof e&&e?(e=a.trim(e),g.test(e.replace(v,"@").replace(y,"]").replace(_,""))?t.JSON&&t.JSON.parse?t.JSON.parse(e):new Function("return "+e)():void a.error("Invalid JSON: "+e)):null},parseXML:function(e,i,n){return t.DOMParser?i=(n=new DOMParser).parseFromString(e,"text/xml"):((i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(e)),(n=i.documentElement)&&n.nodeName&&"parsererror"!==n.nodeName||a.error("Invalid XML: "+e),i},noop:function(){},globalEval:function(t){if(t&&u.test(t)){var e=i.head||i.getElementsByTagName("head")[0]||i.documentElement,n=i.createElement("script");a.support.scriptEval()?n.appendChild(i.createTextNode(t)):n.text=t,e.insertBefore(n,e.firstChild),e.removeChild(n)}},nodeName:function(t,e){return t.nodeName&&t.nodeName.toUpperCase()===e.toUpperCase()},each:function(t,i,n){var o,s=0,r=t.length,l=r===e||a.isFunction(t);if(n)if(l){for(o in t)if(!1===i.apply(t[o],n))break}else for(;s<r&&!1!==i.apply(t[s++],n););else if(l){for(o in t)if(!1===i.call(t[o],o,t[o]))break}else for(var h=t[0];s<r&&!1!==i.call(h,s,h);h=t[++s]);return t},trim:z?function(t){return null==t?"":z.call(t)}:function(t){return null==t?"":t.toString().replace(d,"").replace(p,"")},makeArray:function(t,e){var i=e||[];if(null!=t){var n=a.type(t);null==t.length||"string"===n||"function"===n||"regexp"===n||a.isWindow(t)?A.call(i,t):a.merge(i,t)}return i},inArray:function(t,e){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1},merge:function(t,i){var n=t.length,o=0;if("number"==typeof i.length)for(var s=i.length;o<s;o++)t[n++]=i[o];else for(;i[o]!==e;)t[n++]=i[o++];return t.length=n,t},grep:function(t,e,i){var n=[];i=!!i;for(var o=0,s=t.length;o<s;o++)i!==!!e(t[o],o)&&n.push(t[o]);return n},map:function(t,e,i){for(var n,o=[],s=0,r=t.length;s<r;s++)null!=(n=e(t[s],s,i))&&(o[o.length]=n);return o.concat.apply([],o)},guid:1,proxy:function(t,i,n){return 2===arguments.length&&("string"==typeof i?(t=(n=t)[i],i=e):i&&!a.isFunction(i)&&(n=i,i=e)),!i&&t&&(i=function(){return t.apply(n||this,arguments)}),t&&(i.guid=t.guid=t.guid||i.guid||a.guid++),i},access:function(t,i,n,o,s,r){var l=t.length;if("object"==typeof i){for(var h in i)a.access(t,h,i[h],o,s,n);return t}if(n!==e){o=!r&&o&&a.isFunction(n);for(var c=0;c<l;c++)s(t[c],i,o?n.call(t[c],c,s(t[c],i)):n,r);return t}return l?s(t[0],i):e},now:function(){return(new Date).getTime()},_Deferred:function(){var t,e,i,n=[],o={done:function(){if(!i){var e,s,r,l,h,c=arguments;for(t&&(h=t,t=0),e=0,s=c.length;e<s;e++)r=c[e],"array"===(l=a.type(r))?o.done.apply(o,r):"function"===l&&n.push(r);h&&o.resolveWith(h[0],h[1])}return this},resolveWith:function(o,s){if(!i&&!t&&!e){e=1;try{for(;n[0];)n.shift().apply(o,s)}catch(t){throw t}finally{t=[o,s],e=0}}return this},resolve:function(){return o.resolveWith(a.isFunction(this.promise)?this.promise():this,arguments),this},isResolved:function(){return!(!e&&!t)},cancel:function(){return i=1,n=[],this}};return o},Deferred:function(t){var e,i=a._Deferred(),n=a._Deferred();return a.extend(i,{then:function(t,e){return i.done(t).fail(e),this},fail:n.done,rejectWith:n.resolveWith,reject:n.resolve,isRejected:n.isResolved,promise:function(t){if(null==t){if(e)return e;e=t={}}for(var n=L.length;n--;)t[L[n]]=i[L[n]];return t}}),i.done(n.cancel).fail(i.cancel),delete i.cancel,t&&t.call(i,i),i},when:function(t){var e=arguments.length,i=e<=1&&t&&a.isFunction(t.promise)?t:a.Deferred(),n=i.promise();if(e>1){for(var o=P.call(arguments,0),s=e,r=function(t){return function(e){o[t]=arguments.length>1?P.call(arguments,0):e,--s||i.resolveWith(n,o)}};e--;)(t=o[e])&&a.isFunction(t.promise)?t.promise().then(r(e),i.reject):--s;s||i.resolveWith(n,o)}else i!==t&&i.resolve(t);return n},uaMatch:function(t){t=t.toLowerCase();var e=b.exec(t)||w.exec(t)||x.exec(t)||t.indexOf("compatible")<0&&T.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}},sub:function(){function t(e,i){return new t.fn.init(e,i)}a.extend(!0,t,this),t.superclass=this,t.fn=t.prototype=this(),t.fn.constructor=t,t.subclass=this.subclass,t.fn.init=function(i,n){return n&&n instanceof a&&!(n instanceof t)&&(n=t(n)),a.fn.init.call(this,i,n,e)},t.fn.init.prototype=t.fn;var e=t(i);return t},browser:{}}),s=a._Deferred(),a.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(t,e){N["[object "+e+"]"]=e.toLowerCase()}),(o=a.uaMatch(S)).browser&&(a.browser[o.browser]=!0,a.browser.version=o.version),a.browser.webkit&&(a.browser.safari=!0),E&&(a.inArray=function(t,e){return E.call(e,t)}),u.test("Â ")&&(d=/^[\s\xA0]+/,p=/[\s\xA0]+$/),n=a(i),i.addEventListener?r=function(){i.removeEventListener("DOMContentLoaded",r,!1),a.ready()}:i.attachEvent&&(r=function(){"complete"===i.readyState&&(i.detachEvent("onreadystatechange",r),a.ready())}),a}();!function(){n.support={};var e=i.createElement("div");e.style.display="none",e.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var o=e.getElementsByTagName("*"),s=e.getElementsByTagName("a")[0],r=i.createElement("select"),a=r.appendChild(i.createElement("option")),l=e.getElementsByTagName("input")[0];if(o&&o.length&&s){n.support={leadingWhitespace:3===e.firstChild.nodeType,tbody:!e.getElementsByTagName("tbody").length,htmlSerialize:!!e.getElementsByTagName("link").length,style:/red/.test(s.getAttribute("style")),hrefNormalized:"/a"===s.getAttribute("href"),opacity:/^0.55$/.test(s.style.opacity),cssFloat:!!s.style.cssFloat,checkOn:"on"===l.value,optSelected:a.selected,deleteExpando:!0,optDisabled:!1,checkClone:!1,noCloneEvent:!0,noCloneChecked:!0,boxModel:null,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableHiddenOffsets:!0},l.checked=!0,n.support.noCloneChecked=l.cloneNode(!0).checked,r.disabled=!0,n.support.optDisabled=!a.disabled;var h=null;n.support.scriptEval=function(){if(null===h){var e=i.documentElement,o=i.createElement("script"),s="script"+n.now();try{o.appendChild(i.createTextNode("window."+s+"=1;"))}catch(t){}e.insertBefore(o,e.firstChild),t[s]?(h=!0,delete t[s]):h=!1,e.removeChild(o),e=o=s=null}return h};try{delete e.test}catch(t){n.support.deleteExpando=!1}!e.addEventListener&&e.attachEvent&&e.fireEvent&&(e.attachEvent("onclick",function t(){n.support.noCloneEvent=!1,e.detachEvent("onclick",t)}),e.cloneNode(!0).fireEvent("onclick")),(e=i.createElement("div")).innerHTML="<input type='radio' name='radiotest' checked='checked'/>";var c=i.createDocumentFragment();c.appendChild(e.firstChild),n.support.checkClone=c.cloneNode(!0).cloneNode(!0).lastChild.checked,n(function(){var t=i.createElement("div"),e=i.getElementsByTagName("body")[0];if(e){t.style.width=t.style.paddingLeft="1px",e.appendChild(t),n.boxModel=n.support.boxModel=2===t.offsetWidth,"zoom"in t.style&&(t.style.display="inline",t.style.zoom=1,n.support.inlineBlockNeedsLayout=2===t.offsetWidth,t.style.display="",t.innerHTML="<div style='width:4px;'></div>",n.support.shrinkWrapBlocks=2!==t.offsetWidth),t.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>";var o=t.getElementsByTagName("td");n.support.reliableHiddenOffsets=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",n.support.reliableHiddenOffsets=n.support.reliableHiddenOffsets&&0===o[0].offsetHeight,t.innerHTML="",e.removeChild(t).style.display="none",t=o=null}});var u=function(t){var e=i.createElement("div");if(t="on"+t,!e.attachEvent)return!0;var n=t in e;return n||(e.setAttribute(t,"return;"),n="function"==typeof e[t]),e=null,n};n.support.submitBubbles=u("submit"),n.support.changeBubbles=u("change"),e=o=s=null}}();var o=/^(?:\{.*\}|\[.*\])$/;function s(t,i,s){if(s===e&&1===t.nodeType)if("string"==typeof(s=t.getAttribute("data-"+i))){try{s="true"===s||"false"!==s&&("null"===s?null:n.isNaN(s)?o.test(s)?n.parseJSON(s):s:parseFloat(s))}catch(t){}n.data(t,i,s)}else s=e;return s}function r(t){for(var e in t)if("toJSON"!==e)return!1;return!0}n.extend({cache:{},uuid:0,expando:"jQuery"+(n.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(t){return!!(t=t.nodeType?n.cache[t[n.expando]]:t[n.expando])&&!r(t)},data:function(t,i,o,s){if(n.acceptData(t)){var r,a=n.expando,l="string"==typeof i,h=t.nodeType,c=h?n.cache:t,u=h?t[n.expando]:t[n.expando]&&n.expando;if(u&&(!s||!u||c[u][a])||!l||o!==e)return u||(h?t[n.expando]=u=++n.uuid:u=n.expando),c[u]||(c[u]={},h||(c[u].toJSON=n.noop)),"object"!=typeof i&&"function"!=typeof i||(s?c[u][a]=n.extend(c[u][a],i):c[u]=n.extend(c[u],i)),r=c[u],s&&(r[a]||(r[a]={}),r=r[a]),o!==e&&(r[i]=o),"events"!==i||r[i]?l?r[i]:r:r[a]&&r[a].events}},removeData:function(e,i,o){if(n.acceptData(e)){var s=n.expando,a=e.nodeType,l=a?n.cache:e,h=a?e[n.expando]:n.expando;if(l[h]){if(i){var c=o?l[h][s]:l[h];if(c&&(delete c[i],!r(c)))return}if(!o||(delete l[h][s],r(l[h]))){var u=l[h][s];n.support.deleteExpando||l!=t?delete l[h]:l[h]=null,u?(l[h]={},a||(l[h].toJSON=n.noop),l[h][s]=u):a&&(n.support.deleteExpando?delete e[n.expando]:e.removeAttribute?e.removeAttribute(n.expando):e[n.expando]=null)}}}},_data:function(t,e,i){return n.data(t,e,i,!0)},acceptData:function(t){if(t.nodeName){var e=n.noData[t.nodeName.toLowerCase()];if(e)return!(!0===e||t.getAttribute("classid")!==e)}return!0}}),n.fn.extend({data:function(t,i){var o=null;if(void 0===t){if(this.length&&(o=n.data(this[0]),1===this[0].nodeType))for(var r,a=this[0].attributes,l=0,h=a.length;l<h;l++)0===(r=a[l].name).indexOf("data-")&&(r=r.substr(5),s(this[0],r,o[r]));return o}if("object"==typeof t)return this.each(function(){n.data(this,t)});var c=t.split(".");return c[1]=c[1]?"."+c[1]:"",i===e?((o=this.triggerHandler("getData"+c[1]+"!",[c[0]]))===e&&this.length&&(o=n.data(this[0],t),o=s(this[0],t,o)),o===e&&c[1]?this.data(c[0]):o):this.each(function(){var e=n(this),o=[c[0],i];e.triggerHandler("setData"+c[1]+"!",o),n.data(this,t,i),e.triggerHandler("changeData"+c[1]+"!",o)})},removeData:function(t){return this.each(function(){n.removeData(this,t)})}}),n.extend({queue:function(t,e,i){if(t){e=(e||"fx")+"queue";var o=n._data(t,e);return i?(!o||n.isArray(i)?o=n._data(t,e,n.makeArray(i)):o.push(i),o):o||[]}},dequeue:function(t,e){e=e||"fx";var i=n.queue(t,e),o=i.shift();"inprogress"===o&&(o=i.shift()),o&&("fx"===e&&i.unshift("inprogress"),o.call(t,function(){n.dequeue(t,e)})),i.length||n.removeData(t,e+"queue",!0)}}),n.fn.extend({queue:function(t,i){return"string"!=typeof t&&(i=t,t="fx"),i===e?n.queue(this[0],t):this.each(function(e){var o=n.queue(this,t,i);"fx"===t&&"inprogress"!==o[0]&&n.dequeue(this,t)})},dequeue:function(t){return this.each(function(){n.dequeue(this,t)})},delay:function(t,e){return t=n.fx&&n.fx.speeds[t]||t,e=e||"fx",this.queue(e,function(){var i=this;setTimeout(function(){n.dequeue(i,e)},t)})},clearQueue:function(t){return this.queue(t||"fx",[])}});var a=/[\n\t\r]/g,l=/\s+/,h=/\r/g,c=/^(?:href|src|style)$/,u=/^(?:button|input)$/i,d=/^(?:button|input|object|select|textarea)$/i,p=/^a(?:rea)?$/i,f=/^(?:radio|checkbox)$/i;n.props={for:"htmlFor",class:"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"},n.fn.extend({attr:function(t,e){return n.access(this,t,e,!0,n.attr)},removeAttr:function(t,e){return this.each(function(){n.attr(this,t,""),1===this.nodeType&&this.removeAttribute(t)})},addClass:function(t){if(n.isFunction(t))return this.each(function(e){var i=n(this);i.addClass(t.call(this,e,i.attr("class")))});if(t&&"string"==typeof t)for(var e=(t||"").split(l),i=0,o=this.length;i<o;i++){var s=this[i];if(1===s.nodeType)if(s.className){for(var r=" "+s.className+" ",a=s.className,h=0,c=e.length;h<c;h++)r.indexOf(" "+e[h]+" ")<0&&(a+=" "+e[h]);s.className=n.trim(a)}else s.className=t}return this},removeClass:function(t){if(n.isFunction(t))return this.each(function(e){var i=n(this);i.removeClass(t.call(this,e,i.attr("class")))});if(t&&"string"==typeof t||t===e)for(var i=(t||"").split(l),o=0,s=this.length;o<s;o++){var r=this[o];if(1===r.nodeType&&r.className)if(t){for(var h=(" "+r.className+" ").replace(a," "),c=0,u=i.length;c<u;c++)h=h.replace(" "+i[c]+" "," ");r.className=n.trim(h)}else r.className=""}return this},toggleClass:function(t,e){var i=typeof t,o="boolean"==typeof e;return n.isFunction(t)?this.each(function(i){var o=n(this);o.toggleClass(t.call(this,i,o.attr("class"),e),e)}):this.each(function(){if("string"===i)for(var s,r=0,a=n(this),h=e,c=t.split(l);s=c[r++];)h=o?h:!a.hasClass(s),a[h?"addClass":"removeClass"](s);else"undefined"!==i&&"boolean"!==i||(this.className&&n._data(this,"__className__",this.className),this.className=this.className||!1===t?"":n._data(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",i=0,n=this.length;i<n;i++)if((" "+this[i].className+" ").replace(a," ").indexOf(e)>-1)return!0;return!1},val:function(t){if(!arguments.length){var i=this[0];if(i){if(n.nodeName(i,"option")){var o=i.attributes.value;return!o||o.specified?i.value:i.text}if(n.nodeName(i,"select")){var s=i.selectedIndex,r=[],a=i.options,l="select-one"===i.type;if(s<0)return null;for(var c=l?s:0,u=l?s+1:a.length;c<u;c++){var d=a[c];if(d.selected&&(n.support.optDisabled?!d.disabled:null===d.getAttribute("disabled"))&&(!d.parentNode.disabled||!n.nodeName(d.parentNode,"optgroup"))){if(t=n(d).val(),l)return t;r.push(t)}}return l&&!r.length&&a.length?n(a[s]).val():r}return f.test(i.type)&&!n.support.checkOn?null===i.getAttribute("value")?"on":i.value:(i.value||"").replace(h,"")}return e}var p=n.isFunction(t);return this.each(function(e){var i=n(this),o=t;if(1===this.nodeType)if(p&&(o=t.call(this,e,i.val())),null==o?o="":"number"==typeof o?o+="":n.isArray(o)&&(o=n.map(o,function(t){return null==t?"":t+""})),n.isArray(o)&&f.test(this.type))this.checked=n.inArray(i.val(),o)>=0;else if(n.nodeName(this,"select")){var s=n.makeArray(o);n("option",this).each(function(){this.selected=n.inArray(n(this).val(),s)>=0}),s.length||(this.selectedIndex=-1)}else this.value=o})}}),n.extend({attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(t,i,o,s){if(!t||3===t.nodeType||8===t.nodeType||2===t.nodeType)return e;if(s&&i in n.attrFn)return n(t)[i](o);var r=1!==t.nodeType||!n.isXMLDoc(t),a=o!==e;if(i=r&&n.props[i]||i,1===t.nodeType){var l=c.test(i);if("selected"===i&&!n.support.optSelected){var h=t.parentNode;h&&(h.selectedIndex,h.parentNode&&h.parentNode.selectedIndex)}if((i in t||t[i]!==e)&&r&&!l){if(a&&("type"===i&&u.test(t.nodeName)&&t.parentNode&&n.error("type property can't be changed"),null===o?1===t.nodeType&&t.removeAttribute(i):t[i]=o),n.nodeName(t,"form")&&t.getAttributeNode(i))return t.getAttributeNode(i).nodeValue;if("tabIndex"===i){var f=t.getAttributeNode("tabIndex");return f&&f.specified?f.value:d.test(t.nodeName)||p.test(t.nodeName)&&t.href?0:e}return t[i]}if(!n.support.style&&r&&"style"===i)return a&&(t.style.cssText=""+o),t.style.cssText;if(a&&t.setAttribute(i,""+o),!t.attributes[i]&&t.hasAttribute&&!t.hasAttribute(i))return e;var m=!n.support.hrefNormalized&&r&&l?t.getAttribute(i,2):t.getAttribute(i);return null===m?e:m}return a&&(t[i]=o),t[i]}});var m=/\.(.*)$/,g=/^(?:textarea|input|select)$/i,v=/\./g,y=/ /g,_=/[^\w\s.|`]/g,b=function(t){return t.replace(_,"\\$&")};function w(){return!1}function x(){return!0}n.event={add:function(i,o,s,r){if(3!==i.nodeType&&8!==i.nodeType){try{n.isWindow(i)&&i!==t&&!i.frameElement&&(i=t)}catch(t){}if(!1===s)s=w;else if(!s)return;var a,l;s.handler&&(s=(a=s).handler),s.guid||(s.guid=n.guid++);var h=n._data(i);if(h){var c=h.events,u=h.handle;c||(h.events=c={}),u||(h.handle=u=function(){return void 0===n||n.event.triggered?e:n.event.handle.apply(u.elem,arguments)}),u.elem=i,o=o.split(" ");for(var d,p,f=0;d=o[f++];){l=a?n.extend({},a):{handler:s,data:r},d.indexOf(".")>-1?(p=d.split("."),d=p.shift(),l.namespace=p.slice(0).sort().join(".")):(p=[],l.namespace=""),l.type=d,l.guid||(l.guid=s.guid);var m=c[d],g=n.event.special[d]||{};m||(m=c[d]=[],g.setup&&!1!==g.setup.call(i,r,p,u)||(i.addEventListener?i.addEventListener(d,u,!1):i.attachEvent&&i.attachEvent("on"+d,u))),g.add&&(g.add.call(i,l),l.handler.guid||(l.handler.guid=s.guid)),m.push(l),n.event.global[d]=!0}i=null}}},global:{},remove:function(t,i,o,s){if(3!==t.nodeType&&8!==t.nodeType){!1===o&&(o=w);var r,a,l,h,c,u,d,p,f,m=0,g=n.hasData(t)&&n._data(t),v=g&&g.events;if(g&&v)if(i&&i.type&&(o=i.handler,i=i.type),!i||"string"==typeof i&&"."===i.charAt(0))for(r in i=i||"",v)n.event.remove(t,r+i);else{for(i=i.split(" ");r=i[m++];)if(f=r,p=null,h=[],(l=r.indexOf(".")<0)||(h=r.split("."),r=h.shift(),c=new RegExp("(^|\\.)"+n.map(h.slice(0).sort(),b).join("\\.(?:.*\\.)?")+"(\\.|$)")),d=v[r])if(o){for(u=n.event.special[r]||{},a=s||0;a<d.length&&(p=d[a],o.guid!==p.guid||((l||c.test(p.namespace))&&(null==s&&d.splice(a--,1),u.remove&&u.remove.call(t,p)),null==s));a++);(0===d.length||null!=s&&1===d.length)&&(u.teardown&&!1!==u.teardown.call(t,h)||n.removeEvent(t,r,g.handle),null,delete v[r])}else for(a=0;a<d.length;a++)p=d[a],(l||c.test(p.namespace))&&(n.event.remove(t,f,p.handler,a),d.splice(a--,1));if(n.isEmptyObject(v)){var y=g.handle;y&&(y.elem=null),delete g.events,delete g.handle,n.isEmptyObject(g)&&n.removeData(t,e,!0)}}}},trigger:function(t,i,o){var s=t.type||t;if(!arguments[3]){if(t="object"==typeof t?t[n.expando]?t:n.extend(n.Event(s),t):n.Event(s),s.indexOf("!")>=0&&(t.type=s=s.slice(0,-1),t.exclusive=!0),o||(t.stopPropagation(),n.event.global[s]&&n.each(n.cache,function(){var e=this[n.expando];e&&e.events&&e.events[s]&&n.event.trigger(t,i,e.handle.elem)})),!o||3===o.nodeType||8===o.nodeType)return e;t.result=e,t.target=o,(i=n.makeArray(i)).unshift(t)}t.currentTarget=o;var r=n._data(o,"handle");r&&r.apply(o,i);var a=o.parentNode||o.ownerDocument;try{o&&o.nodeName&&n.noData[o.nodeName.toLowerCase()]||o["on"+s]&&!1===o["on"+s].apply(o,i)&&(t.result=!1,t.preventDefault())}catch(t){}if(!t.isPropagationStopped()&&a)n.event.trigger(t,i,a,!0);else if(!t.isDefaultPrevented()){var l,h=t.target,c=s.replace(m,""),u=n.nodeName(h,"a")&&"click"===c,d=n.event.special[c]||{};if(!(d._default&&!1!==d._default.call(o,t)||u||h&&h.nodeName&&n.noData[h.nodeName.toLowerCase()])){try{h[c]&&((l=h["on"+c])&&(h["on"+c]=null),n.event.triggered=!0,h[c]())}catch(t){}l&&(h["on"+c]=l),n.event.triggered=!1}}},handle:function(i){var o,s,r,a,l,h=[],c=n.makeArray(arguments);if((i=c[0]=n.event.fix(i||t.event)).currentTarget=this,(o=i.type.indexOf(".")<0&&!i.exclusive)||(r=i.type.split("."),i.type=r.shift(),h=r.slice(0).sort(),a=new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.)?")+"(\\.|$)")),i.namespace=i.namespace||h.join("."),s=((l=n._data(this,"events"))||{})[i.type],l&&s)for(var u=0,d=(s=s.slice(0)).length;u<d;u++){var p=s[u];if(o||a.test(p.namespace)){i.handler=p.handler,i.data=p.data,i.handleObj=p;var f=p.handler.apply(this,c);if(f!==e&&(i.result=f,!1===f&&(i.preventDefault(),i.stopPropagation())),i.isImmediatePropagationStopped())break}}return i.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(t){if(t[n.expando])return t;var o=t;t=n.Event(o);for(var s,r=this.props.length;r;)t[s=this.props[--r]]=o[s];if(t.target||(t.target=t.srcElement||i),3===t.target.nodeType&&(t.target=t.target.parentNode),!t.relatedTarget&&t.fromElement&&(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),null==t.pageX&&null!=t.clientX){var a=i.documentElement,l=i.body;t.pageX=t.clientX+(a&&a.scrollLeft||l&&l.scrollLeft||0)-(a&&a.clientLeft||l&&l.clientLeft||0),t.pageY=t.clientY+(a&&a.scrollTop||l&&l.scrollTop||0)-(a&&a.clientTop||l&&l.clientTop||0)}return null!=t.which||null==t.charCode&&null==t.keyCode||(t.which=null!=t.charCode?t.charCode:t.keyCode),!t.metaKey&&t.ctrlKey&&(t.metaKey=t.ctrlKey),t.which||t.button===e||(t.which=1&t.button?1:2&t.button?3:4&t.button?2:0),t},guid:1e8,proxy:n.proxy,special:{ready:{setup:n.bindReady,teardown:n.noop},live:{add:function(t){n.event.add(this,z(t.origType,t.selector),n.extend({},t,{handler:P,guid:t.handler.guid}))},remove:function(t){n.event.remove(this,z(t.origType,t.selector),t)}},beforeunload:{setup:function(t,e,i){n.isWindow(this)&&(this.onbeforeunload=i)},teardown:function(t,e){this.onbeforeunload===e&&(this.onbeforeunload=null)}}}},n.removeEvent=i.removeEventListener?function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)}:function(t,e,i){t.detachEvent&&t.detachEvent("on"+e,i)},n.Event=function(t){if(!this.preventDefault)return new n.Event(t);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||!1===t.returnValue||t.getPreventDefault&&t.getPreventDefault()?x:w):this.type=t,this.timeStamp=n.now(),this[n.expando]=!0},n.Event.prototype={preventDefault:function(){this.isDefaultPrevented=x;var t=this.originalEvent;t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=x;var t=this.originalEvent;t&&(t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=x,this.stopPropagation()},isDefaultPrevented:w,isPropagationStopped:w,isImmediatePropagationStopped:w};var T=function(t){var e=t.relatedTarget;try{if(e!==i&&!e.parentNode)return;for(;e&&e!==this;)e=e.parentNode;e!==this&&(t.type=t.data,n.event.handle.apply(this,arguments))}catch(t){}},S=function(t){t.type=t.data,n.event.handle.apply(this,arguments)};if(n.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(t,e){n.event.special[t]={setup:function(i){n.event.add(this,e,i&&i.selector?S:T,t)},teardown:function(t){n.event.remove(this,e,t&&t.selector?S:T)}}}),n.support.submitBubbles||(n.event.special.submit={setup:function(t,e){if(!this.nodeName||"form"===this.nodeName.toLowerCase())return!1;n.event.add(this,"click.specialSubmit",function(t){var e=t.target,i=e.type;"submit"!==i&&"image"!==i||!n(e).closest("form").length||M("submit",this,arguments)}),n.event.add(this,"keypress.specialSubmit",function(t){var e=t.target,i=e.type;"text"!==i&&"password"!==i||!n(e).closest("form").length||13!==t.keyCode||M("submit",this,arguments)})},teardown:function(t){n.event.remove(this,".specialSubmit")}}),!n.support.changeBubbles){var k,L=function(t){var e=t.type,i=t.value;return"radio"===e||"checkbox"===e?i=t.checked:"select-multiple"===e?i=t.selectedIndex>-1?n.map(t.options,function(t){return t.selected}).join("-"):"":"select"===t.nodeName.toLowerCase()&&(i=t.selectedIndex),i},C=function(t){var i,o,s=t.target;g.test(s.nodeName)&&!s.readOnly&&(i=n._data(s,"_change_data"),o=L(s),"focusout"===t.type&&"radio"===s.type||n._data(s,"_change_data",o),i!==e&&o!==i&&(null!=i||o)&&(t.type="change",t.liveFired=e,n.event.trigger(t,arguments[1],s)))};n.event.special.change={filters:{focusout:C,beforedeactivate:C,click:function(t){var e=t.target,i=e.type;"radio"!==i&&"checkbox"!==i&&"select"!==e.nodeName.toLowerCase()||C.call(this,t)},keydown:function(t){var e=t.target,i=e.type;(13===t.keyCode&&"textarea"!==e.nodeName.toLowerCase()||32===t.keyCode&&("checkbox"===i||"radio"===i)||"select-multiple"===i)&&C.call(this,t)},beforeactivate:function(t){var e=t.target;n._data(e,"_change_data",L(e))}},setup:function(t,e){if("file"===this.type)return!1;for(var i in k)n.event.add(this,i+".specialChange",k[i]);return g.test(this.nodeName)},teardown:function(t){return n.event.remove(this,".specialChange"),g.test(this.nodeName)}},(k=n.event.special.change.filters).focus=k.beforeactivate}function M(t,i,o){var s=n.extend({},o[0]);s.type=t,s.originalEvent={},s.liveFired=e,n.event.handle.call(i,s),s.isDefaultPrevented()&&o[0].preventDefault()}i.addEventListener&&n.each({focus:"focusin",blur:"focusout"},function(t,e){function i(t){return(t=n.event.fix(t)).type=e,n.event.handle.call(this,t)}n.event.special[e]={setup:function(){this.addEventListener(t,i,!0)},teardown:function(){this.removeEventListener(t,i,!0)}}}),n.each(["bind","one"],function(t,i){n.fn[i]=function(t,o,s){if("object"==typeof t){for(var r in t)this[i](r,o,t[r],s);return this}(n.isFunction(o)||!1===o)&&(s=o,o=e);var a="one"===i?n.proxy(s,function(t){return n(this).unbind(t,a),s.apply(this,arguments)}):s;if("unload"===t&&"one"!==i)this.one(t,o,s);else for(var l=0,h=this.length;l<h;l++)n.event.add(this[l],t,a,o);return this}}),n.fn.extend({unbind:function(t,e){if("object"!=typeof t||t.preventDefault)for(var i=0,o=this.length;i<o;i++)n.event.remove(this[i],t,e);else for(var s in t)this.unbind(s,t[s]);return this},delegate:function(t,e,i,n){return this.live(e,i,n,t)},undelegate:function(t,e,i){return 0===arguments.length?this.unbind("live"):this.die(e,null,i,t)},trigger:function(t,e){return this.each(function(){n.event.trigger(t,e,this)})},triggerHandler:function(t,e){if(this[0]){var i=n.Event(t);return i.preventDefault(),i.stopPropagation(),n.event.trigger(i,e,this[0]),i.result}},toggle:function(t){for(var e=arguments,i=1;i<e.length;)n.proxy(t,e[i++]);return this.click(n.proxy(t,function(o){var s=(n._data(this,"lastToggle"+t.guid)||0)%i;return n._data(this,"lastToggle"+t.guid,s+1),o.preventDefault(),e[s].apply(this,arguments)||!1}))},hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}});var A={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};function P(t){var e,i,o,s,r,a,l,h,c,u,d,p,f=[],g=[],v=n._data(this,"events");if(t.liveFired!==this&&v&&v.live&&!t.target.disabled&&(!t.button||"click"!==t.type)){t.namespace&&(d=new RegExp("(^|\\.)"+t.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),t.liveFired=this;var y=v.live.slice(0);for(l=0;l<y.length;l++)(r=y[l]).origType.replace(m,"")===t.type?g.push(r.selector):y.splice(l--,1);for(h=0,c=(s=n(t.target).closest(g,t.currentTarget)).length;h<c;h++)for(u=s[h],l=0;l<y.length;l++)r=y[l],u.selector!==r.selector||d&&!d.test(r.namespace)||u.elem.disabled||(a=u.elem,o=null,"mouseenter"!==r.preType&&"mouseleave"!==r.preType||(t.type=r.preType,o=n(t.relatedTarget).closest(r.selector)[0]),o&&o===a||f.push({elem:a,handleObj:r,level:u.level}));for(h=0,c=f.length;h<c&&(s=f[h],!(i&&s.level>i))&&(t.currentTarget=s.elem,t.data=s.handleObj.data,t.handleObj=s.handleObj,!1!==(p=s.handleObj.origHandler.apply(s.elem,arguments))&&!t.isPropagationStopped()||(i=s.level,!1===p&&(e=!1),!t.isImmediatePropagationStopped()));h++);return e}}function z(t,e){return(t&&"*"!==t?t+".":"")+e.replace(v,"`").replace(y,"&")}n.each(["live","die"],function(t,i){n.fn[i]=function(t,o,s,r){var a,l,h,c,u=0,d=r||this.selector,p=r?this:n(this.context);if("object"==typeof t&&!t.preventDefault){for(var f in t)p[i](f,o,t[f],d);return this}for(n.isFunction(o)&&(s=o,o=e),t=(t||"").split(" ");null!=(a=t[u++]);)if(h="",(l=m.exec(a))&&(h=l[0],a=a.replace(m,"")),"hover"!==a)if(c=a,"focus"===a||"blur"===a?(t.push(A[a]+h),a+=h):a=(A[a]||a)+h,"live"===i)for(var g=0,v=p.length;g<v;g++)n.event.add(p[g],"live."+z(a,d),{data:o,selector:d,handler:s,origType:a,origHandler:s,preType:c});else p.unbind("live."+z(a,d),s);else t.push("mouseenter"+h,"mouseleave"+h);return this}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(t,e){n.fn[e]=function(t,i){return null==i&&(i=t,t=null),arguments.length>0?this.bind(e,t,i):this.trigger(e)},n.attrFn&&(n.attrFn[e]=!0)}),function(){var t=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,o=0,s=Object.prototype.toString,r=!1,a=!0,l=/\\/g,h=/\W/;[0,0].sort(function(){return a=!1,0});var c=function(e,n,o,r){o=o||[];var a=n=n||i;if(1!==n.nodeType&&9!==n.nodeType)return[];if(!e||"string"!=typeof e)return o;var l,h,p,f,m,g,v,y,_=!0,b=c.isXML(n),x=[],T=e;do{if(t.exec(""),(l=t.exec(T))&&(T=l[3],x.push(l[1]),l[2])){f=l[3];break}}while(l);if(x.length>1&&d.exec(e))if(2===x.length&&u.relative[x[0]])h=S(x[0]+x[1],n);else for(h=u.relative[x[0]]?[n]:c(x.shift(),n);x.length;)e=x.shift(),u.relative[e]&&(e+=x.shift()),h=S(e,h);else if(!r&&x.length>1&&9===n.nodeType&&!b&&u.match.ID.test(x[0])&&!u.match.ID.test(x[x.length-1])&&(n=(m=c.find(x.shift(),n,b)).expr?c.filter(m.expr,m.set)[0]:m.set[0]),n)for(h=(m=r?{expr:x.pop(),set:w(r)}:c.find(x.pop(),1!==x.length||"~"!==x[0]&&"+"!==x[0]||!n.parentNode?n:n.parentNode,b)).expr?c.filter(m.expr,m.set):m.set,x.length>0?p=w(h):_=!1;x.length;)v=g=x.pop(),u.relative[g]?v=x.pop():g="",null==v&&(v=n),u.relative[g](p,v,b);else p=x=[];if(p||(p=h),p||c.error(g||e),"[object Array]"===s.call(p))if(_)if(n&&1===n.nodeType)for(y=0;null!=p[y];y++)p[y]&&(!0===p[y]||1===p[y].nodeType&&c.contains(n,p[y]))&&o.push(h[y]);else for(y=0;null!=p[y];y++)p[y]&&1===p[y].nodeType&&o.push(h[y]);else o.push.apply(o,p);else w(p,o);return f&&(c(f,a,o,r),c.uniqueSort(o)),o};c.uniqueSort=function(t){if(m&&(r=a,t.sort(m),r))for(var e=1;e<t.length;e++)t[e]===t[e-1]&&t.splice(e--,1);return t},c.matches=function(t,e){return c(t,null,null,e)},c.matchesSelector=function(t,e){return c(e,null,null,[t]).length>0},c.find=function(t,e,i){var n;if(!t)return[];for(var o=0,s=u.order.length;o<s;o++){var r,a=u.order[o];if(r=u.leftMatch[a].exec(t)){var h=r[1];if(r.splice(1,1),"\\"!==h.substr(h.length-1)&&(r[1]=(r[1]||"").replace(l,""),null!=(n=u.find[a](r,e,i)))){t=t.replace(u.match[a],"");break}}}return n||(n=void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):[]),{set:n,expr:t}},c.filter=function(t,i,n,o){for(var s,r,a=t,l=[],h=i,d=i&&i[0]&&c.isXML(i[0]);t&&i.length;){for(var p in u.filter)if(null!=(s=u.leftMatch[p].exec(t))&&s[2]){var f,m,g=u.filter[p],v=s[1];if(r=!1,s.splice(1,1),"\\"===v.substr(v.length-1))continue;if(h===l&&(l=[]),u.preFilter[p])if(s=u.preFilter[p](s,h,n,l,o,d)){if(!0===s)continue}else r=f=!0;if(s)for(var y=0;null!=(m=h[y]);y++)if(m){var _=o^!!(f=g(m,s,y,h));n&&null!=f?_?r=!0:h[y]=!1:_&&(l.push(m),r=!0)}if(f!==e){if(n||(h=l),t=t.replace(u.match[p],""),!r)return[];break}}if(t===a){if(null!=r)break;c.error(t)}a=t}return h},c.error=function(t){throw"Syntax error, unrecognized expression: "+t};var u=c.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(t){return t.getAttribute("href")},type:function(t){return t.getAttribute("type")}},relative:{"+":function(t,e){var i="string"==typeof e,n=i&&!h.test(e),o=i&&!n;n&&(e=e.toLowerCase());for(var s,r=0,a=t.length;r<a;r++)if(s=t[r]){for(;(s=s.previousSibling)&&1!==s.nodeType;);t[r]=o||s&&s.nodeName.toLowerCase()===e?s||!1:s===e}o&&c.filter(e,t,!0)},">":function(t,e){var i,n="string"==typeof e,o=0,s=t.length;if(n&&!h.test(e)){for(e=e.toLowerCase();o<s;o++)if(i=t[o]){var r=i.parentNode;t[o]=r.nodeName.toLowerCase()===e&&r}}else{for(;o<s;o++)(i=t[o])&&(t[o]=n?i.parentNode:i.parentNode===e);n&&c.filter(e,t,!0)}},"":function(t,e,i){var n,s=o++,r=T;"string"!=typeof e||h.test(e)||(n=e=e.toLowerCase(),r=x),r("parentNode",e,s,t,n,i)},"~":function(t,e,i){var n,s=o++,r=T;"string"!=typeof e||h.test(e)||(n=e=e.toLowerCase(),r=x),r("previousSibling",e,s,t,n,i)}},find:{ID:function(t,e,i){if(void 0!==e.getElementById&&!i){var n=e.getElementById(t[1]);return n&&n.parentNode?[n]:[]}},NAME:function(t,e){if(void 0!==e.getElementsByName){for(var i=[],n=e.getElementsByName(t[1]),o=0,s=n.length;o<s;o++)n[o].getAttribute("name")===t[1]&&i.push(n[o]);return 0===i.length?null:i}},TAG:function(t,e){if(void 0!==e.getElementsByTagName)return e.getElementsByTagName(t[1])}},preFilter:{CLASS:function(t,e,i,n,o,s){if(t=" "+t[1].replace(l,"")+" ",s)return t;for(var r,a=0;null!=(r=e[a]);a++)r&&(o^(r.className&&(" "+r.className+" ").replace(/[\t\n\r]/g," ").indexOf(t)>=0)?i||n.push(r):i&&(e[a]=!1));return!1},ID:function(t){return t[1].replace(l,"")},TAG:function(t,e){return t[1].replace(l,"").toLowerCase()},CHILD:function(t){if("nth"===t[1]){t[2]||c.error(t[0]),t[2]=t[2].replace(/^\+|\s*/g,"");var e=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(("even"===t[2]?"2n":"odd"===t[2]&&"2n+1")||!/\D/.test(t[2])&&"0n+"+t[2]||t[2]);t[2]=e[1]+(e[2]||1)-0,t[3]=e[3]-0}else t[2]&&c.error(t[0]);return t[0]=o++,t},ATTR:function(t,e,i,n,o,s){var r=t[1]=t[1].replace(l,"");return!s&&u.attrMap[r]&&(t[1]=u.attrMap[r]),t[4]=(t[4]||t[5]||"").replace(l,""),"~="===t[2]&&(t[4]=" "+t[4]+" "),t},PSEUDO:function(e,i,n,o,s){if("not"===e[1]){if(!((t.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var r=c.filter(e[3],i,n,!0^s);return n||o.push.apply(o,r),!1}e[3]=c(e[3],null,null,i)}else if(u.match.POS.test(e[0])||u.match.CHILD.test(e[0]))return!0;return e},POS:function(t){return t.unshift(!0),t}},filters:{enabled:function(t){return!1===t.disabled&&"hidden"!==t.type},disabled:function(t){return!0===t.disabled},checked:function(t){return!0===t.checked},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},parent:function(t){return!!t.firstChild},empty:function(t){return!t.firstChild},has:function(t,e,i){return!!c(i[3],t).length},header:function(t){return/h\d/i.test(t.nodeName)},text:function(t){return"text"===t.getAttribute("type")},radio:function(t){return"radio"===t.type},checkbox:function(t){return"checkbox"===t.type},file:function(t){return"file"===t.type},password:function(t){return"password"===t.type},submit:function(t){return"submit"===t.type},image:function(t){return"image"===t.type},reset:function(t){return"reset"===t.type},button:function(t){return"button"===t.type||"button"===t.nodeName.toLowerCase()},input:function(t){return/input|select|textarea|button/i.test(t.nodeName)}},setFilters:{first:function(t,e){return 0===e},last:function(t,e,i,n){return e===n.length-1},even:function(t,e){return e%2==0},odd:function(t,e){return e%2==1},lt:function(t,e,i){return e<i[3]-0},gt:function(t,e,i){return e>i[3]-0},nth:function(t,e,i){return i[3]-0===e},eq:function(t,e,i){return i[3]-0===e}},filter:{PSEUDO:function(t,e,i,n){var o=e[1],s=u.filters[o];if(s)return s(t,i,e,n);if("contains"===o)return(t.textContent||t.innerText||c.getText([t])||"").indexOf(e[3])>=0;if("not"===o){for(var r=e[3],a=0,l=r.length;a<l;a++)if(r[a]===t)return!1;return!0}c.error(o)},CHILD:function(t,e){var i=e[1],n=t;switch(i){case"only":case"first":for(;n=n.previousSibling;)if(1===n.nodeType)return!1;if("first"===i)return!0;n=t;case"last":for(;n=n.nextSibling;)if(1===n.nodeType)return!1;return!0;case"nth":var o=e[2],s=e[3];if(1===o&&0===s)return!0;var r=e[0],a=t.parentNode;if(a&&(a.sizcache!==r||!t.nodeIndex)){var l=0;for(n=a.firstChild;n;n=n.nextSibling)1===n.nodeType&&(n.nodeIndex=++l);a.sizcache=r}var h=t.nodeIndex-s;return 0===o?0===h:h%o==0&&h/o>=0}},ID:function(t,e){return 1===t.nodeType&&t.getAttribute("id")===e},TAG:function(t,e){return"*"===e&&1===t.nodeType||t.nodeName.toLowerCase()===e},CLASS:function(t,e){return(" "+(t.className||t.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(t,e){var i=e[1],n=u.attrHandle[i]?u.attrHandle[i](t):null!=t[i]?t[i]:t.getAttribute(i),o=n+"",s=e[2],r=e[4];return null==n?"!="===s:"="===s?o===r:"*="===s?o.indexOf(r)>=0:"~="===s?(" "+o+" ").indexOf(r)>=0:r?"!="===s?o!==r:"^="===s?0===o.indexOf(r):"$="===s?o.substr(o.length-r.length)===r:"|="===s&&(o===r||o.substr(0,r.length+1)===r+"-"):o&&!1!==n},POS:function(t,e,i,n){var o=e[2],s=u.setFilters[o];if(s)return s(t,i,e,n)}}},d=u.match.POS,p=function(t,e){return"\\"+(e-0+1)};for(var f in u.match)u.match[f]=new RegExp(u.match[f].source+/(?![^\[]*\])(?![^\(]*\))/.source),u.leftMatch[f]=new RegExp(/(^(?:.|\r|\n)*?)/.source+u.match[f].source.replace(/\\(\d+)/g,p));var m,g,v,y,_,b,w=function(t,e){return t=Array.prototype.slice.call(t,0),e?(e.push.apply(e,t),e):t};try{Array.prototype.slice.call(i.documentElement.childNodes,0)[0].nodeType}catch(t){w=function(t,e){var i=0,n=e||[];if("[object Array]"===s.call(t))Array.prototype.push.apply(n,t);else if("number"==typeof t.length)for(var o=t.length;i<o;i++)n.push(t[i]);else for(;t[i];i++)n.push(t[i]);return n}}function x(t,e,i,n,o,s){for(var r=0,a=n.length;r<a;r++){var l=n[r];if(l){var h=!1;for(l=l[t];l;){if(l.sizcache===i){h=n[l.sizset];break}if(1!==l.nodeType||s||(l.sizcache=i,l.sizset=r),l.nodeName.toLowerCase()===e){h=l;break}l=l[t]}n[r]=h}}}function T(t,e,i,n,o,s){for(var r=0,a=n.length;r<a;r++){var l=n[r];if(l){var h=!1;for(l=l[t];l;){if(l.sizcache===i){h=n[l.sizset];break}if(1===l.nodeType)if(s||(l.sizcache=i,l.sizset=r),"string"!=typeof e){if(l===e){h=!0;break}}else if(c.filter(e,[l]).length>0){h=l;break}l=l[t]}n[r]=h}}}i.documentElement.compareDocumentPosition?m=function(t,e){return t===e?(r=!0,0):t.compareDocumentPosition&&e.compareDocumentPosition?4&t.compareDocumentPosition(e)?-1:1:t.compareDocumentPosition?-1:1}:(m=function(t,e){var i,n,o=[],s=[],a=t.parentNode,l=e.parentNode,h=a;if(t===e)return r=!0,0;if(a===l)return g(t,e);if(!a)return-1;if(!l)return 1;for(;h;)o.unshift(h),h=h.parentNode;for(h=l;h;)s.unshift(h),h=h.parentNode;i=o.length,n=s.length;for(var c=0;c<i&&c<n;c++)if(o[c]!==s[c])return g(o[c],s[c]);return c===i?g(t,s[c],-1):g(o[c],e,1)},g=function(t,e,i){if(t===e)return i;for(var n=t.nextSibling;n;){if(n===e)return-1;n=n.nextSibling}return 1}),c.getText=function(t){for(var e,i="",n=0;t[n];n++)3===(e=t[n]).nodeType||4===e.nodeType?i+=e.nodeValue:8!==e.nodeType&&(i+=c.getText(e.childNodes));return i},v=i.createElement("div"),y="script"+(new Date).getTime(),_=i.documentElement,v.innerHTML="<a name='"+y+"'/>",_.insertBefore(v,_.firstChild),i.getElementById(y)&&(u.find.ID=function(t,i,n){if(void 0!==i.getElementById&&!n){var o=i.getElementById(t[1]);return o?o.id===t[1]||void 0!==o.getAttributeNode&&o.getAttributeNode("id").nodeValue===t[1]?[o]:e:[]}},u.filter.ID=function(t,e){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return 1===t.nodeType&&i&&i.nodeValue===e}),_.removeChild(v),_=v=null,(b=i.createElement("div")).appendChild(i.createComment("")),b.getElementsByTagName("*").length>0&&(u.find.TAG=function(t,e){var i=e.getElementsByTagName(t[1]);if("*"===t[1]){for(var n=[],o=0;i[o];o++)1===i[o].nodeType&&n.push(i[o]);i=n}return i}),b.innerHTML="<a href='#'></a>",b.firstChild&&void 0!==b.firstChild.getAttribute&&"#"!==b.firstChild.getAttribute("href")&&(u.attrHandle.href=function(t){return t.getAttribute("href",2)}),b=null,i.querySelectorAll&&function(){var t=c,e=i.createElement("div");if(e.innerHTML="<p class='TEST'></p>",!e.querySelectorAll||0!==e.querySelectorAll(".TEST").length){for(var n in c=function(e,n,o,s){if(n=n||i,!s&&!c.isXML(n)){var r=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(e);if(r&&(1===n.nodeType||9===n.nodeType)){if(r[1])return w(n.getElementsByTagName(e),o);if(r[2]&&u.find.CLASS&&n.getElementsByClassName)return w(n.getElementsByClassName(r[2]),o)}if(9===n.nodeType){if("body"===e&&n.body)return w([n.body],o);if(r&&r[3]){var a=n.getElementById(r[3]);if(!a||!a.parentNode)return w([],o);if(a.id===r[3])return w([a],o)}try{return w(n.querySelectorAll(e),o)}catch(t){}}else if(1===n.nodeType&&"object"!==n.nodeName.toLowerCase()){var l=n,h=n.getAttribute("id"),d=h||"__sizzle__",p=n.parentNode,f=/^\s*[+~]/.test(e);h?d=d.replace(/'/g,"\\$&"):n.setAttribute("id",d),f&&p&&(n=n.parentNode);try{if(!f||p)return w(n.querySelectorAll("[id='"+d+"'] "+e),o)}catch(t){}finally{h||l.removeAttribute("id")}}}return t(e,n,o,s)},t)c[n]=t[n];e=null}}(),function(){var t=i.documentElement,e=t.matchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.msMatchesSelector,n=!1;try{e.call(i.documentElement,"[test!='']:sizzle")}catch(t){n=!0}e&&(c.matchesSelector=function(t,i){if(i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!c.isXML(t))try{if(n||!u.match.PSEUDO.test(i)&&!/!=/.test(i))return e.call(t,i)}catch(t){}return c(i,null,null,[t]).length>0})}(),function(){var t=i.createElement("div");t.innerHTML="<div class='test e'></div><div class='test'></div>",t.getElementsByClassName&&0!==t.getElementsByClassName("e").length&&(t.lastChild.className="e",1!==t.getElementsByClassName("e").length&&(u.order.splice(1,0,"CLASS"),u.find.CLASS=function(t,e,i){if(void 0!==e.getElementsByClassName&&!i)return e.getElementsByClassName(t[1])},t=null))}(),i.documentElement.contains?c.contains=function(t,e){return t!==e&&(!t.contains||t.contains(e))}:i.documentElement.compareDocumentPosition?c.contains=function(t,e){return!!(16&t.compareDocumentPosition(e))}:c.contains=function(){return!1},c.isXML=function(t){var e=(t?t.ownerDocument||t:0).documentElement;return!!e&&"HTML"!==e.nodeName};var S=function(t,e){for(var i,n=[],o="",s=e.nodeType?[e]:e;i=u.match.PSEUDO.exec(t);)o+=i[0],t=t.replace(u.match.PSEUDO,"");t=u.relative[t]?t+"*":t;for(var r=0,a=s.length;r<a;r++)c(t,s[r],n);return c.filter(o,n)};n.find=c,n.expr=c.selectors,n.expr[":"]=n.expr.filters,n.unique=c.uniqueSort,n.text=c.getText,n.isXMLDoc=c.isXML,n.contains=c.contains}();var E=/Until$/,N=/^(?:parents|prevUntil|prevAll)/,D=/,/,O=/^.[^:#\[\.,]*$/,I=Array.prototype.slice,F=n.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};function j(t){return!t||!t.parentNode||11===t.parentNode.nodeType}function B(t,e,i){if(n.isFunction(e))return n.grep(t,function(t,n){return!!e.call(t,n,t)===i});if(e.nodeType)return n.grep(t,function(t,n){return t===e===i});if("string"==typeof e){var o=n.grep(t,function(t){return 1===t.nodeType});if(O.test(e))return n.filter(e,o,!i);e=n.filter(e,o)}return n.grep(t,function(t,o){return n.inArray(t,e)>=0===i})}n.fn.extend({find:function(t){for(var e=this.pushStack("","find",t),i=0,o=0,s=this.length;o<s;o++)if(i=e.length,n.find(t,this[o],e),o>0)for(var r=i;r<e.length;r++)for(var a=0;a<i;a++)if(e[a]===e[r]){e.splice(r--,1);break}return e},has:function(t){var e=n(t);return this.filter(function(){for(var t=0,i=e.length;t<i;t++)if(n.contains(this,e[t]))return!0})},not:function(t){return this.pushStack(B(this,t,!1),"not",t)},filter:function(t){return this.pushStack(B(this,t,!0),"filter",t)},is:function(t){return!!t&&n.filter(t,this).length>0},closest:function(t,e){var i,o,s=[],r=this[0];if(n.isArray(t)){var a,l,h={},c=1;if(r&&t.length){for(i=0,o=t.length;i<o;i++)h[l=t[i]]||(h[l]=n.expr.match.POS.test(l)?n(l,e||this.context):l);for(;r&&r.ownerDocument&&r!==e;){for(l in h)((a=h[l]).jquery?a.index(r)>-1:n(r).is(a))&&s.push({selector:l,elem:r,level:c});r=r.parentNode,c++}}return s}var u=F.test(t)?n(t,e||this.context):null;for(i=0,o=this.length;i<o;i++)for(r=this[i];r;){if(u?u.index(r)>-1:n.find.matchesSelector(r,t)){s.push(r);break}if(!(r=r.parentNode)||!r.ownerDocument||r===e)break}return s=s.length>1?n.unique(s):s,this.pushStack(s,"closest",t)},index:function(t){return t&&"string"!=typeof t?n.inArray(t.jquery?t[0]:t,this):n.inArray(this[0],t?n(t):this.parent().children())},add:function(t,e){var i="string"==typeof t?n(t,e):n.makeArray(t),o=n.merge(this.get(),i);return this.pushStack(j(i[0])||j(o[0])?o:n.unique(o))},andSelf:function(){return this.add(this.prevObject)}}),n.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return n.dir(t,"parentNode")},parentsUntil:function(t,e,i){return n.dir(t,"parentNode",i)},next:function(t){return n.nth(t,2,"nextSibling")},prev:function(t){return n.nth(t,2,"previousSibling")},nextAll:function(t){return n.dir(t,"nextSibling")},prevAll:function(t){return n.dir(t,"previousSibling")},nextUntil:function(t,e,i){return n.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return n.dir(t,"previousSibling",i)},siblings:function(t){return n.sibling(t.parentNode.firstChild,t)},children:function(t){return n.sibling(t.firstChild)},contents:function(t){return n.nodeName(t,"iframe")?t.contentDocument||t.contentWindow.document:n.makeArray(t.childNodes)}},function(t,e){n.fn[t]=function(i,o){var s=n.map(this,e,i),r=I.call(arguments);return E.test(t)||(o=i),o&&"string"==typeof o&&(s=n.filter(o,s)),s=this.length>1&&!R[t]?n.unique(s):s,(this.length>1||D.test(o))&&N.test(t)&&(s=s.reverse()),this.pushStack(s,t,r.join(","))}}),n.extend({filter:function(t,e,i){return i&&(t=":not("+t+")"),1===e.length?n.find.matchesSelector(e[0],t)?[e[0]]:[]:n.find.matches(t,e)},dir:function(t,i,o){for(var s=[],r=t[i];r&&9!==r.nodeType&&(o===e||1!==r.nodeType||!n(r).is(o));)1===r.nodeType&&s.push(r),r=r[i];return s},nth:function(t,e,i,n){e=e||1;for(var o=0;t&&(1!==t.nodeType||++o!==e);t=t[i]);return t},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}});var Z=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,H=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Y=/<([\w:]+)/,W=/<tbody/i,U=/<|&#?\w+;/,V=/<(?:script|object|embed|option|style)/i,G=/checked\s*(?:[^=]|=\s*.checked.)/i,q={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};function $(t,e){if(1===e.nodeType&&n.hasData(t)){var i=n.expando,o=n.data(t),s=n.data(e,o);if(o=o[i]){var r=o.events;if(s=s[i]=n.extend({},o),r)for(var a in delete s.handle,s.events={},r)for(var l=0,h=r[a].length;l<h;l++)n.event.add(e,a+(r[a][l].namespace?".":"")+r[a][l].namespace,r[a][l],r[a][l].data)}}}function J(t,e){if(1===e.nodeType){var i=e.nodeName.toLowerCase();e.clearAttributes(),e.mergeAttributes(t),"object"===i?e.outerHTML=t.outerHTML:"input"!==i||"checkbox"!==t.type&&"radio"!==t.type?"option"===i?e.selected=t.defaultSelected:"input"!==i&&"textarea"!==i||(e.defaultValue=t.defaultValue):(t.checked&&(e.defaultChecked=e.checked=t.checked),e.value!==t.value&&(e.value=t.value)),e.removeAttribute(n.expando)}}function K(t){return"getElementsByTagName"in t?t.getElementsByTagName("*"):"querySelectorAll"in t?t.querySelectorAll("*"):[]}function Q(t,e){e.src?n.ajax({url:e.src,async:!1,dataType:"script"}):n.globalEval(e.text||e.textContent||e.innerHTML||""),e.parentNode&&e.parentNode.removeChild(e)}q.optgroup=q.option,q.tbody=q.tfoot=q.colgroup=q.caption=q.thead,q.th=q.td,n.support.htmlSerialize||(q._default=[1,"div<div>","</div>"]),n.fn.extend({text:function(t){return n.isFunction(t)?this.each(function(e){var i=n(this);i.text(t.call(this,e,i.text()))}):"object"!=typeof t&&t!==e?this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(t)):n.text(this)},wrapAll:function(t){if(n.isFunction(t))return this.each(function(e){n(this).wrapAll(t.call(this,e))});if(this[0]){var e=n(t,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstChild&&1===t.firstChild.nodeType;)t=t.firstChild;return t}).append(this)}return this},wrapInner:function(t){return n.isFunction(t)?this.each(function(e){n(this).wrapInner(t.call(this,e))}):this.each(function(){var e=n(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){return this.each(function(){n(this).wrapAll(t)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.appendChild(t)})},prepend:function(){return this.domManip(arguments,!0,function(t){1===this.nodeType&&this.insertBefore(t,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this)});if(arguments.length){var t=n(arguments[0]);return t.push.apply(t,this.toArray()),this.pushStack(t,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(t){this.parentNode.insertBefore(t,this.nextSibling)});if(arguments.length){var t=this.pushStack(this,"after",arguments);return t.push.apply(t,n(arguments[0]).toArray()),t}},remove:function(t,e){for(var i,o=0;null!=(i=this[o]);o++)t&&!n.filter(t,[i]).length||(e||1!==i.nodeType||(n.cleanData(i.getElementsByTagName("*")),n.cleanData([i])),i.parentNode&&i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)for(1===t.nodeType&&n.cleanData(t.getElementsByTagName("*"));t.firstChild;)t.removeChild(t.firstChild);return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map(function(){return n.clone(this,t,e)})},html:function(t){if(t===e)return this[0]&&1===this[0].nodeType?this[0].innerHTML.replace(Z,""):null;if("string"!=typeof t||V.test(t)||!n.support.leadingWhitespace&&X.test(t)||q[(Y.exec(t)||["",""])[1].toLowerCase()])n.isFunction(t)?this.each(function(e){var i=n(this);i.html(t.call(this,e,i.html()))}):this.empty().append(t);else{t=t.replace(H,"<$1></$2>");try{for(var i=0,o=this.length;i<o;i++)1===this[i].nodeType&&(n.cleanData(this[i].getElementsByTagName("*")),this[i].innerHTML=t)}catch(e){this.empty().append(t)}}return this},replaceWith:function(t){return this[0]&&this[0].parentNode?n.isFunction(t)?this.each(function(e){var i=n(this),o=i.html();i.replaceWith(t.call(this,e,o))}):("string"!=typeof t&&(t=n(t).detach()),this.each(function(){var e=this.nextSibling,i=this.parentNode;n(this).remove(),e?n(e).before(t):n(i).append(t)})):this.pushStack(n(n.isFunction(t)?t():t),"replaceWith",t)},detach:function(t){return this.remove(t,!0)},domManip:function(t,i,o){var s,r,a,l,h,c=t[0],u=[];if(!n.support.checkClone&&3===arguments.length&&"string"==typeof c&&G.test(c))return this.each(function(){n(this).domManip(t,i,o,!0)});if(n.isFunction(c))return this.each(function(s){var r=n(this);t[0]=c.call(this,s,i?r.html():e),r.domManip(t,i,o)});if(this[0]){if(l=c&&c.parentNode,r=1===(a=(s=n.support.parentNode&&l&&11===l.nodeType&&l.childNodes.length===this.length?{fragment:l}:n.buildFragment(t,this,u)).fragment).childNodes.length?a=a.firstChild:a.firstChild){i=i&&n.nodeName(r,"tr");for(var d=0,p=this.length,f=p-1;d<p;d++)o.call(i?(h=this[d],r,n.nodeName(h,"table")?h.getElementsByTagName("tbody")[0]||h.appendChild(h.ownerDocument.createElement("tbody")):h):this[d],s.cacheable||p>1&&d<f?n.clone(a,!0,!0):a)}u.length&&n.each(u,Q)}return this}}),n.buildFragment=function(t,e,o){var s,r,a,l=e&&e[0]?e[0].ownerDocument||e[0]:i;return 1===t.length&&"string"==typeof t[0]&&t[0].length<512&&l===i&&"<"===t[0].charAt(0)&&!V.test(t[0])&&(n.support.checkClone||!G.test(t[0]))&&(r=!0,(a=n.fragments[t[0]])&&1!==a&&(s=a)),s||(s=l.createDocumentFragment(),n.clean(t,l,s,o)),r&&(n.fragments[t[0]]=a?s:1),{fragment:s,cacheable:r}},n.fragments={},n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){n.fn[t]=function(i){var o=[],s=n(i),r=1===this.length&&this[0].parentNode;if(r&&11===r.nodeType&&1===r.childNodes.length&&1===s.length)return s[e](this[0]),this;for(var a=0,l=s.length;a<l;a++){var h=(a>0?this.clone(!0):this).get();n(s[a])[e](h),o=o.concat(h)}return this.pushStack(o,t,s.selector)}}),n.extend({clone:function(t,e,i){var o,s,r,a=t.cloneNode(!0);if(!(n.support.noCloneEvent&&n.support.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||n.isXMLDoc(t)))for(J(t,a),o=K(t),s=K(a),r=0;o[r];++r)J(o[r],s[r]);if(e&&($(t,a),i))for(o=K(t),s=K(a),r=0;o[r];++r)$(o[r],s[r]);return a},clean:function(t,e,o,s){void 0===(e=e||i).createElement&&(e=e.ownerDocument||e[0]&&e[0].ownerDocument||i);for(var r,a=[],l=0;null!=(r=t[l]);l++)if("number"==typeof r&&(r+=""),r){if("string"!=typeof r||U.test(r)){if("string"==typeof r){r=r.replace(H,"<$1></$2>");var h=(Y.exec(r)||["",""])[1].toLowerCase(),c=q[h]||q._default,u=c[0],d=e.createElement("div");for(d.innerHTML=c[1]+r+c[2];u--;)d=d.lastChild;if(!n.support.tbody)for(var p=W.test(r),f="table"!==h||p?"<table>"!==c[1]||p?[]:d.childNodes:d.firstChild&&d.firstChild.childNodes,m=f.length-1;m>=0;--m)n.nodeName(f[m],"tbody")&&!f[m].childNodes.length&&f[m].parentNode.removeChild(f[m]);!n.support.leadingWhitespace&&X.test(r)&&d.insertBefore(e.createTextNode(X.exec(r)[0]),d.firstChild),r=d.childNodes}}else r=e.createTextNode(r);r.nodeType?a.push(r):a=n.merge(a,r)}if(o)for(l=0;a[l];l++)!s||!n.nodeName(a[l],"script")||a[l].type&&"text/javascript"!==a[l].type.toLowerCase()?(1===a[l].nodeType&&a.splice.apply(a,[l+1,0].concat(n.makeArray(a[l].getElementsByTagName("script")))),o.appendChild(a[l])):s.push(a[l].parentNode?a[l].parentNode.removeChild(a[l]):a[l]);return a},cleanData:function(t){for(var e,i,o,s=n.cache,r=n.expando,a=n.event.special,l=n.support.deleteExpando,h=0;null!=(o=t[h]);h++)if((!o.nodeName||!n.noData[o.nodeName.toLowerCase()])&&(i=o[n.expando])){if((e=s[i]&&s[i][r])&&e.events){for(var c in e.events)a[c]?n.event.remove(o,c):n.removeEvent(o,c,e.handle);e.handle&&(e.handle.elem=null)}l?delete o[n.expando]:o.removeAttribute&&o.removeAttribute(n.expando),delete s[i]}}});var tt,et,it,nt=/alpha\([^)]*\)/i,ot=/opacity=([^)]*)/,st=/-([a-z])/gi,rt=/([A-Z])/g,at=/^-?\d+(?:px)?$/i,lt=/^-?\d/,ht={position:"absolute",visibility:"hidden",display:"block"},ct=["Left","Right"],ut=["Top","Bottom"],dt=function(t,e){return e.toUpperCase()};function pt(t,e,i){var o="width"===e?ct:ut,s="width"===e?t.offsetWidth:t.offsetHeight;return"border"===i?s:(n.each(o,function(){i||(s-=parseFloat(n.css(t,"padding"+this))||0),"margin"===i?s+=parseFloat(n.css(t,"margin"+this))||0:s-=parseFloat(n.css(t,"border"+this+"Width"))||0}),s)}n.fn.css=function(t,i){return 2===arguments.length&&i===e?this:n.access(this,t,i,!0,function(t,i,o){return o!==e?n.style(t,i,o):n.css(t,i)})},n.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=tt(t,"opacity","opacity");return""===i?"1":i}return t.style.opacity}}},cssNumber:{zIndex:!0,fontWeight:!0,opacity:!0,zoom:!0,lineHeight:!0},cssProps:{float:n.support.cssFloat?"cssFloat":"styleFloat"},style:function(t,i,o,s){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,a=n.camelCase(i),l=t.style,h=n.cssHooks[a];if(i=n.cssProps[a]||a,o===e)return h&&"get"in h&&(r=h.get(t,!1,s))!==e?r:l[i];if(!("number"==typeof o&&isNaN(o)||null==o||("number"!=typeof o||n.cssNumber[a]||(o+="px"),h&&"set"in h&&(o=h.set(t,o))===e)))try{l[i]=o}catch(t){}}},css:function(t,i,o){var s,r=n.camelCase(i),a=n.cssHooks[r];return i=n.cssProps[r]||r,a&&"get"in a&&(s=a.get(t,!0,o))!==e?s:tt?tt(t,i,r):void 0},swap:function(t,e,i){var n={};for(var o in e)n[o]=t.style[o],t.style[o]=e[o];for(o in i.call(t),e)t.style[o]=n[o]},camelCase:function(t){return t.replace(st,dt)}}),n.curCSS=n.css,n.each(["height","width"],function(t,e){n.cssHooks[e]={get:function(t,i,o){var s;if(i)return 0!==t.offsetWidth?s=pt(t,e,o):n.swap(t,ht,function(){s=pt(t,e,o)}),s<=0&&("0px"===(s=tt(t,e,e))&&it&&(s=it(t,e,e)),null!=s)?""===s||"auto"===s?"0px":s:s<0||null==s?""===(s=t.style[e])||"auto"===s?"0px":s:"string"==typeof s?s:s+"px"},set:function(t,e){return at.test(e)?(e=parseFloat(e))>=0?e+"px":void 0:e}}}),n.support.opacity||(n.cssHooks.opacity={get:function(t,e){return ot.test((e&&t.currentStyle?t.currentStyle.filter:t.style.filter)||"")?parseFloat(RegExp.$1)/100+"":e?"1":""},set:function(t,e){var i=t.style;i.zoom=1;var o=n.isNaN(e)?"":"alpha(opacity="+100*e+")",s=i.filter||"";i.filter=nt.test(s)?s.replace(nt,o):i.filter+" "+o}}),i.defaultView&&i.defaultView.getComputedStyle&&(et=function(t,i,o){var s,r,a;return o=o.replace(rt,"-$1").toLowerCase(),(r=t.ownerDocument.defaultView)?((a=r.getComputedStyle(t,null))&&(""!==(s=a.getPropertyValue(o))||n.contains(t.ownerDocument.documentElement,t)||(s=n.style(t,o))),s):e}),i.documentElement.currentStyle&&(it=function(t,e){var i,n=t.currentStyle&&t.currentStyle[e],o=t.runtimeStyle&&t.runtimeStyle[e],s=t.style;return!at.test(n)&&lt.test(n)&&(i=s.left,o&&(t.runtimeStyle.left=t.currentStyle.left),s.left="fontSize"===e?"1em":n||0,n=s.pixelLeft+"px",s.left=i,o&&(t.runtimeStyle.left=o)),""===n?"auto":n}),tt=et||it,n.expr&&n.expr.filters&&(n.expr.filters.hidden=function(t){var e=t.offsetWidth,i=t.offsetHeight;return 0===e&&0===i||!n.support.reliableHiddenOffsets&&"none"===(t.style.display||n.css(t,"display"))},n.expr.filters.visible=function(t){return!n.expr.filters.hidden(t)});var ft,mt,gt=/%20/g,vt=/\[\]$/,yt=/\r?\n/g,_t=/#.*$/,bt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,wt=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,xt=/^(?:GET|HEAD)$/,Tt=/^\/\//,St=/\?/,kt=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Lt=/^(?:select|textarea)/i,Ct=/\s+/,Mt=/([?&])_=[^&]*/,At=/(^|\-)([a-z])/g,Pt=function(t,e,i){return e+i.toUpperCase()},zt=/^([\w\+\.\-]+:)\/\/([^\/?#:]*)(?::(\d+))?/,Et=n.fn.load,Nt={},Dt={};try{ft=i.location.href}catch(t){(ft=i.createElement("a")).href="",ft=ft.href}function Ot(t){return function(e,i){if("string"!=typeof e&&(i=e,e="*"),n.isFunction(i))for(var o,s,r=e.toLowerCase().split(Ct),a=0,l=r.length;a<l;a++)o=r[a],(s=/^\+/.test(o))&&(o=o.substr(1)||"*"),(t[o]=t[o]||[])[s?"unshift":"push"](i)}}function It(t,i,n,o,s,r){(r=r||{})[s=s||i.dataTypes[0]]=!0;for(var a,l=t[s],h=0,c=l?l.length:0,u=t===Nt;h<c&&(u||!a);h++)"string"==typeof(a=l[h](i,n,o))&&(!u||r[a]?a=e:(i.dataTypes.unshift(a),a=It(t,i,n,o,a,r)));return!u&&a||r["*"]||(a=It(t,i,n,o,"*",r)),a}function Ft(t,e,i,o){if(n.isArray(e)&&e.length)n.each(e,function(e,s){i||vt.test(t)?o(t,s):Ft(t+"["+("object"==typeof s||n.isArray(s)?e:"")+"]",s,i,o)});else if(i||null==e||"object"!=typeof e)o(t,e);else if(n.isArray(e)||n.isEmptyObject(e))o(t,"");else for(var s in e)Ft(t+"["+s+"]",e[s],i,o)}mt=zt.exec(ft.toLowerCase()),n.fn.extend({load:function(t,i,o){if("string"!=typeof t&&Et)return Et.apply(this,arguments);if(!this.length)return this;var s=t.indexOf(" ");if(s>=0){var r=t.slice(s,t.length);t=t.slice(0,s)}var a="GET";i&&(n.isFunction(i)?(o=i,i=e):"object"==typeof i&&(i=n.param(i,n.ajaxSettings.traditional),a="POST"));var l=this;return n.ajax({url:t,type:a,dataType:"html",data:i,complete:function(t,e,i){i=t.responseText,t.isResolved()&&(t.done(function(t){i=t}),l.html(r?n("<div>").append(i.replace(kt,"")).find(r):i)),o&&l.each(o,[i,e,t])}}),this},serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?n.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Lt.test(this.nodeName)||wt.test(this.type))}).map(function(t,e){var i=n(this).val();return null==i?null:n.isArray(i)?n.map(i,function(t,i){return{name:e.name,value:t.replace(yt,"\r\n")}}):{name:e.name,value:i.replace(yt,"\r\n")}}).get()}}),n.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(t,e){n.fn[e]=function(t){return this.bind(e,t)}}),n.each(["get","post"],function(t,i){n[i]=function(t,o,s,r){return n.isFunction(o)&&(r=r||s,s=o,o=e),n.ajax({type:i,url:t,data:o,success:s,dataType:r})}}),n.extend({getScript:function(t,i){return n.get(t,e,i,"script")},getJSON:function(t,e,i){return n.get(t,e,i,"json")},ajaxSetup:function(t,e){for(var i in e?n.extend(!0,t,n.ajaxSettings,e):(e=t,t=n.extend(!0,n.ajaxSettings,e)),{context:1,url:1})i in e?t[i]=e[i]:i in n.ajaxSettings&&(t[i]=n.ajaxSettings[i]);return t},ajaxSettings:{url:ft,isLocal:/(?:^file|^widget|\-extension):$/.test(mt[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":t.String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML}},ajaxPrefilter:Ot(Nt),ajaxTransport:Ot(Dt),ajax:function(t,i){"object"==typeof t&&(i=t,t=e),i=i||{};var o,s,r,a,l,h,c,u,d=n.ajaxSetup({},i),p=d.context||d,f=p!==d&&(p.nodeType||p instanceof n)?n(p):n.event,m=n.Deferred(),g=n._Deferred(),v=d.statusCode||{},y={},_=0,b={readyState:0,setRequestHeader:function(t,e){return _||(y[t.toLowerCase().replace(At,Pt)]=e),this},getAllResponseHeaders:function(){return 2===_?s:null},getResponseHeader:function(t){var i;if(2===_){if(!r)for(r={};i=bt.exec(s);)r[i[1].toLowerCase()]=i[2];i=r[t.toLowerCase()]}return i===e?null:i},overrideMimeType:function(t){return _||(d.mimeType=t),this},abort:function(t){return t=t||"abort",a&&a.abort(t),w(0,t),this}};function w(t,i,r,h){if(2!==_){_=2,l&&clearTimeout(l),a=e,s=h||"",b.readyState=t?4:0;var u,y,w,x,T,S=r?function(t,i,n){var o,s,r,a,l=t.contents,h=t.dataTypes,c=t.responseFields;for(s in c)s in n&&(i[c[s]]=n[s]);for(;"*"===h[0];)h.shift(),o===e&&(o=t.mimeType||i.getResponseHeader("content-type"));if(o)for(s in l)if(l[s]&&l[s].test(o)){h.unshift(s);break}if(h[0]in n)r=h[0];else{for(s in n){if(!h[0]||t.converters[s+" "+h[0]]){r=s;break}a||(a=s)}r=r||a}if(r)return r!==h[0]&&h.unshift(r),n[r]}(d,b,r):e;if(t>=200&&t<300||304===t)if(d.ifModified&&((x=b.getResponseHeader("Last-Modified"))&&(n.lastModified[o]=x),(T=b.getResponseHeader("Etag"))&&(n.etag[o]=T)),304===t)i="notmodified",u=!0;else try{y=function(t,i){t.dataFilter&&(i=t.dataFilter(i,t.dataType));var o,s,r,a,l,h,c,u,d=t.dataTypes,p={},f=d.length,m=d[0];for(o=1;o<f;o++){if(1===o)for(s in t.converters)"string"==typeof s&&(p[s.toLowerCase()]=t.converters[s]);if(a=m,"*"===(m=d[o]))m=a;else if("*"!==a&&a!==m){if(!(h=p[l=a+" "+m]||p["* "+m]))for(c in u=e,p)if(((r=c.split(" "))[0]===a||"*"===r[0])&&(u=p[r[1]+" "+m])){!0===(c=p[c])?h=u:!0===u&&(h=c);break}h||u||n.error("No conversion from "+l.replace(" "," to ")),!0!==h&&(i=h?h(i):u(c(i)))}}return i}(d,S),i="success",u=!0}catch(t){i="parsererror",w=t}else w=i,i&&!t||(i="error",t<0&&(t=0));b.status=t,b.statusText=i,u?m.resolveWith(p,[y,i,b]):m.rejectWith(p,[b,i,w]),b.statusCode(v),v=e,c&&f.trigger("ajax"+(u?"Success":"Error"),[b,d,u?y:w]),g.resolveWith(p,[b,i]),c&&(f.trigger("ajaxComplete",[b,d]),--n.active||n.event.trigger("ajaxStop"))}}if(m.promise(b),b.success=b.done,b.error=b.fail,b.complete=g.done,b.statusCode=function(t){var e;if(t)if(_<2)for(e in t)v[e]=[v[e],t[e]];else e=t[b.status],b.then(e,e);return this},d.url=((t||d.url)+"").replace(_t,"").replace(Tt,mt[1]+"//"),d.dataTypes=n.trim(d.dataType||"*").toLowerCase().split(Ct),d.crossDomain||(h=zt.exec(d.url.toLowerCase()),d.crossDomain=!(!h||h[1]==mt[1]&&h[2]==mt[2]&&(h[3]||("http:"===h[1]?80:443))==(mt[3]||("http:"===mt[1]?80:443)))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=n.param(d.data,d.traditional)),It(Nt,d,i,b),2===_)return!1;if(c=d.global,d.type=d.type.toUpperCase(),d.hasContent=!xt.test(d.type),c&&0==n.active++&&n.event.trigger("ajaxStart"),!d.hasContent&&(d.data&&(d.url+=(St.test(d.url)?"&":"?")+d.data),o=d.url,!1===d.cache)){var x=n.now(),T=d.url.replace(Mt,"$1_="+x);d.url=T+(T===d.url?(St.test(d.url)?"&":"?")+"_="+x:"")}for(u in(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&(y["Content-Type"]=d.contentType),d.ifModified&&(o=o||d.url,n.lastModified[o]&&(y["If-Modified-Since"]=n.lastModified[o]),n.etag[o]&&(y["If-None-Match"]=n.etag[o])),y.Accept=d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", */*; q=0.01":""):d.accepts["*"],d.headers)b.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(!1===d.beforeSend.call(p,b,d)||2===_))return b.abort(),!1;for(u in{success:1,error:1,complete:1})b[u](d[u]);if(a=It(Dt,d,i,b)){b.readyState=1,c&&f.trigger("ajaxSend",[b,d]),d.async&&d.timeout>0&&(l=setTimeout(function(){b.abort("timeout")},d.timeout));try{_=1,a.send(y,w)}catch(t){status<2?w(-1,t):n.error(t)}}else w(-1,"No Transport");return b},param:function(t,i){var o=[],s=function(t,e){e=n.isFunction(e)?e():e,o[o.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(i===e&&(i=n.ajaxSettings.traditional),n.isArray(t)||t.jquery&&!n.isPlainObject(t))n.each(t,function(){s(this.name,this.value)});else for(var r in t)Ft(r,t[r],i,s);return o.join("&").replace(gt,"+")}}),n.extend({active:0,lastModified:{},etag:{}});var Rt=n.now(),jt=/(\=)\?(&|$)|()\?\?()/i;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return n.expando+"_"+Rt++}}),n.ajaxPrefilter("json jsonp",function(e,i,o){var s="string"==typeof e.data;if("jsonp"===e.dataTypes[0]||i.jsonpCallback||null!=i.jsonp||!1!==e.jsonp&&(jt.test(e.url)||s&&jt.test(e.data))){var r,a=e.jsonpCallback=n.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,l=t[a],h=e.url,c=e.data,u="$1"+a+"$2",d=function(){t[a]=l,r&&n.isFunction(l)&&t[a](r[0])};return!1!==e.jsonp&&(h=h.replace(jt,u),e.url===h&&(s&&(c=c.replace(jt,u)),e.data===c&&(h+=(/\?/.test(h)?"&":"?")+e.jsonp+"="+a))),e.url=h,e.data=c,t[a]=function(t){r=[t]},o.then(d,d),e.converters["script json"]=function(){return r||n.error(a+" was not called"),r[0]},e.dataTypes[0]="json","script"}}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(t){return n.globalEval(t),t}}}),n.ajaxPrefilter("script",function(t){t.cache===e&&(t.cache=!1),t.crossDomain&&(t.type="GET",t.global=!1)}),n.ajaxTransport("script",function(t){if(t.crossDomain){var n,o=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,r){(n=i.createElement("script")).async="async",t.scriptCharset&&(n.charset=t.scriptCharset),n.src=t.url,n.onload=n.onreadystatechange=function(t,i){n.readyState&&!/loaded|complete/.test(n.readyState)||(n.onload=n.onreadystatechange=null,o&&n.parentNode&&o.removeChild(n),n=e,i||r(200,"success"))},o.insertBefore(n,o.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Bt,Zt,Xt=n.now();function Ht(){try{return new t.XMLHttpRequest}catch(t){}}n.ajaxSettings.xhr=t.ActiveXObject?function(){return!this.isLocal&&Ht()||function(){try{return new t.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}()}:Ht,Zt=n.ajaxSettings.xhr(),n.support.ajax=!!Zt,n.support.cors=Zt&&"withCredentials"in Zt,Zt=e,n.support.ajax&&n.ajaxTransport(function(i){var o;if(!i.crossDomain||n.support.cors)return{send:function(s,r){var a,l,h=i.xhr();if(i.username?h.open(i.type,i.url,i.async,i.username,i.password):h.open(i.type,i.url,i.async),i.xhrFields)for(l in i.xhrFields)h[l]=i.xhrFields[l];i.mimeType&&h.overrideMimeType&&h.overrideMimeType(i.mimeType),i.crossDomain&&!i.hasContent||s["X-Requested-With"]||(s["X-Requested-With"]="XMLHttpRequest");try{for(l in s)h.setRequestHeader(l,s[l])}catch(t){}h.send(i.hasContent&&i.data||null),o=function(t,s){var l,c,u,d,p;try{if(o&&(s||4===h.readyState))if(o=e,a&&(h.onreadystatechange=n.noop,delete Bt[a]),s)4!==h.readyState&&h.abort();else{l=h.status,u=h.getAllResponseHeaders(),d={},(p=h.responseXML)&&p.documentElement&&(d.xml=p),d.text=h.responseText;try{c=h.statusText}catch(t){c=""}l||!i.isLocal||i.crossDomain?1223===l&&(l=204):l=d.text?200:404}}catch(t){s||r(-1,t)}d&&r(l,c,d,u)},i.async&&4!==h.readyState?(Bt||(Bt={},n(t).unload(function(){for(var t in Bt)Bt[t](0,1)})),a=Xt++,h.onreadystatechange=Bt[a]=o):o()},abort:function(){o&&o(0,1)}}});var Yt,Wt={},Ut=/^(?:toggle|show|hide)$/,Vt=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,Gt=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function qt(t,e){var i={};return n.each(Gt.concat.apply([],Gt.slice(0,e)),function(){i[this]=t}),i}function $t(t){if(!Wt[t]){var e=n("<"+t+">").appendTo("body"),i=e.css("display");e.remove(),"none"!==i&&""!==i||(i="block"),Wt[t]=i}return Wt[t]}n.fn.extend({show:function(t,e,i){var o,s;if(t||0===t)return this.animate(qt("show",3),t,e,i);for(var r=0,a=this.length;r<a;r++)s=(o=this[r]).style.display,n._data(o,"olddisplay")||"none"!==s||(s=o.style.display=""),""===s&&"none"===n.css(o,"display")&&n._data(o,"olddisplay",$t(o.nodeName));for(r=0;r<a;r++)""!==(s=(o=this[r]).style.display)&&"none"!==s||(o.style.display=n._data(o,"olddisplay")||"");return this},hide:function(t,e,i){if(t||0===t)return this.animate(qt("hide",3),t,e,i);for(var o=0,s=this.length;o<s;o++){var r=n.css(this[o],"display");"none"===r||n._data(this[o],"olddisplay")||n._data(this[o],"olddisplay",r)}for(o=0;o<s;o++)this[o].style.display="none";return this},_toggle:n.fn.toggle,toggle:function(t,e,i){var o="boolean"==typeof t;return n.isFunction(t)&&n.isFunction(e)?this._toggle.apply(this,arguments):null==t||o?this.each(function(){var e=o?t:n(this).is(":hidden");n(this)[e?"show":"hide"]()}):this.animate(qt("toggle",3),t,e,i),this},fadeTo:function(t,e,i,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,o){var s=n.speed(e,i,o);return n.isEmptyObject(t)?this.each(s.complete):this[!1===s.queue?"each":"queue"](function(){var e,i=n.extend({},s),o=1===this.nodeType,r=o&&n(this).is(":hidden"),a=this;for(e in t){var l=n.camelCase(e);if(e!==l&&(t[l]=t[e],delete t[e],e=l),"hide"===t[e]&&r||"show"===t[e]&&!r)return i.complete.call(this);if(o&&("height"===e||"width"===e))if(i.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],"inline"===n.css(this,"display")&&"none"===n.css(this,"float"))if(n.support.inlineBlockNeedsLayout)"inline"===$t(this.nodeName)?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1);else this.style.display="inline-block";n.isArray(t[e])&&((i.specialEasing=i.specialEasing||{})[e]=t[e][1],t[e]=t[e][0])}return null!=i.overflow&&(this.style.overflow="hidden"),i.curAnim=n.extend({},t),n.each(t,function(e,o){var s=new n.fx(a,i,e);if(Ut.test(o))s["toggle"===o?r?"show":"hide":o](t);else{var l=Vt.exec(o),h=s.cur();if(l){var c=parseFloat(l[2]),u=l[3]||(n.cssNumber[e]?"":"px");"px"!==u&&(n.style(a,e,(c||1)+u),h=(c||1)/s.cur()*h,n.style(a,e,h+u)),l[1]&&(c=("-="===l[1]?-1:1)*c+h),s.custom(h,c,u)}else s.custom(h,o,"")}}),!0})},stop:function(t,e){var i=n.timers;return t&&this.queue([]),this.each(function(){for(var t=i.length-1;t>=0;t--)i[t].elem===this&&(e&&i[t](!0),i.splice(t,1))}),e||this.dequeue(),this}}),n.each({slideDown:qt("show",1),slideUp:qt("hide",1),slideToggle:qt("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){n.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}}),n.extend({speed:function(t,e,i){var o=t&&"object"==typeof t?n.extend({},t):{complete:i||!i&&e||n.isFunction(t)&&t,duration:t,easing:i&&e||e&&!n.isFunction(e)&&e};return o.duration=n.fx.off?0:"number"==typeof o.duration?o.duration:o.duration in n.fx.speeds?n.fx.speeds[o.duration]:n.fx.speeds._default,o.old=o.complete,o.complete=function(){!1!==o.queue&&n(this).dequeue(),n.isFunction(o.old)&&o.old.call(this)},o},easing:{linear:function(t,e,i,n){return i+n*t},swing:function(t,e,i,n){return(-Math.cos(t*Math.PI)/2+.5)*n+i}},timers:[],fx:function(t,e,i){this.options=e,this.elem=t,this.prop=i,e.orig||(e.orig={})}}),n.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(n.fx.step[this.prop]||n.fx.step._default)(this)},cur:function(){if(null!=this.elem[this.prop]&&(!this.elem.style||null==this.elem.style[this.prop]))return this.elem[this.prop];var t,e=n.css(this.elem,this.prop);return isNaN(t=parseFloat(e))?e&&"auto"!==e?e:0:t},custom:function(t,e,i){var o=this,s=n.fx;function r(t){return o.step(t)}this.startTime=n.now(),this.start=t,this.end=e,this.unit=i||this.unit||(n.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,r.elem=this.elem,r()&&n.timers.push(r)&&!Yt&&(Yt=setInterval(s.tick,s.interval))},show:function(){this.options.orig[this.prop]=n.style(this.elem,this.prop),this.options.show=!0,this.custom("width"===this.prop||"height"===this.prop?1:0,this.cur()),n(this.elem).show()},hide:function(){this.options.orig[this.prop]=n.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(t){var e=n.now(),i=!0;if(t||e>=this.options.duration+this.startTime){for(var o in this.now=this.end,this.pos=this.state=1,this.update(),this.options.curAnim[this.prop]=!0,this.options.curAnim)!0!==this.options.curAnim[o]&&(i=!1);if(i){if(null!=this.options.overflow&&!n.support.shrinkWrapBlocks){var s=this.elem,r=this.options;n.each(["","X","Y"],function(t,e){s.style["overflow"+e]=r.overflow[t]})}if(this.options.hide&&n(this.elem).hide(),this.options.hide||this.options.show)for(var a in this.options.curAnim)n.style(this.elem,a,this.options.orig[a]);this.options.complete.call(this.elem)}return!1}var l=e-this.startTime;this.state=l/this.options.duration;var h=this.options.specialEasing&&this.options.specialEasing[this.prop],c=this.options.easing||(n.easing.swing?"swing":"linear");return this.pos=n.easing[h||c](this.state,l,0,1,this.options.duration),this.now=this.start+(this.end-this.start)*this.pos,this.update(),!0}},n.extend(n.fx,{tick:function(){for(var t=n.timers,e=0;e<t.length;e++)t[e]()||t.splice(e--,1);t.length||n.fx.stop()},interval:13,stop:function(){clearInterval(Yt),Yt=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(t){n.style(t.elem,"opacity",t.now)},_default:function(t){t.elem.style&&null!=t.elem.style[t.prop]?t.elem.style[t.prop]=("width"===t.prop||"height"===t.prop?Math.max(0,t.now):t.now)+t.unit:t.elem[t.prop]=t.now}}}),n.expr&&n.expr.filters&&(n.expr.filters.animated=function(t){return n.grep(n.timers,function(e){return t===e.elem}).length});var Jt=/^t(?:able|d|h)$/i,Kt=/^(?:body|html)$/i;function Qt(t){return n.isWindow(t)?t:9===t.nodeType&&(t.defaultView||t.parentWindow)}"getBoundingClientRect"in i.documentElement?n.fn.offset=function(t){var e,i=this[0];if(t)return this.each(function(e){n.offset.setOffset(this,t,e)});if(!i||!i.ownerDocument)return null;if(i===i.ownerDocument.body)return n.offset.bodyOffset(i);try{e=i.getBoundingClientRect()}catch(t){}var o=i.ownerDocument,s=o.documentElement;if(!e||!n.contains(s,i))return e?{top:e.top,left:e.left}:{top:0,left:0};var r=o.body,a=Qt(o),l=s.clientTop||r.clientTop||0,h=s.clientLeft||r.clientLeft||0,c=a.pageYOffset||n.support.boxModel&&s.scrollTop||r.scrollTop,u=a.pageXOffset||n.support.boxModel&&s.scrollLeft||r.scrollLeft;return{top:e.top+c-l,left:e.left+u-h}}:n.fn.offset=function(t){var e=this[0];if(t)return this.each(function(e){n.offset.setOffset(this,t,e)});if(!e||!e.ownerDocument)return null;if(e===e.ownerDocument.body)return n.offset.bodyOffset(e);n.offset.initialize();for(var i,o=e.offsetParent,s=e.ownerDocument,r=s.documentElement,a=s.body,l=s.defaultView,h=l?l.getComputedStyle(e,null):e.currentStyle,c=e.offsetTop,u=e.offsetLeft;(e=e.parentNode)&&e!==a&&e!==r&&(!n.offset.supportsFixedPosition||"fixed"!==h.position);)i=l?l.getComputedStyle(e,null):e.currentStyle,c-=e.scrollTop,u-=e.scrollLeft,e===o&&(c+=e.offsetTop,u+=e.offsetLeft,!n.offset.doesNotAddBorder||n.offset.doesAddBorderForTableAndCells&&Jt.test(e.nodeName)||(c+=parseFloat(i.borderTopWidth)||0,u+=parseFloat(i.borderLeftWidth)||0),o,o=e.offsetParent),n.offset.subtractsBorderForOverflowNotVisible&&"visible"!==i.overflow&&(c+=parseFloat(i.borderTopWidth)||0,u+=parseFloat(i.borderLeftWidth)||0),h=i;return"relative"!==h.position&&"static"!==h.position||(c+=a.offsetTop,u+=a.offsetLeft),n.offset.supportsFixedPosition&&"fixed"===h.position&&(c+=Math.max(r.scrollTop,a.scrollTop),u+=Math.max(r.scrollLeft,a.scrollLeft)),{top:c,left:u}},n.offset={initialize:function(){var t,e,o,s=i.body,r=i.createElement("div"),a=parseFloat(n.css(s,"marginTop"))||0;n.extend(r.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),r.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>",s.insertBefore(r,s.firstChild),e=(t=r.firstChild).firstChild,o=t.nextSibling.firstChild.firstChild,this.doesNotAddBorder=5!==e.offsetTop,this.doesAddBorderForTableAndCells=5===o.offsetTop,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=20===e.offsetTop||15===e.offsetTop,e.style.position=e.style.top="",t.style.overflow="hidden",t.style.position="relative",this.subtractsBorderForOverflowNotVisible=-5===e.offsetTop,this.doesNotIncludeMarginInBodyOffset=s.offsetTop!==a,s.removeChild(r),s=r=t=e=o=null,n.offset.initialize=n.noop},bodyOffset:function(t){var e=t.offsetTop,i=t.offsetLeft;return n.offset.initialize(),n.offset.doesNotIncludeMarginInBodyOffset&&(e+=parseFloat(n.css(t,"marginTop"))||0,i+=parseFloat(n.css(t,"marginLeft"))||0),{top:e,left:i}},setOffset:function(t,e,i){var o=n.css(t,"position");"static"===o&&(t.style.position="relative");var s,r,a=n(t),l=a.offset(),h=n.css(t,"top"),c=n.css(t,"left"),u="absolute"===o&&n.inArray("auto",[h,c])>-1,d={},p={};u&&(p=a.position()),s=u?p.top:parseInt(h,10)||0,r=u?p.left:parseInt(c,10)||0,n.isFunction(e)&&(e=e.call(t,i,l)),null!=e.top&&(d.top=e.top-l.top+s),null!=e.left&&(d.left=e.left-l.left+r),"using"in e?e.using.call(t,d):a.css(d)}},n.fn.extend({position:function(){if(!this[0])return null;var t=this[0],e=this.offsetParent(),i=this.offset(),o=Kt.test(e[0].nodeName)?{top:0,left:0}:e.offset();return i.top-=parseFloat(n.css(t,"marginTop"))||0,i.left-=parseFloat(n.css(t,"marginLeft"))||0,o.top+=parseFloat(n.css(e[0],"borderTopWidth"))||0,o.left+=parseFloat(n.css(e[0],"borderLeftWidth"))||0,{top:i.top-o.top,left:i.left-o.left}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||i.body;t&&!Kt.test(t.nodeName)&&"static"===n.css(t,"position");)t=t.offsetParent;return t})}}),n.each(["Left","Top"],function(t,i){var o="scroll"+i;n.fn[o]=function(i){var s,r=this[0];return r?i!==e?this.each(function(){(s=Qt(this))?s.scrollTo(t?n(s).scrollLeft():i,t?i:n(s).scrollTop()):this[o]=i}):(s=Qt(r))?"pageXOffset"in s?s[t?"pageYOffset":"pageXOffset"]:n.support.boxModel&&s.document.documentElement[o]||s.document.body[o]:r[o]:null}}),n.each(["Height","Width"],function(t,i){var o=i.toLowerCase();n.fn["inner"+i]=function(){return this[0]?parseFloat(n.css(this[0],o,"padding")):null},n.fn["outer"+i]=function(t){return this[0]?parseFloat(n.css(this[0],o,t?"margin":"border")):null},n.fn[o]=function(t){var s=this[0];if(!s)return null==t?null:this;if(n.isFunction(t))return this.each(function(e){var i=n(this);i[o](t.call(this,e,i[o]()))});if(n.isWindow(s)){var r=s.document.documentElement["client"+i];return"CSS1Compat"===s.document.compatMode&&r||s.document.body["client"+i]||r}if(9===s.nodeType)return Math.max(s.documentElement["client"+i],s.body["scroll"+i],s.documentElement["scroll"+i],s.body["offset"+i],s.documentElement["offset"+i]);if(t===e){var a=n.css(s,o),l=parseFloat(a);return n.isNaN(l)?a:l}return this.css(o,"string"==typeof t?t:t+"px")}}),t.jQuery=t.$=n}(window),function(t){var e=["DOMMouseScroll","mousewheel"];function i(e){var i=e,n=[].slice.call(arguments,1),o=0,s=0,r=0;return(e=t.event.fix(e||window.event)).type="mousewheel",e.wheelDelta&&(o=e.wheelDelta/120),e.detail&&(o=-e.detail/3),r=o,void 0!==i.axis&&i.axis===i.HORIZONTAL_AXIS&&(r=0,s=-1*o),void 0!==i.wheelDeltaY&&(r=i.wheelDeltaY/120),void 0!==i.wheelDeltaX&&(s=-1*i.wheelDeltaX/120),n.unshift(e,o,s,r),t.event.handle.apply(this,n)}t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=e.length;t;)this.addEventListener(e[--t],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var t=e.length;t;)this.removeEventListener(e[--t],i,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(jQuery),function(t,e,i){var n,o=t([]),s=t.resize=t.extend(t.resize,{}),r="setTimeout",a="resize",l=a+"-special-event",h="delay",c="throttleWindow";s[h]=250,s[c]=!0,t.event.special[a]={setup:function(){if(!s[c]&&this[r])return!1;var i=t(this);o=o.add(i),t.data(this,l,{w:i.width(),h:i.height()}),1===o.length&&function i(){n=e[r](function(){o.each(function(){var e=t(this),i=e.width(),n=e.height(),o=t.data(this,l);i===o.w&&n===o.h||e.trigger(a,[o.w=i,o.h=n])}),i()},s[h])}()},teardown:function(){if(!s[c]&&this[r])return!1;var e=t(this);o=o.not(e),e.removeData(l),o.length||clearTimeout(n)},add:function(e){if(!s[c]&&this[r])return!1;var n;function o(e,o,s){var r=t(this),a=t.data(this,l);a.w=o!==i?o:r.width(),a.h=s!==i?s:r.height(),n.apply(this,arguments)}if(t.isFunction(e))return n=e,o;n=e.handler,e.handler=o}}}(jQuery,this);var o="../",s="http://",r={traffic:{"refresh-delay":"30","stop-refresh-delay":"14 * 60"}},a=null,l={route:"route/get.aspx?",rmm:"route/rmm/get.aspx?",descr:"map/1.0/multi-descr",slab:"map/1.0/slab",loc:"loc/get.aspx?"},h={geo:{},geolocation:{},map:{layer:{},shape:{kml:{}},tools:{}},route:{},types:{},ui:{},utils:{}};window.Mappy={},Mappy.api={init:function(i,r,l){if(!i||!r)throw"Missing init parameter";a=r,i,(l=l||{}).ssl&&(s="https://"),o=l.staticPath||"../",n=l.domain||n,t="axe."+n+".net/1v1/",e=["map1."+n+".net/","map2."+n+".net/","map3."+n+".net/","map4."+n+".net/"],h.ui.Icon.DEFAULT.image=h.ui.Icon.DEFAULT.image.replace("undefined",o),h.ui.Icon.VOID.image=h.ui.Icon.VOID.image.replace("undefined",o),Mappy.api=h}},window.Mappy=Mappy;var c=navigator.userAgent.toLowerCase(),u=/iphone/.test(c)||/android/.test(c)||/ipad/.test(c)||/dolfin/.test(c),d=/iphone/.test(c)||/android/.test(c)||/ipad/.test(c)||/dolfin/.test(c),p=/iphone/.test(c)||/ipad/.test(c),f=navigator.platform&&-1!==navigator.platform.indexOf("Mac"),m=[];m[0]="none",m[1]="mot",m[2]="comcar",m[3]="midcar",m[4]="sedcar",m[5]="luxcar",m[6]="van",m[7]="coa",m[8]="lt3.5",m[9]="lt12",m[10]="gt12",m[11]="gt12a",m[12]="ped",m[13]="bike";var g=jQuery.noConflict(!0);g("head").append('<link rel="stylesheet" type="text/css" href="http://webfiles.luxweb.com/js/mappy/css/api-pack.css"></link>'),g.resize.delay=500,g.resize.throttle=!0;var v=g.browser.msie&&g.browser.version<7,y=function(t,e){if(t=t||{},e){for(var i in e){var n=e[i];void 0!==n&&(t[i]=n)}!("function"==typeof window.Event&&e instanceof window.Event)&&e.hasOwnProperty&&e.hasOwnProperty("toString")&&(t.toString=e.toString)}return t},_=h.utils.Class=function(){for(var t,e,i=function(){this.initialize.apply(this,arguments)},n={},o=0,s=arguments.length;o<s;o+=1)"function"==typeof arguments[o]?(0===o&&s>1&&(e=arguments[o].prototype.initialize,arguments[o].prototype.initialize=function(){},n=new arguments[o],arguments[o].prototype.initialize=e),t=arguments[o].prototype):t=arguments[o],y(n,t);return i.prototype=n,i},b=function(t){return null!=t},w=function(t){return null==t},x=function(t,e){return"string"==typeof e&&(e=e.replace(/[\[]/g,".").replace(/[\'\"\]]/g,"").split(".")),b(function(t,e){if("object"==typeof t){var i,n=g.makeArray(e),o=n.length;for(i=0;b(t)&&i<o;i++)t=t[n[i]];return t}}(t,e))},T=function(t,e){return function(){t.apply(e,arguments)}},S=function(t,e){return setTimeout(T(t,e),13)},k=function(t,e){var i=[];for(var n in t)t.hasOwnProperty(n)&&("number"==typeof t[n]||"string"==typeof t[n]?i.push(e+"."+n+"="+t[n]):i.push(k(t[n],e+"."+n)));return i.join("&")},L=h.utils.xml2json=function(t){var e,i="",n={},o=!0;if(b(t.attributes)&&t.attributes.length>0)for(n["@attributes"]={},e=0;e<t.attributes.length;e+=1)n["@attributes"][t.attributes[e].nodeName]=t.attributes[e].value;if(b(t.childNodes)){for(e=0;e<t.childNodes.length;e+=1)b(t.childNodes[e].data)?i+=t.childNodes[e].data:b(n[t.childNodes[e].nodeName])?(o=!1,"string"==typeof n[t.childNodes[e].nodeName]?n[t.childNodes[e].nodeName]=[n[t.childNodes[e].nodeName]]:n[t.childNodes[e].nodeName]=g.makeArray(n[t.childNodes[e].nodeName]),n[t.childNodes[e].nodeName].push(L(t.childNodes[e]))):(o=!1,n[t.childNodes[e].nodeName]=L(t.childNodes[e]));return o?b(n["@attributes"])&&""===i?n:i:n}return n},C=function(t,e){return t.replace(/{([^{}]*)}/g,function(t,i){var n=e[i];return"string"==typeof n||"number"==typeof n?n:t})},M=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},A=h.utils.getAsArray=function(t){return b(t)?g.isArray(t)?t:[t]:[]},P=(h.utils.getJQueryInstance=function(){return g},Math.floor),z=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},E=_({initialize:function(t,e,i){this.name=t,this.handler=e,this.priorityLevel=i||0,this._stopPropatation=!1},stopPropagation:function(){this._stopPropatation=!0},propagationStopped:function(){return!0===this._stopPropatation&&(this._stopPropatation=!1,!0)}}),N=_({EVENTS:null,hasListeners:!1,initialize:function(){this._listeners={};for(var t=0;t<this.EVENTS.length;t+=1)this._listeners[this.EVENTS[t]]=[]},addListener:function(t,e,i){if(g.isArray(this._listeners[t])){var n=new E(t,e,i);return this._listeners[t].push(n),this._arraySort(this._listeners[t]),this.hasListeners=!0,n}return!1},removeListener:function(t){var e=this._listeners;e[t.name]||(e[t.name]=[]);var i=g.inArray(t,e[t.name]);for(var n in-1!==i&&delete e[t.name][i],e)if(e.hasOwnProperty(n)&&e[n].length>0)return void(this.hasListeners=!0);this.hasListeners=!1},clearListeners:function(){this._listeners={};for(var t=0;t<this.EVENTS.length;t+=1)this._listeners[this.EVENTS[t]]=[];this.hasListeners=!1},trigger:function(t){var e=this._listeners[t];if(g.isArray(e)){for(var i=g.makeArray(arguments).slice(1),n=0,o=e.length;n<o&&(void 0===e[n]||(e[n].handler.apply(e[n],i),!b(e[n])||!0!==e[n].propagationStopped()));n+=1);this._listeners[t]=this._arrayFilter(e)}},_arrayFilter:function(t){for(var e=[],i=0;i<t.length;i+=1)void 0!==t[i]&&e.push(t[i]);return e},_arraySort:function(t){t.sort(function(t,e){return void 0!==t&&void 0!==e?e.priorityLevel-t.priorityLevel:0})}}),D=_(N,{EVENTS:["empty"],size:0,_param:null,initialize:function(){N.prototype.initialize.apply(this)},setParam:function(t){this._param=t},addTask:function(){this.size+=1},removeTask:function(){this.size-=1,this.size<=0&&(this.size=0,this.trigger("empty",this._param),this._param=null)}});h.types.Point=function(t,e){t-=0,e-=0,this.x=t,this.y=e};var O=h.types.Point;O.prototype={isNull:function(){return 0===this.x&&0===this.y},hypot:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},dist:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},round:function(){this.x=Math.round(this.x),this.y=Math.round(this.y)},clone:function(){return new O(this.x,this.y)}};var I=h.types.Size=_({initialize:function(t,e){t-=0,e-=0,this.width=t,this.height=e},getCenter:function(){return new O(Math.floor(this.width/2),Math.floor(this.height/2))},hypot:function(){return Math.sqrt(this.width*this.width+this.height*this.height)},isNull:function(){return 0===this.width||0===this.height},clone:function(){return new I(this.width,this.height)}}),F=h.types.Bounds=_({minX:null,minY:null,maxX:null,maxY:null,initialize:function(t,e,i,n){this.minX=t,this.minY=e,this.maxX=i,this.maxY=n},addPoint:function(t){t.x<this.minX&&(this.minX=t.x),t.x>this.maxX&&(this.maxX=t.x),t.y<this.minY&&(this.minY=t.y),t.y>this.maxY&&(this.maxY=t.y)},getSize:function(){return new I(this.maxX-this.minX,this.maxY-this.minY)},inside:function(t){return t.x>=this.minX&&t.x<this.maxX&&t.y>=this.minY&&t.y<this.maxY},intersect:function(t){var e=Math.max(this.minX,t.minX),i=Math.max(this.minY,t.minY),n=Math.min(this.maxX,t.maxX),o=Math.min(this.maxY,t.maxY);return n-e<0||o-i<0?null:new F(e,i,n,o)}});function R(t,e){if(e=e||{},!w(t)){var i,n,s,r,a;w(e.handle)&&(e.handle=t);var l=!1,h=!1;!1===u?(e.handle.click(function(t){l&&(t.stopImmediatePropagation(),l=!1)}),a=function(n){return g(document).unbind("mousemove",r),g(document).unbind("mouseup",a),h=!1,i||(t.css("cursor","url("+o+"img/cursor/openhand.cur), default"),"function"==typeof e.stop&&e.stop(n)),n.stopPropagation(),n.cancelBubble=!0,!1},r=function(s){if(i){"function"==typeof e.start&&e.start(i);var r=t.position();n={left:r.left-i.clientX,top:r.top-i.clientY},t.css("cursor","url("+o+"img/cursor/closedhand.cur), move"),i=null,l=!0,h=!1}return t.css({top:n.top+s.clientY,left:n.left+s.clientX}),"function"==typeof e.drag&&e.drag(s),s.stopPropagation(),s.cancelBubble=!0,!1},t.hackModifyInit=function(t,e){n.left-=t,n.top-=e},s=function(t){if(!h)return h=!0,i=t,g(document).mousemove(r),g(document).mouseup(a),t.stopPropagation(),t.cancelBubble=!0,!1},t.css("position","absolute"),t.css("cursor","url("+o+"img/cursor/openhand.cur), default"),e.handle.bind("mousedown",s),e.handle.bind("dragstart",function(t){return t.stopPropagation(),t.cancelBubble=!0,!1}),t.disableDraggable=function(){t.css("cursor",""),e.handle.unbind("mousedown",s)},t.enableDraggable=function(){t.css("cursor","url("+o+"img/cursor/openhand.cur), default"),e.handle.unbind("mousedown",s),e.handle.bind("mousedown",s)}):(e.handle.click(function(t){i||t.stopImmediatePropagation()}),a=function(t){document.removeEventListener("touchmove",r),document.removeEventListener("touchend",a),i||"function"==typeof e.stop&&(t=t.touches[0],e.stop(t))},r=function(o){if(1===o.touches.length){if(o=o.touches[0],i){"function"==typeof e.start&&e.start(i);var s=t.position();n={left:s.left-i.clientX,top:s.top-i.clientY},i=null}return t.css({top:n.top+o.clientY,left:n.left+o.clientX}),"function"==typeof e.drag&&e.drag(o),!1}o=o.touches[0],a(o)},s=function(t){if(1===t.touches.length)return t.preventDefault(),t=t.touches[0],i=t,document.addEventListener("touchmove",r),document.addEventListener("touchend",a),!1},t.css("position","absolute"),e.handle[0].addEventListener("touchstart",s),t.disableDraggable=function(){e.handle[0].removeEventListener("touchstart",s)},t.enableDraggable=function(){e.handle[0].addEventListener("touchstart",s)})}}function j(t,e,i,n){var o=new Image;g(o).load(function(){return e.src=t,g(o).unbind(),i(e)}),b(n)&&g(o).error(n),o.src=t}function B(t,e){var i=g(t).clone();i.css({visibility:"hidden",position:"absolute",left:0,top:0}),g(document.body).append(i);var n=e?new I(i.outerWidth(!0),i.outerHeight(!0)):new I(i.width(),i.height());return i.remove(),n}function Z(t){t.preventDefault()}var X=h.ui.getHtmlTownSign=function(t){return'<div class="town-sign"><span>'+t+"</span></div>"};function H(t){var e="";t-=0;var i=Math.floor(t/86400);t%=86400;var n=Math.floor(t/3600);t%=3600;var o=Math.floor(t/60);return t%=60,1===i?e+="1 jour ":i>1&&(e+=i+" jours "),e+=n+"h"+(o<10?"0":"")+o}function Y(t,e){var i="";if(e&&"miles"===e)i=(.621371192*parseFloat(t,10)/1e3).toFixed(1)+" mi";else if((n=Math.floor(t/1e3))>9)i=Math.round(t/1e3)+" km";else if(n>0){var n=Math.floor(t/1e3),o=Math.round(t%1e3/100);if(o>9){var s=Math.floor(o/10);o-=10*s,n+=s}i=n,o>0&&(i+=","+o),i+=" km"}else i=(o=Math.round(t%1e3))+" m";return i}var W=h.ui.Icon=_({cssClass:null,image:null,size:null,iconAnchor:null,popUpAnchor:null,label:null,initialize:function(t){this.cssClass=t.cssClass,this.image=t.image,this.size=t.size,this.iconAnchor=t.iconAnchor,this.popUpAnchor=t.popUpAnchor,this.label=t.label,w(this.size)&&this._setSize(),w(this.iconAnchor)&&(this.iconAnchor=this.size.getCenter()),w(this.popUpAnchor)&&(this.popUpAnchor=new O(this.iconAnchor.x,0))},_setSize:function(){var t;b(this.cssClass)&&(t=B('<div class="'+this.cssClass+'"></div>')),(w(t)||t.isNull()&&b(this.image))&&(t=B('<img src="'+this.image+'"></img>')),this.size=t},create:function(t){var e=g(t||"<div></div>");return b(this.cssClass)&&e.addClass(this.cssClass),e.html(this.label),b(this.image)&&e.append('<img style="position:absolute;left:0;top:0;z-index:-1;" src="'+this.image+'"></img>'),e}});h.ui.Icon.DEFAULT={cssClass:"default-icon",image:o+"img/poi/POI_defaut.png",size:new I(21,31),iconAnchor:new O(10,31),popUpAnchor:new O(10,0)},h.ui.Icon.VOID={cssClass:"void-icon",image:o+"img/icon-void.png",size:new I(21,31),iconAnchor:new O(10,31),popUpAnchor:new O(10,0)};var U=h.ui.Slider=_({initialize:function(t){if(!w((t=t||{}).container)){var e=g(t.container),i=g('<div class="slider"></div>');e.append(i);var n=t.stop;this.min=t.min,this.max=t.max,this.steps=this.max-this.min,this.size=e.height(),this.domEventHandlers=[];var o=g('<a class="slider-handler" href="#"/>');this._handler=o;var s=this;o.click(function(t){Z(t)}),o.mousedown(function(t){var e=t.pageY,i=o.position().top+o.height(),r=g(document);s._mousemoveHandler=function(t){var n=s._stepCalc(i+t.pageY-e);s._setStep(n),Z(t)},s._mouseupHandler=function(){r.unbind("mousemove",s._mousemoveHandler),r.unbind("mouseup",s._mouseupHandler),g.isFunction(n)&&n(s._currentStep+s.min)},r.mousemove(s._mousemoveHandler),r.mouseup(s._mouseupHandler),Z(t),t.stopPropagation()}),i.append(o),this._mousedownHandler=function(t){var i=e.offset(),o=s._stepCalc(t.pageY-i.top);s._setStep(o),g.isFunction(n)&&n(s._currentStep+s.min)},e.mousedown(this._mousedownHandler),this.div=i,this.container=e}},_stepCalc:function(t){var e=Math.round((this.size-t)*this.steps/this.size);return e<0&&(e=0),e>this.steps&&(e=this.steps),e},_setStep:function(t){this._handler.css({bottom:100*t/this.steps+"%"}),this._currentStep=t},setValue:function(t){(t=Math.round(t))<this.min&&(t=this.min),t>this.max&&(t=this.max),this._setStep(t-this.min)},destroy:function(){var t=g(document);g.isFunction(this._mousemoveHandler)&&t.unbind("mousemove",this._mousemoveHandler),g.isFunction(this._mouseupHandler)&&t.unbind("mouseup",this._mouseupHandler),this.container.unbind("mousedown",this._mousedownHandler),this.div.remove()}}),V=h.ui.ToolTip=_({div:null,isAdded:!1,TEMPLATE:'<div class="default-tooltip" style="z-index:1000;"></div>',initialize:function(t,e){this.container=t,this.data=e},add:function(t){var e=this.container;this.remove(),div=g(this.TEMPLATE),div.html(this.data),e.append(div),this.div=div;var i=div.outerWidth(!0);div.outerHeight(!0),e=this.container;function n(t){var n="geolayer"===e.attr("name")?e.parent():e,o=e.offset(),s={left:t.pageX-o.left,top:t.pageY-o.top+20,position:"absolute",width:i},r=n.width(),a=n.height(),l=n.offset();t.pageX+i-l.left>r&&(s.left=s.left-i),t.pageY+50-l.top>a&&(s.top-=50),div.css(s)}"click"!=t.type&&"touchend"!=t.type&&g(document).mousemove(n),n(t),this._mouseMoveHandler=n,this.isAdded=!0},remove:function(){this.isAdded&&(g(document).unbind("mousemove",this._mouseMoveHandler),this.div.remove(),delete this.div,this.isAdded=!1)}}),G=h.ui.TcToolTip=_(V,{_nbLinesTypes:0,initialize:function(t,e){G._debug&&window.console&&window.console.log&&console.log("new Mappy.api.ui.TcToolTip() ; data=",e),V.prototype.initialize.call(this,t,e),this._initTcLabel()},_initTcLabel:function(){if(this.data.properties.description.line){var t,e,i,n=this.data.properties.description.line;g.isArray(n)||(n=[n]);var o={M:[],S:[],T:[],TY:[]},s=[];for(t=0,e=n.length;t<e;t++)i=n[t],-1===g.inArray(i.type,s)&&s.push(i.type);for(this._nbLinesTypes=s.length,t=0,e=n.length;t<e;t++)i=n[t],-1!==g.inArray(i.type,s)&&o[i.type].push(this._renderLine(i));var r=[];for(t=0,e=s.length;t<e;t++){var a=s[t];r.push(this._renderLinesBlock(a,o[a]))}var l=["line-name"];l.push(this._nbLinesTypes>1?"multi-line-type":"single-line-type");var h='<span class="tc-tooltip">';h+='<span class="'+l.join(" ")+'">'+this.data.properties.description.label+"</span>",h+=r.join(""),h+='<span class="clearfix"></span>',h+="</span>",this.data=h}else this.data=this.data.properties.description.label},_renderLine:function(t){var e=["roadbook-mm"];switch(t.type){case"M":e.push("roadbook-mm-line","roadbook-mm-line-metro_"+t.num);break;case"S":e.push("roadbook-mm-line","roadbook-mm-line-rer_"+t.num.toLowerCase());break;case"T":e.push("roadbook-mm-line","roadbook-mm-line-train_"+t.num.toLowerCase());break;case"TY":e.push("roadbook-mm-line","roadbook-mm-line-t"+t.num)}var i="";return i+='<li class="'+e.join(" ")+'">',i+='<span class="num">'+t.num+"</span> ",i+="</li>"},_renderLinesBlock:function(t,e){if(0===e.length)return"";var i=["lines","roadbook-mm"];switch(t){case"M":i.push("roadbook-mm-metro");break;case"S":i.push("roadbook-mm-rer");break;case"T":i.push("roadbook-mm-train");break;case"TY":i.push("roadbook-mm-tram")}var n="";return n+='<ul class="lines '+(this._nbLinesTypes>1?"multi":"single")+'">',n+=' <li class="lines-type first '+i.join(" ")+'"></li>',n+=e.join(""),n+="</ul>"}});G._debug=!1;var q=h.geo.Coordinates=_({initialize:function(t,e){t-=0,e-=0,this.x=t>180?180:t<-180?-180:t,this.y=e>90?90:e<-90?-90:e,this.x=t-0,this.y=e-0,$.forward(this)},clone:function(){var t=new q(this.x,this.y);return t._x=this._x,t._y=this._y,t},getDistance:function(t){var e=(t.x-this.x)*Math.PI/180,i=(t.y-this.y)*Math.PI/180,n=(this.y+t.y)/2*Math.PI/180,o=Math.tan(n);return o*=o,{dx:Math.abs(40680631590769*e/Math.sqrt(40680631590769+40408299981544.36*o)),dy:Math.abs(6378137*i)}},toString:function(){return this.x+","+this.y}});q.fromNormalized=function(t,e){return $.inverse(t,e)};var $={_YF:1.7071067811865475,_XF:.7071067811865476,_RYF:.585786437626905,_RXF:1.4142135623730951,a:6378137,D2R:.017453292519943295,R2D:57.29577951308232,initialize:function(){var t=new q(-180,-90,!1),e=new q(180,90,!1);this.forwardGall(t),this.forwardGall(e),this.mMaxSize=e._x-t._x,this.mSourceAeraProOrigineX=t._x,this.mSourceAeraProOrigineY=t._y,this.mMaxHeightPct=(e._y-t._y)/this.mMaxSize},forwardGall:function(t){t._x=this.a*this._XF*t.x*this.D2R,t._y=this.a*this._YF*Math.tan(.5*t.y*this.D2R)},normalize:function(t){t._x=(t._x-this.mSourceAeraProOrigineX)/this.mMaxSize,t._y=(t._y-this.mSourceAeraProOrigineY)/this.mMaxSize},inverseGall:function(t,e){var i=this.R2D*this._RXF*t/this.a,n=2*this.R2D*Math.atan(e/this.a*this._RYF);return new q(i,n)},forward:function(t){this.forwardGall(t),this.normalize(t)},inverse:function(t,e){return t<0?t=0:t>1&&(t=1),e<0?e=0:e>this.mMaxHeightPct&&(e=this.mMaxHeightPct),t*=this.mMaxSize,e*=this.mMaxSize,t+=this.mSourceAeraProOrigineX,e+=this.mSourceAeraProOrigineY,this.inverseGall(t,e)}};$.initialize();var J=h.geo.GeoBounds=_({ne:null,sw:null,center:null,initialize:function(t,e){if(!t||!e)throw"Mappy.api.geo.GeoBounds needs 2 valid coordinates";var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),o=Math.max(t.x,e.x),s=Math.max(t.y,e.y);this.ne=new q(o,s),this.sw=new q(i,n)},getCenter:function(){var t=this.sw._x+(this.ne._x-this.sw._x)/2,e=this.sw._y+(this.ne._y-this.sw._y)/2;return q.fromNormalized(t,e)},refreshCenter:function(){var t=this.sw._x+(this.ne._x-this.sw._x)/2,e=this.sw._y+(this.ne._y-this.sw._y)/2;this.center=q.fromNormalized(t,e)},contains:function(t){return t._x>=this.sw._x&&t._x<=this.ne._x&&t._y>=this.sw._y&&t._y<=this.ne._y},intersect:function(t){var e=Math.max(this.sw._x,t.sw._x),i=Math.max(this.sw._y,t.sw._y),n=Math.min(this.ne._x,t.ne._x),o=Math.min(this.ne._y,t.ne._y);if(n-e<0||o-i<0)return null;var s=q.fromNormalized(n,o),r=q.fromNormalized(e,i);return new J(s,r)},extend:function(t){var e=this.ne,i=this.sw;t._x<i._x&&(i._x=t._x,i.x=t.x),t._x>e._x&&(e._x=t._x,e.x=t.x),t._y<i._y&&(i._y=t._y,i.y=t.y),t._y>e._y&&(e._y=t._y,e.y=t.y)},getDeltaX:function(){return this.ne._x-this.sw._x},getDeltaY:function(){return this.ne._y-this.sw._y},toString:function(){return this.ne.toString()+" / "+this.sw.toString()}});h.geo.createGeoBoundsFromLocations=function(t){var e={},i={};for(var n in t){var o=t[n];(!e.x||o.x>e.x)&&(e.x=o.x),(!e.y||o.y>e.y)&&(e.y=o.y),(!i.x||o.x<i.x)&&(i.x=o.x),(!i.y||o.y<i.y)&&(i.y=o.y)}var s=new q(e.x,e.y),r=new q(i.x,i.y);return new J(s,r)};function K(e,i,n){var o=e.encode();o=s+t+o,a&&(o+="&auth="+a),o=encodeURI(o),g.ajax({dataType:"jsonp",jsonp:"callback",url:o,scriptCharset:"utf-8",success:i,error:n})}var Q=_({initialize:function(){},encode:function(){},configure:function(){}}),tt=_(Q,{initialize:function(){Q.prototype.initialize.call(this)},encode:function(){var t=l.loc;return t+=k(this._options,"opt")},isReady:function(){return!0},configure:function(t){this._options=t}}),et=_(tt,{initialize:function(){tt.prototype.initialize.call(this)},encode:function(){var t=tt.prototype.encode.apply(this);return b(this._addr._countryName)&&(t+="&countryName="+this._addr._countryName),b(this._addr._townName)&&(t+="&townName="+this._addr._townName),b(this._addr._number)&&(t+="&opt.number="+this._addr._number),b(this._addr._wayName)&&(t+="&opt.wayName="+this._addr._wayName),b(this._addr._countryCode)&&(t+="&countryCode="+this._addr._countryCode),b(this._addr._townOfficialCode)&&(t+="&townOfficialCode="+this._addr._townOfficialCode),b(this._addr._postalCode)&&(t+="&postalCode="+this._addr._postalCode),b(this._addr._countryIsoCode)&&(t+="&countryIsoCode="+this._addr._countryIsoCode),b(this._addr._subcountryName)&&(t+="&opt.subcountryName="+this._addr._subcountryName),b(this._addr._subcountryOfficialCode)&&(t+="&opt.subcountryOfficialCode="+this._addr._subcountryOfficialCode),t},configure:function(t,e){tt.prototype.configure.call(this,e),this._addr=t},isReady:function(){return b(this._addr._countryName)||b(this._addr._countryCode)}}),it=_(Q,{initialize:function(){Q.prototype.initialize.call(this)},encode:function(){var t=l.rmm+"opt.format=json&opt.trace=1",e=this._addressList.length;if(t+="&start.rid="+this._addressList[0].rid,b(this._addressList[0].pct)&&(t+="&start.ridpct="+this._addressList[0].pct),this._addressList.length>2){for(t+="&via.rids="+this._addressList[1].rid,i=2;i<this._addressList.length-1;i+=1)t+=","+this._addressList[i].rid;for(t+="&via.ridspct="+(b(this._addressList[1].pct)?this._addressList[1].pct:"50"),i=2;i<this._addressList.length-1;i+=1)t+=","+(b(this._addressList[i].pct)?this._addressList[i].pct:"50")}return t+="&end.rid="+this._addressList[e-1].rid,b(this._addressList[e-1].pct)&&(t+="&end.ridpct="+this._addressList[e-1].pct),b(this._options.date)&&(t+="&date="+this._options.date),b(this._options.time)&&(t+="&time="+this._options.time),b(this._options.sens)&&(t+="&sens="+this._options.sens),b(this._options.veh)&&(t+="&opt.vehicle="+this._options.veh),b(this._options.criteria)&&(t+="&criteria="+this._options.criteria),b(this._options.rbver)&&(t+="&opt.rbver="+this._options.rbver),b(this._options.transport_mode)&&(t+="&opt.transport_mode="+this._options.transport_mode),b(this._options.realtime)&&(t+="&opt.realtime="+this._options.realtime),b(this._options.mode)&&(t+="&opt.mode="+this._options.mode),b(this._options.nbroutes)&&(t+="&opt.nbroutes="+this._options.nbroutes),t},configure:function(t,e){this._addressList=t,this._options=e||{}}}),nt=_(Q,{initialize:function(){Q.prototype.initialize.call(this)},encode:function(){var t=l.route+"opt.format=json&opt.trace=1",e=this._addressList;t+="&opt.json.route=[";for(var i=[],n=0;n<e.length;n+=1)b(e[n].rid)?i.push('{"rid":"'+e[n].rid+","+(b(e[n].pct)?e[n].pct:"50")+'"}'):i.push('{"xy":"'+e[n].x+","+e[n].y+'"}');return t+=i.join(",")+"]",b(this._options)&&(t+="&"+k(this._options,"opt")),t},configure:function(t,e){this._addressList=t,this._options=e||{}}}),ot=_(Q,{_callTraffic:!1,initialize:function(){Q.prototype.initialize.call(this)},encode:function(){return[l.descr,this._viewMode._realName,this._viewMode.slabSize,this._zoom,this._tilesList].join("/")},configure:function(t,e,i){this._tilesList=t,this._zoom=e,this._viewMode=i},submit:function(t,i){var n=s+e[0]+this.encode();n=encodeURI(n),g.ajax({dataType:"jsonp",jsonp:"callback",url:n,scriptCharset:"utf-8",success:t,error:i})}}),st=_(tt,{initialize:function(){tt.prototype.initialize.call(this)},encode:function(){var t=tt.prototype.encode.apply(this);return t+="&fullAddress="+encodeURIComponent(this._addr)},configure:function(t,e){tt.prototype.configure.call(this,e),this._addr=t},isReady:function(){return"string"==typeof this._addr}}),rt=_(tt,{initialize:function(){tt.prototype.initialize.call(this)},encode:function(){var t=tt.prototype.encode.apply(this);return t+="&x="+this._coords.x,t+="&y="+this._coords.y},configure:function(t,e){tt.prototype.configure.call(this,e),this._coords=t},isReady:function(){return this._coords instanceof q}}),at=_({initialize:function(){}}),lt=h.geolocation.AddressLocation=_(at,{initialize:function(t,e,i,n){at.prototype.initialize.call(this),this._countryName=t,this._townName=e,this._wayName=i,this._number=n},setCountryName:function(t){delete this._countryCode,delete this._countryIsoCode,this._countryName=t},setTownName:function(t){delete this._townOfficialCode,this._townName=t},setWayName:function(t){this._wayName=t},setNumber:function(t){this._number=t},setCountryCode:function(t){delete this._countryName,delete this._countryIsoCode,this._countryCode=t},setTownOfficialCode:function(t){delete this._townName,this._townOfficialCode=t},setPostalCode:function(t){this._postalCode=t},setCountryIsoCode:function(t){delete this._countryName,delete this._countryCode,this._countryIsoCode=t},setSubcountryName:function(t){delete this._subcountryOfficialCode,this._subcountryName=t},setSubcountryOfficialCode:function(t){delete this._subcountryName,this._subcountryOfficialCode=t}}),ht=_(at,{Placemark:null,initialize:function(t,e){var i;switch(at.prototype.initialize.call(this),t.ExtendedData["mappy:LocalGeocodeLevel"]["mappy:code"]){case"1":this._bestZoom=3;break;case"2":this._bestZoom=4;break;case"3":this._bestZoom=7;break;case"4":case"5":this._bestZoom=10;break;default:this._bestZoom=0}if(!0!==e){var n,o;if(x(t,"AddressDetails.Country.AdministrativeArea.Locality.Thoroughfare.ThoroughfareNumber")){for(n={},o=g.makeArray(t.AddressDetails.Country.AdministrativeArea.Locality.Thoroughfare.ThoroughfareNumber),i=0;i<o.length;i+=1)n[o[i].Type]=o[i].value;t.AddressDetails.Country.AdministrativeArea.Locality.Thoroughfare.ThoroughfareNumber=n}if(x(t,"AddressDetails.Country.AdministrativeArea.Locality.DependentLocality.Thoroughfare.ThoroughfareNumber")){for(n={},o=g.makeArray(t.AddressDetails.Country.AdministrativeArea.Locality.DependentLocality.Thoroughfare.ThoroughfareNumber),i=0;i<o.length;i+=1)n[o[i].Type]=o[i].value;t.AddressDetails.Country.AdministrativeArea.Locality.DependentLocality.Thoroughfare.ThoroughfareNumber=n}if(t.Point){var s=t.Point.coordinates.split(",");for(t.Point.coordinates=[],i=0;i<s.length;i+=1)t.Point.coordinates.push(s[i])}}this.Placemark=t},clone:function(){var t=g.extend(!0,{},this.Placemark);return new ht(t,!0)},getBestZoom:function(){return this._bestZoom},getRidInfo:function(){return{rid:this.Placemark.ExtendedData["mappy:road_element_id"],pct:this.Placemark.ExtendedData["mappy:road_element_percentage"]}},getCoordinates:function(){return new q(this.Placemark.Point.coordinates[0],this.Placemark.Point.coordinates[1])}}),ct=h.geolocation.Geocoder=_({_options:{format:"json",namedPlaceSearch:1,interactive:1,language:"FRE",xmlOutput:"3v0"},initialize:function(){},geocode:function(t,e,i){if(t instanceof ht)e([t]);else{var n;if("string"==typeof t)n=new st;else if(t instanceof q)n=new rt;else{if(!(t instanceof lt))return void(g.isFunction(i)&&i(new Error("Bad parameter.")));n=new et}n.configure(t,this._options),n.isReady()?K(n,function(t){var n=[];try{for(var o=g.makeArray(t.kml.Document.Placemark),s=0;s<o.length;s+=1)n.push(new ht(o[s]))}catch(t){if(!g.isFunction(i))throw t;return void i(t)}e(n)},i):g.isFunction(i)&&i(new Error("Not enough information."))}},setNamedPlaceSearch:function(t){this._options.namedPlaceSearch=t},setInteractive:function(t){this._options.interactive=t},setMaxRadius:function(t){this._options.maxRadius=t},setLanguage:function(t){this._options.language=t},setFavoriteCountry:function(t){this._options.favoriteCountry=t},setFavoriteCity:function(t){this._options.favoriteCity=t}}),ut=_({initialize:function(t,e,i,n){this.key=n,this._points={},this._box=t.box,this.id=t.id,this.label=t.properties.description.label,this.controller=i,this.item=t,this.item.descrLayerName=e,this._points.min=i.converter.toGeolayerPixels(new q(this._box.minx,this._box.miny)),this._points.max=i.converter.toGeolayerPixels(new q(this._box.maxx,this._box.maxy))},isClickeable:function(){return!0===d||1===parseInt(this.item.click)},isOver:function(t,e){var i=this._points.max.x,n=this._points.min.x,o=this._points.max.y,s=this._points.min.y;if(d){var r=i-n;r<25&&(i+=Math.floor((25-r)/2),n-=Math.ceil((25-r)/2));var a=o-s;a<25&&(o+=Math.floor((25-a)/2),s-=Math.ceil((25-a)/2))}return n<=t&&t<=i&&o<=e&&e<=s},openToolTip:function(t){this._toolTip||(this.item.properties.type&&"RAILWAY"===this.item.properties.type?this._toolTip=new G(this.controller.view.geolayer,this.item):this._toolTip=new V(this.controller.view.geolayer,'<div style="margin:3px 6px">'+this.label+"</div>")),!1===this._toolTip.isAdded&&this._toolTip.add(t)},closeToolTip:function(){!this.keepTooltip&&this._toolTip&&this._toolTip.remove()},destroy:function(){this._toolTip&&this._toolTip.remove()}}),dt=_({initialize:function(t,e,i,n){this.sx=t,this.sy=e,this.zoom=i,this.viewMode=n,this.key=this.getKey(t,e,i,n.name)},create:function(t,i){var n=this.viewMode,r=n.slabSize,a=this.sx*r-t,h=i-(this.sy+1)*r,c=document.createElement("img");c.style.position="absolute",c.style.left=a+"px",c.style.top=h+"px",c.style.width=r+"px",c.style.height=r+"px",c.galleryImg="no",c.style.MozUserSelect="none",c.style.KhtmlUserSelect="none",c.unselectable="on",c.onselectstart=function(){return!1},c.src=o+"img/map/transparent.png",c.ondragstart=function(){return!1},c.onmousedown=function(){return!1};var u,d=n.getSx(this),p=d*this.sy%e.length,f=s+e[p]+[l.slab,n._realName,n.slabSize,this.zoom,d,this.sy].join("/"),m=this;j(f,c,function(){m.loaded=!0},u),this.div=c,this.left=t,this.top=i},clone:function(){var t=new dt(this.sx,this.sy,this.zoom,this.viewMode);return b(this.div)&&(t.div=this.div.cloneNode(!1),t.left=this.left,t.top=this.top),t},append:function(t){t.append(this.div)},zoomAt:function(t){var e=this.viewMode.slabSize,i=this.left,n=this.top,o=this.sx*e-i,s=n-(this.sy+1)*e,r=this.div;r.style.left=o*t+"px",r.style.top=s*t+"px",r.style.width=e*t+"px",r.style.height=e*t+"px"},remove:function(){this.div.src=o+"img/map/transparent.png",this.div.parentNode.removeChild(this.div)},stopDownload:function(){this.loaded||this.remove()},getKey:function(t,e,i,n){return t+","+e+","+i+","+n}}),pt=h.map.ViewMode=_({slabSize:null,minZoomLevel:null,maxZoomLevel:null,_timer:void 0,_timestampTimeout:-1,_refreshDelay:void 0,_stopRefreshDelay:1e3*ft,initialize:function(t,e){var i=new Array,n=t.split(";"),o={printmap:["printmap"]};for(var s in n){var a=n[s];i.push(a),x(r,"[viewModeName]['refresh-delay']")&&(this._refreshDelay=1e3*r[a]["refresh-delay"],this._stopRefreshDelay=1e3*(r[a]["stop-refresh-delay"]||ft))}for(var l in t=i.join(";"),this._realName=i.join(";"),this._realNames=new Array,o)this._realNames[l]=o[l].join(";");switch(this.slabSize=pt.slabSize,x(r,"[viewModesNames[0]]['slab-region'].template.size")&&(this.slabSize=parseInt(r[i[0]]["slab-region"].template.size,10)),this.maxZoomLevel=12,t){case"hybrid":case"photo":this.minZoomLevel=3;break;default:this.minZoomLevel=0}"iti"!==t&&"itimap"!==t||(t+="&postkey="+e),this.name=t},zoomable:function(t){return t>this.maxZoomLevel?this.maxZoomLevel:t<this.minZoomLevel?this.minZoomLevel:-1},getSx:function(t){var e,i=pt.tileMaxIds[t.zoom];return b(i)&&(e=t.sx%(i[0]+1))<0&&(e+=i[0]+1),e},checkSx:function(t){var e=pt.tileMaxIds[t.zoom];return!!b(e)&&(t.sx>=0&&t.sx<=e[0])},checkSy:function(t){var e=pt.tileMaxIds[t.zoom];return!!b(e)&&(t.sy>=0&&t.sy<=e[1])},setStopRefreshDelay:function(t){this._stopRefreshDelay=void 0===t||NaN===t?1e3*ft:t},_updateRealName:function(t){b(this._realNames[t._bgType])&&"string"==typeof this._realNames[t._bgType]&&(this._realName=this._realNames[t._bgType])},setRefreshDelay:function(t){this._refreshDelay=t,b(this._timer)&&(clearTimeout(this._timer),this._refreshTask())},_refreshTask:function(t){if(b(this._refreshDelay)&&-1===this._timestampTimeout){this._mapctrl=t,this._mapctrl.map.trigger("startrefreshviewmode",this),this._timestampTimeout=(new Date).getTime();var e=this;this._timer=setTimeout(function(){e._refreshTask(e._mapctrl)},this._refreshDelay)}if(-1!==this._timestampTimeout&&(new Date).getTime()-this._timestampTimeout<this._stopRefreshDelay){this._mapctrl.refreshTiles(this.name,!0);e=this;this._timer=setTimeout(function(){e._refreshTask(e._mapctrl)},this._refreshDelay),this._mapctrl.map.trigger("refreshviewmode",this)}else-1!==this._timestampTimeout&&this._stopRefreshTask(!1)},_stopRefreshTask:function(t){this._timestampTimeout=-1,b(this._timer)&&(clearTimeout(this._timer),this._timer=void 0,b(this._mapctrl)&&this._mapctrl.map.trigger("stoprefreshviewmode",this,t))}});h.map.viewModes={MAP:"map",HYBRID:"hybrid",PHOTO:"photo"},pt.slabSize=384,pt.mMaxZoomLevel=12,pt.tileMaxIds=[[0,0],[2,2],[8,6],[26,20],[80,62],[242,186],[728,560],[2186,1680],[6560,5041],[19682,15125],[59048,45377],[177146,136131],[531440,408395],[1594322,1225186]];var ft=84,mt=_({_tools:null,initialize:function(t){this._map=t,this._tools=[]},addTool:function(t){t instanceof Kt?(b(this._map.miniMap)&&this._map.miniMap.removed(),this._map.miniMap=t,t.added(this._map),this._refreshPositions()):(this._tools.push(t),t.added(this._map),t.refreshPosition())},removeTool:function(t){if(!w(t)){t instanceof Kt&&(this._map.miniMap=null),t.removed();var e=g.inArray(t,this._tools);-1!==e&&this._tools.splice(e,1),this._refreshPositions()}},_refreshPositions:function(){for(var t=0;t<this._tools.length;t+=1)this._tools[t].refreshPosition()}}),gt=h.map.Marker=_(N,{EVENTS:["click","dblclick","mouseover","mouseout","dragstart","dragstop","drag","popupopened","popupclosed"],div:null,coordinates:null,location:null,isOnMap:!1,isHidden:!1,isPopUpOpened:!1,isInCluster:!1,dragging:!1,isOver:!1,_tailStyle:null,_toolTip:null,initialize:function(t,e,i){N.prototype.initialize.apply(this),this.coordinates=t,e&&"string"!=typeof e?this._icon=e:(this._icon=new W(h.ui.Icon.DEFAULT),"string"==typeof e&&(this._icon.label=e)),this._popUpOptions=i||new _t({mappyDecoration:!0}),this._toolTipListeners=[]},setIcon:function(t){this._icon=t,this.isOnMap&&(this._createIcon(this.div.parent()),this.setMarkerPosition())},getIcon:function(){return this._icon},setPopUpOptions:function(t){this._popUpOptions=t},getPopUpOptions:function(){return this._popUpOptions},_createIcon:function(t){b(this.div)&&this.div.remove(),this.div=this._icon.create(g(t)[0].ownerDocument.createElement("div")),this.div.css("position","absolute");var e=this;this.div.click(function(t){e.trigger("click",t)}),this.div.dblclick(function(t){e.trigger("dblclick",t)}),this.div.mouseenter(function(t){e.isOver||(e.isOver=!0,e.trigger("mouseover",t))}),this.div.mousemove(function(t){e.dragging||t.stopPropagation()}),this.div.mouseleave(function(t){e.isOver=!1,e.trigger("mouseout",t)}),t.append(this.div)},_createToolTip:function(){if(b(this.toolTip)){this.removeToolTip();var t=new V(this._controller.view.geolayer,'<div style="margin:3px 6px">'+this.toolTip+"</div>");this._toolTipListeners.push(this.addListener("mouseover",function(e){t.add(e)})),this._toolTipListeners.push(this.addListener("mouseout",function(){t.remove()})),this._toolTipInst=t}},geocode:function(t,e){var i=new ct,n=this;i.geocode(this.coordinates,function(e){if(e.length>0){var i=e[0].Placemark.Point.coordinates;n.location=e[0],n.coordinates=new q(i[0],i[1]),n.setPosition()}"function"==typeof t&&t(e)},e)},added:function(t,e){this._controller=e,this._createIcon(t),e.map.isReady&&this.setPosition(),this.isOnMap=!0,this._createToolTip(),this.isHidden&&this.hide()},removed:function(){this.isOnMap&&(this.isOnMap=!1,this.removeToolTip(),this.closePopUp(),this.div.remove())},setPosition:function(){this.pos=this._controller.converter.toGeolayerPixels(this.coordinates),this.setMarkerPosition()},setMarkerPosition:function(){this.div.css({left:this.pos.x-this._icon.iconAnchor.x,top:this.pos.y-this._icon.iconAnchor.y,"z-index":this.pos.y+1e4}),b(this._popUp)&&this._popUp.setPopUpPosition(this.pos)},showPopUp:function(t){return this.openPopUp(void 0,t)},openPopUp:function(t,e){return b(this._popUp)&&this._controller.popuplayer.removePopUp(this._popUp),b(this.pos)||this.setPosition(),b(t)&&(this._popUp=new yt(t,this)),!(!b(this._popUp)||(this._controller.popuplayer.addPopUp(this._popUp),this._popUp.setPopUpPosition(this.pos),this.isPopUpOpened=!0,this.trigger("popupopened"),!1===e))&&this._popUp.slideTo(this.pos)},closePopUp:function(){b(this._popUp)&&(this._controller.popuplayer.removePopUp(this._popUp),this.isPopUpOpened=!1,this.trigger("popupclosed"))},addToolTip:function(t){this.toolTip=t,this.isOnMap&&this._createToolTip()},removeToolTip:function(){b(this._toolTipInst)&&this._toolTipInst.remove();for(var t=0;t<this._toolTipListeners.length;t+=1)this.removeListener(this._toolTipListeners[t]);this._toolTipListeners=[]},enableDraggable:function(){b(this.div)&&"function"==typeof this.div.enableDraggable?this.div.enableDraggable():b(this.div)&&this.addDraggable()},disableDraggable:function(){b(this.div)&&"function"==typeof this.div.disableDraggable&&this.div.disableDraggable()},addDraggable:function(){var t,e=this,i=!1,n=function(){var t=0,n=0,o=e._controller.view.position(),s=e._controller.model.getSize(),r=e.div.position(),a=e._icon.iconAnchor,l=r.left+a.x+o.left;l<20?t=5:l>s.width-20&&(t=-5);var h=r.top+a.y+o.top;h<20?n=5:h>s.height-20&&(n=-5),(t||n)&&(i=!0,o.left+=t,o.top+=n,e._controller.view.setPosition(o.left,o.top),r.left-=t,r.top-=n,e.div.hackModifyInit(t,n),e.div.css(r),e._controller.refreshTiles())};this.div.unbind("click"),R(this.div,{start:function(i){t=setInterval(n,10),e.dragging=!0,e.trigger("dragstart",i)},stop:function(n){window.clearInterval(t),e.dragging=!1;var o=e.div.position(),s=o.left+e._icon.iconAnchor.x,r=o.top+e._icon.iconAnchor.y;e.coordinates=e._controller.converter.fromGeolayerPixels(s,r),i&&e._controller.newStaticPosition(),e.trigger("dragstop",n)},drag:function(t){var i=e.div.position(),n=i.left+e._icon.iconAnchor.x,o=i.top+e._icon.iconAnchor.y;e.coordinates=e._controller.converter.fromGeolayerPixels(n,o),e.setPosition(),e.trigger("drag",t)}}),this.div.click(function(t){e.trigger("click",t)})},hide:function(){this.isHidden=!0,b(this.div)&&(this.div.hide(),this.closePopUp())},show:function(){this.isHidden=!1,b(this.div)&&this.div.show()},getTailStyle:function(){return this._tailStyle},setTailStyle:function(t){this._tailStyle=t},destroyTail:function(){b(this.tail)&&this.tail.clean()},drawTail:function(){if(this.destroyTail(),b(this.center)){if(this.center.x!==this.pos.x||this.center.y!==this.pos.y){if(this.center.round(),this.pos.round(),!this.tail){this.tail=Lt(this.div.parent(),10,"line");var t=this._tailStyle||new Rt({lineWidth:1,strokeStyle:"FF000000"});this.tail.setStyle(t)}var e=new F(this.center.x,this.center.y,this.center.x,this.center.y);e.addPoint(this.pos),this.tail.setBoundingBox(e),this.center.px=this.center.x,this.center.py=this.center.y,this.pos.px=this.pos.x,this.pos.py=this.pos.y,this.tail.line([this.center,this.pos])}delete this.center}}}),vt=_(gt,{markers:null,bounds:null,initialize:function(t,e){gt.prototype.initialize.call(this,null,e),this.markers=[],this.bounds=t},added:function(t,e){this.getIcon().label="x"+this.markers.length;for(var i=0;i<this.markers.length;i+=1)this.markers[i].isInCluster=!0;gt.prototype.added.call(this,t,e)},setPosition:function(){var t,e=[];for(t=0;t<this.markers.length;t+=1)e.push(this.markers[t].coordinates);var i=new q(0,0);for(i._x=0,i._y=0,t=0;t<e.length;t+=1)i._x+=e[t]._x,i._y+=e[t]._y;i._x/=e.length,i._y/=e.length,this.coordinates=q.fromNormalized(i._x,i._y),gt.prototype.setPosition.apply(this)},contains:function(t){return this.bounds.inside(t.pos)},removed:function(){for(var t=0;t<this.markers.length;t+=1)this.markers[t].show(),this.markers[t].isInCluster=!1;gt.prototype.removed.call(this)}});var yt=_({div:null,isOnMap:!1,initialize:function(t,e){this.html=t,this.marker=e},setPopUpPosition:function(t){var e=this.marker.getPopUpOptions(),i=this.marker.getIcon(),n=e.getAnchorPoint(this._controller,this.size,i,t);this.div.css({position:"absolute",left:t.x+n.x,top:t.y+n.y})},slideTo:function(t){if(this.isOnMap){var e=this.marker.getPopUpOptions(),i=this.marker.getIcon(),n=e.getAnchorPoint(this._controller,this.size,i,t),o=new O(t.x+n.x,t.y+n.y),s=new F(o.x,o.y,o.x+this.size.width,o.y+this.size.height);s.addPoint(new O(t.x-i.iconAnchor.x,t.y-i.iconAnchor.y)),s.addPoint(new O(t.x-i.iconAnchor.x+i.size.width,t.y-i.iconAnchor.y+i.size.height)),this._controller.slideToBounds(s,"popup")}},added:function(t){this._controller=t;var e=this.marker.getPopUpOptions().createPopUp(this.html,t.popuplayer.div,this.marker);this.div=e.div,this.size=e.size,this.isOnMap=!0},removed:function(){this.div.remove(),this.isOnMap=!1}}),_t=h.map.PopUpOptions=_({TEMPLATE:'<div class="popup"><div class="popup-nw"><img src="{imagePath}/popup/popup-sprite.png"/></div><div class="popup-sw"><img src="{imagePath}/popup/popup-sprite.png"/></div><div class="popup-ne"><img src="{imagePath}/popup/popup-sprite.png"/></div><div class="popup-se"><img src="{imagePath}/popup/popup-sprite.png"/></div><div class="popup-beak"><img src="{imagePath}/popup/popup-sprite.png"/></div><div class="popup-content"></div><div class="popup-close"></div></div>',mappyDecoration:!1,left:null,right:null,top:null,bottom:null,autoLayout:!1,initialize:function(t){t=t||{},this.mappyDecoration=t.mappyDecoration,this.mappyDecoration?(this.bottom=0,this.left="auto"):(this.autoLayout=t.autoLayout,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom)},getAnchorPoint:function(t,e,i,n){var o;if(this.autoLayout){o=new O(i.size.width-i.iconAnchor.x,-i.iconAnchor.y);var s=t.model.getPadding(),r=t.view.position();r.left+=n.x+o.x,r.top+=n.y+o.y;var a=t.model.getSize();r.left+e.width>a.width-s.right&&r.left-e.width-i.size.width>s.left&&(o.x-=e.width+i.size.width),r.top+e.height>a.height-s.bottom&&(e.height>a.height-s.top-s.bottom?o.y-=r.top-s.top:o.y-=r.top+e.height-a.height+s.bottom)}else o=new O(i.popUpAnchor.x-i.iconAnchor.x,i.popUpAnchor.y-i.iconAnchor.y),b(this.left)&&("auto"===this.left?o.x-=e.width/2:o.x-=this.left),b(this.right)&&("auto"===this.right?o.x-=e.width/2:o.x+=this.right-e.width),b(this.top)&&("auto"===this.top?o.y-=e.height/2:o.y-=this.top),b(this.bottom)&&("auto"===this.bottom?o.y-=e.height/2:o.y+=this.bottom-e.height);return o},createPopUp:function(t,e,i){var n,s;if("string"!=typeof t&&(t=g(t).clone(!0)),this.mappyDecoration){var r=C(this.TEMPLATE,{imagePath:o+(v?"img_png8":"img")});(n=g(r)).appendTo(e);var a=n.find(".popup-content");a.html(t);var l=B(a,!0);n.width(l.width),n.height(l.height);var h=l.width-23,c=l.height-22;n.find(".popup-nw").width(h),n.find(".popup-sw").width(h),n.find(".popup-sw").height(c),n.find(".popup-se").height(c);var u=n.find(".popup-beak"),d=new I(23,49),p=l.getCenter(),f=d.getCenter();u.css("left",Math.round(p.x-f.x)),u.css("top",l.height-5),s=new I(l.width,l.height+d.height-5),n.find(".popup-close").click(function(t){i.closePopUp()})}else(n=g('<div class="popup"></div>')).html(t),n.appendTo(e),s=B(n,!0);return n.click(function(t){t.stopPropagation()}),n.mousemove(function(t){t.stopPropagation()}),{div:n,size:s}}}),bt=(h.map.Map=_(N,{EVENTS:["changestart","changeend","zoomstart","zoomend","drag","dragstart","dragstop","mousewheel","click","dblclick","rightclick","mouseup","mousedown","mousemove","mouseover","mouseout","beforeresize","resize","controlchanged","touchstart","touchmove","touchend","gestureend","gesturechange","gesturestart","refreshdescr","bgpoiclick","startrefreshviewmode","refreshviewmode","stoprefreshviewmode","viewmodechanged"],isReady:!1,hasInertia:!1,dragging:!1,div:null,_features:{draggable:!0,dblClickZoom:!0,scrollWheelZoom:!0,zoomSelection:!1,tooltipsOnClick:!1},initialize:function(t,e){e||(e=t.background);var i=t.features||{};N.prototype.initialize.apply(this);var n=g(t.container);this.controller=new xt(this,n,e),this.toolManager=new mt(this),this.copyrights=new Jt,this.addTool(this.copyrights),this.div=this.controller.view.div,M(i)||this.setFeatures(i),M(t.viewmode)||this.setViewMode(t.viewmode),M(t.center)||2!=t.center.length||this.setCenter(t.center[0],t.center[1])},setCenter:function(t,e){this.controller.setState(t,e)},setFeatures:function(t){for(var e in this._features){if(t.hasOwnProperty(e))this[(!0===t[e]?"enable":"disable")+z(e)](),this._features[e]=t[e]}},setFeature:function(t,e){this._features.hasOwnProperty(t)&&"boolean"==typeof e&&(this[(!0===e?"enable":"disable")+z(t)](),this._features[t]=e)},getFeatures:function(t){return this._features},getFeature:function(t){return b(this._features[t])?this._features[t]:"undefined"},resize:function(){this.controller.resize(this.div.width(),this.div.height())},getCenter:function(){return this.controller.getCenter()},setZoomAnimation:function(t){this.controller.setZoomAnimation(t)},getZoomAnimation:function(){return this.controller.getZoomAnimation()},setZoomLevel:function(t){this.controller.setZoom(t)},getZoomLevel:function(){return this.controller.model.getZoom()},addLayer:function(t){this.controller.addLayer(t)},removeLayer:function(t){this.controller.removeLayer(t)},addTool:function(t){this.toolManager.addTool(t)},removeTool:function(t){this.toolManager.removeTool(t)},getVisibleBounds:function(){var t=this.controller.model.getSize(),e=this.controller.model.getPadding();return new J(this.controller.converter.fromPixels(t.width-e.right,e.top),this.controller.converter.fromPixels(e.left,t.height-e.bottom))},getBoundsZoomLevel:function(t){return this.controller.model.getBoundsZoomLevel(t)},slideBy:function(t){this.controller.slideBy(t.x,t.y)},slideTo:function(t){this.isReady&&this.controller.slideTo(t)},zoomIn:function(){this.controller.setZoom(this.controller.model.getZoom()+1)},zoomOut:function(){this.controller.setZoom(this.controller.model.getZoom()-1)},getViewMode:function(){return this.controller.model.getViewMode()},setViewMode:function(t){this.controller.setViewMode(t)},getSize:function(){return this.controller.model.getSize()},setPadding:function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&("n"===i&&(e.top=t[i]),"s"===i&&(e.bottom=t[i]),"e"===i&&(e.right=t[i]),"w"===i&&(e.left=t[i]));this.controller.setPadding(e)},getPadding:function(){var t=this.controller.model.getPadding();return{n:t.top,s:t.bottom,e:t.right,w:t.left}},disableDraggable:function(){this.controller.disableDraggable()},enableDraggable:function(){this.controller.enableDraggable()},enableDblClickZoom:function(){!1===this.controller.dblclickZoom&&(this.controller.dblclickZoom=!0,this.trigger("controlchanged","dblClickZoom"),this._features.dblclickZoom=!0)},disableDblClickZoom:function(){!0===this.controller.dblclickZoom&&(this.controller.dblclickZoom=!1,this.trigger("controlchanged","dblClickZoom"),this._features.dblclickZoom=!1)},isDblClickZoomEnabled:function(){return this.controller.dblclickZoom},enableScrollWheelZoom:function(){!1===this.controller.mousewheelZoom&&(this.controller.mousewheelZoom=!0,this.trigger("controlchanged","scrollWheelZoom"),this._features.scrollWheelZoom=!0)},disableScrollWheelZoom:function(){!0===this.controller.mousewheelZoom&&(this.controller.mousewheelZoom=!1,this.trigger("controlchanged","scrollWheelZoom"),this._features.scrollWheelZoom=!1)},isScrollWheelZoomEnabled:function(){return this.controller.mousewheelZoom},enableZoomSelection:function(){!1===this.controller.zoomSelection&&(this.controller.enableZoomSelection(),this.trigger("controlchanged","selectionZoom"),this._features.zoomSelection=!0)},disableZoomSelection:function(){!0===this.controller.zoomSelection&&(this.controller.disableZoomSelection(),this.trigger("controlchanged","selectionZoom"),this._features.zoomSelection=!1)},enableTooltipsOnClick:function(){!1===this.controller.tooltipsOnClick&&(this.controller.enableTooltipsOnClick(),this.trigger("controlchanged","tooltipsOnClick"),this._features.tooltipsOnClick=!0)},disableTooltipsOnClick:function(){!0===this.controller.tooltipsOnClick&&(this.controller.disableTooltipsOnClick(),this.trigger("controlchanged","tooltipsOnClick"),this._features.tooltipsOnClick=!1)},isZoomSelectionEnabled:function(){return this.controller.zoomSelection},enableGestureZoom:function(){!1===this.controller.gestureZoom&&(this.controller.gestureZoom=!0,this.trigger("controlchanged","gestureZoom"))},disableGestureZoom:function(){!0===this.controller.gestureZoom&&(this.controller.gestureZoom=!1,this.trigger("controlchanged","gestureZoom"))},setLogoPosition:function(t){this.controller.view.div.find("[name=logo]").css(t)},destroy:function(){this.controller.view.destroy()},getBounds:function(t){if(!g.isArray(t)||0===t.length)return null;for(var e=new J(t[0],t[0]),i=0;i<t.length;i+=1)e.extend(t[i]);return e.refreshCenter(),e},addTileLayer:function(t,e){this.controller.addTileLayer(t,e||10)},removeTileLayer:function(t){this.controller.removeTileLayer(t)},getTileLayers:function(){return this.controller.getTileLayers()},hideTraffic:function(){this.controller.hideTraffic()},showTraffic:function(t){this.controller.showTraffic(t)},getBgPois:function(){return this.controller.getBgPois()}}),_({initialize:function(t){this.view=t,this.duration=500,this.durationReciprocal=.002,this.finished=!0,this.currScale=1,this.delta=0},reset:function(){this.startScale=1,this.currScale=1,this.deltaZoom=0},zoom:function(t,e,i){this.finished&&(this.startViewPosition=this.view.position(),this.view.createBG(),this.screenX=e,this.screenY=i,this.reset()),this.deltaZoom+=t,this.startAnimation(this.currScale,Math.pow(3,this.deltaZoom))},startAnimation:function(t,e){this.finished=!1,this.startScale=t,this.finalScale=e,this.startTime=(new Date).getTime()},stepAnimation:function(){if(this.finished)return!1;var t=(new Date).getTime()-this.startTime;if(t<this.duration){var e=t*this.durationReciprocal;this.currScale=this.startScale+(this.finalScale-this.startScale)*e,this.currScale==this.finalScale&&(this.finished=!0)}else this.currScale=this.finalScale,this.finished=!0;return this.applyToView(),!0},applyToView:function(){var t=this.startViewPosition,e=this.currScale,i=P(t.left+(t.left-this.screenX)*(e-1)),n=P(t.top+(t.top-this.screenY)*(e-1));this.view.setBGScale(e,i,n)}})),wt=_({initialize:function(t,e,i){this.controller=e,this.tilelayers={},this.tiles={};var n={position:"relative",overflow:"hidden","background-color":"#FFF3DC"};x(i,"css")?n.background=i.css:x(i,"image")?n.background="url('"+i.image+"') repeat top left":(x(i,"color")&&(n["background-color"]=i.color),n["background-image"]="none"),t.css(n),this.div=t,v?t.append('<img name="logo" class="default-logo" src="'+o+'img_png8/map/logo.png" style="position:absolute;right:5px;top:5px;z-index:999;"></img>'):t.append('<img name="logo" class="default-logo" src="'+o+'img/map/logo.png" style="position:absolute;right:5px;top:5px;z-index:999;"></img>');var s=g('<div name="geolayer" style="position:absolute;"></div>');if(this.geolayer=s,this.bgTileLayer=g('<div name="bgtilelayer" style="position:absolute;z-index:5;"></div>'),this.geolayer.append(this.bgTileLayer),t.append(this.geolayer),this.addTileLayer("default",6),e.resize(t.width(),t.height()),R(this.geolayer,{drag:function(t){e.drag(t)},start:function(t){e.dragStart(t)},stop:function(t){e.dragStop(t)}}),s.mouseout(function(t){e.mouseout(t)}),s.mouseover(function(t){e.mouseover(t)}),s.click(function(t){e.click(t)}),s.dblclick(function(t){e.dblclick(t)}),s.mousedown(function(t){e.mousedown(t)}),s.mouseup(function(t){e.mouseup(t)}),s.mousemove(function(t){e.mousemove(t)}),s.mousewheel(function(t,i){e.mousewheel(t,i)}),g(window).resize(function(){e.resize()}),s.each(function(){this.oncontextmenu=function(){return!1}}),u){s[0].addEventListener("touchmove",function(t){Z(t),e.touchmove(t)}),s[0].addEventListener("touchend",function(t){e.touchend(t)});var r=0,a={};s[0].addEventListener("touchstart",function(t){if(e.touchstart(t),Z(t),1===t.touches.length){var i=t.touches[0];if((new Date).getTime()-r<1e3)if(Math.pow(i.pageX-a.pageX,2)+Math.pow(i.pageY-a.pageY,2)<900)return r=0,a.pageX=i.pageX,a.pageY=i.pageY,void e.dblclick(i);r=(new Date).getTime(),a.pageX=i.pageX,a.pageY=i.pageY}})}p&&(s[0].addEventListener("gesturestart",function(t){e.gesturestart(t)}),s[0].addEventListener("gestureend",function(t){e.gestureend(t)}),s[0].addEventListener("gesturechange",function(t){e.gesturechange(t)}))},slide:function(t,e,i,n){var o=this.position();this.geolayer.animate({left:o.left+t,top:o.top+e},{duration:500,complete:function(){g.isFunction(n)&&n()},queue:!1})},setTiles:function(t,e,i,n){var o;for(var s in t){n&&this.clean(s);for(var r=0;r<t[s].length;r+=1)o=t[s][r],w(this.tiles[s][o.key])&&(o.create(e,i),o.append(this.tilelayers[s]),this.tiles[s][o.key]=o)}},destroyExtraTiles:function(t){var e;for(var i in t){for(var n=0;n<t[i].length;n+=1)e=t[i][n],this.tiles[i].hasOwnProperty(e.key)&&(this.tiles[i][e.key].keep=!0);for(var o in this.tiles[i])!0!==(e=this.tiles[i][o]).keep?(e.remove(),delete this.tiles[i][o]):e.keep=!1}},reset:function(){this.clean(),this.setPosition(0,0)},clean:function(t){for(var e in this.tiles)if(w(t)||t===e){var i=this.tiles[e];for(var n in i)i.hasOwnProperty(n)&&i[n].remove();this.tiles[e]=[]}},setPosition:function(t,e){this.geolayer.css({left:t,top:e})},setScale:function(t,e,i){for(var n in this.geolayer.css({left:e,top:i}),this.tiles)for(var o in this.tiles[n])this.tiles[n][o].zoomAt(t)},setBGScale:function(t,e,i){var n=this.bgTileLayer;n.hide(),n.css({left:e,top:i});for(var o=0,s=this.bgTiles,r=s.length;o<r;o+=1)s[o].zoomAt(t);n.show()},createBG:function(){this.cleanBG();var t,e=this.bgTileLayer,i=this.bgTiles;for(var n in this.tiles.default)t=this.tiles.default[n],i.push(t),t.append(e);for(var o in this.bgTiles=i,this.tiles)this.tiles[o]=[];var s=this.position();this.setBGScale(1,s.left,s.top),this.setPosition(0,0)},cleanBG:function(){this.bgTileLayer.empty(),this.bgTiles=[]},position:function(){return this.geolayer.position()},leftTopFromEvent:function(t){var e=this.div.offset();return{left:t.pageX-e.left,top:t.pageY-e.top}},disableDraggable:function(){this.geolayer.disableDraggable()},enableDraggable:function(){this.geolayer.enableDraggable()},enableZoomSelection:function(){var t=this;this._mouseDownSelectionHandler=function(e){var i=t.div.offset(),n=new O(e.pageX-i.left,e.pageY-i.top),o=t.controller.converter.fromPixels(n.x,n.y),s=function(){t.geolayer.unbind("mousemove",s),t.geolayer.unbind("mouseup",r);var i=g('<div style="position: absolute; z-index: 998; width:10000px; height:10000px;"></div>');if(g.browser.msie){var n=g('<div style="background-color:white; position:absolute; width:2000px; height:2000px;"></div>');n.css("opacity",.01),i.append(n)}var a=g('<div class="tools-selected-zone" style="position:absolute;z-index: 991;"></div>');a.css("opacity",.3),i.append(a),t.div.append(i),i[0].onselectstart=function(){return e&&(e.returnValue=!1),!1};var l=o,h=e;i.mouseup(function(e){if(i.remove(),h.pageX!==e.pageX&&h.pageY!==e.pageY){var n=t.div.offset(),o=new O(e.pageX-n.left,e.pageY-n.top),s=t.controller.converter.fromPixels(o.x,o.y),r=new J(l,l);r.extend(s),r.refreshCenter(),t.controller.onZoomSelection(r)}}),i.mousemove(function(e){var i=t.div.offset(),n=h.pageX-i.left,o=h.pageY-i.top,s=e.pageX-h.pageX,r=e.pageY-h.pageY;s<0&&(n+=s,s*=-1),r<0&&(o+=r,r*=-1),a.width(s),a.height(r),a.css({left:n,top:o})})};t.geolayer.mousemove(s);var r=function(){t.geolayer.unbind("mouseup",r),t.geolayer.unbind("mousemove",s)};t.geolayer.mouseup(r)},this.geolayer.mousedown(this._mouseDownSelectionHandler)},disableZoomSelection:function(){this.geolayer.unbind("mousedown",this._mouseDownSelectionHandler),this._mouseDownSelectionHandler=null},zoomStart:function(){for(var t in this.tiles)if("default"!==t){var e=this.tiles[t];for(var i in e)e.hasOwnProperty(i)&&e[i].remove();this.tiles[t]=[]}},destroy:function(){this.div.empty()},addTileLayer:function(t,e){this.tilelayers[t]=g('<div name="tilelayer" style="position:absolute;z-index:'+e+';"></div>'),this.geolayer.append(this.tilelayers[t]),this.tiles[t]=[]},removeTileLayer:function(t){for(var e in this.tiles)if(e===t){var i=this.tiles[e];for(var n in i)i.hasOwnProperty(n)&&i[n].remove();this.tiles[e]=[]}this.tilelayers[t].remove(),delete this.tilelayers[t],delete this.tiles[t]}}),xt=_({initialize:function(t,e,i){this.map=t,this.model=new Tt,this.view=new wt(e,this,i);var n={tooltipsOnClick:t.getFeature("tooltipsOnClick")};this.mapdescr=new St(this,n),this.converter=new kt(this.model,this.view),this.layers=[],this._dragFlag=!1,this.dblclickZoom=!0,this.mousewheelZoom=!0,this.gestureZoom=!0,this.zoomSelection=!1,this.zoomAnimation=!d,this.tooltipsOnClick=!1,this.mouseWheelTimer=200,this.mouseWheelLock=!1,this.popuplayer=new Ot(900),this.addLayer(this.popuplayer),this.zoomAnimationHelper=new bt(this.view)},setPadding:function(t){this.model.setPadding(t),this.map.isReady&&this.newStaticPosition()},setState:function(t,e){this.view.cleanBG(),this.model.setState(t,e),this.map.isReady=!0,this.model.computeTopLeftCorner(),this.newDisplayArea()},getCenter:function(){var t=this.model.topLeftCornerX,e=this.model.topLeftCornerY;return this.converter.fromPixels(t,e)},setZoomAnimation:function(t){this.zoomAnimation=t},getZoomAnimation:function(){return this.zoomAnimation},setZoom:function(t,e,i,n){w(e)&&(e=this.model.topLeftCornerX),w(i)&&(i=this.model.topLeftCornerY);var o=this.view.position();if(this.zoomAnimation&&!n){var s=this.model.getZoom();if(this.model.setZoom(t,e,i,o)){this.map.trigger("zoomstart",t);var r=this;r.view.zoomStart();var a=this.zoomAnimationHelper.finished;this.zoomAnimationHelper.zoom(this.model.getZoom()-s,e,i),a&&function e(){setTimeout(function(){r.zoomAnimationHelper.stepAnimation()?e():(r.newDisplayArea(),r.map.trigger("zoomend",t))},13)}()}}else this.model.setZoom(t,e,i,o)&&(this.map.trigger("zoomstart",t),this.newDisplayArea(),this.map.trigger("zoomend",t))},setViewMode:function(t){if(this.map.isReady){this.map.trigger("changestart","viewmode"),this.model.setViewMode(t);var e=t.zoomable(this.model.getZoom());if(-1!==e)this.setZoom(e);else{this.view.clean(),this.refreshTiles();var i=this.view.position(),n=this.model.getTiles(i.left,i.top);this.mapdescr.newDisplayArea(),this.mapdescr.refresh(n)}this.map.trigger("changeend","viewmode"),this.map.trigger("viewmodechanged",t.name)}else this.model.setViewMode(t)},newDisplayArea:function(){this.map.trigger("changestart","newDisplayArea");var t=this.model.getTiles(0,0);this.view.reset(),this.view.setTiles(t,this.model.centerX-this.model.topLeftCornerX,this.model.centerY+this.model.topLeftCornerY),this.refreshLayers(),this.mapdescr.newDisplayArea(),this.mapdescr.refresh(t),this.map.trigger("changeend","newDisplayArea")},refreshLayers:function(){for(var t=0;t<this.layers.length;t+=1)this.layers[t].newDisplayArea()},refreshTiles:function(t,e){var i=this.view.position(),n=this.model.getTiles(i.left,i.top,t);return this.view.setTiles(n,this.model.centerX-this.model.topLeftCornerX,this.model.centerY+this.model.topLeftCornerY,e),this._dragFlag=!1,n},newStaticPosition:function(){var t=this.refreshTiles();this.view.destroyExtraTiles(t),this.mapdescr.refresh(t)},addLayer:function(t){t.added(this),this.layers.push(t)},removeLayer:function(t){t.removed();var e=g.inArray(t,this.layers);-1!==e&&this.layers.splice(e,1)},removeLayerByName:function(t){for(var e=0,i=this.layers.length;e<i;e++)t===this.layers[e].name&&this.removeLayer(this.layers[e])},getCoordinatesFromEvent:function(t){var e;if(this.map.isReady){var i=this.view.leftTopFromEvent(t);e=this.converter.fromPixels(i.left,i.top)}return e},getBgPois:function(){return this.mapdescr.getPois()},slideBy:function(t,e,i){this.map.trigger("changestart","slide",i);var n=this;this.view.slide(t,e,null,function(){var t=n.refreshTiles();n.view.destroyExtraTiles(t),n.mapdescr.refresh(t),n.map.trigger("changeend","slide",i)})},slideTo:function(t){var e=this.converter.toGeolayerPixels(this.getCenter()),i=this.converter.toGeolayerPixels(t);this.slideBy(e.x-i.x,e.y-i.y)},slideToBounds:function(t,e){var i=0,n=0,o=this.view.position(),s=this.model.getPadding(),r=this.model.getSize();t.minX+o.left-s.left<0?i=-(t.minX+o.left-s.left):t.maxX+o.left+s.right-r.width>0&&(i=-(t.maxX+o.left+s.right-r.width)),t.minY+o.top-s.top<0?n=-(t.minY+o.top-s.top):t.maxY+o.top+s.bottom-r.height>0&&(n=-(t.maxY+o.top+s.bottom-r.height)),0===i&&0===n||this.slideBy(i,n,e)},enableDraggable:function(){this.view.enableDraggable(),this.map.trigger("controlchanged","draggable")},disableDraggable:function(){this.view.disableDraggable(),this.map.trigger("controlchanged","draggable")},enableZoomSelection:function(){this.zoomSelection||(this.disableDraggable(),this.view.enableZoomSelection(),this.zoomSelection=!0)},disableZoomSelection:function(){this.zoomSelection&&(this.view.disableZoomSelection(),this.zoomSelection=!1)},enableTooltipsOnClick:function(){this.tooltipsOnClick=!0},disableTooltipsOnClick:function(){this.tooltipsOnClick=!1},drag:function(t){this._dragFlag||d||(this._dragFlag=!0,setTimeout(T(this.refreshTiles,this),200)),this.map.trigger("drag",t)},dragStart:function(t){this.view.cleanBG(),this.map.dragging=!0,this.map.trigger("changestart","drag"),this.map.trigger("dragstart",t)},dragStop:function(t){this.newStaticPosition(),this.map.dragging=!1,this.map.trigger("changeend","drag"),this.map.trigger("dragstop",t)},click:function(t){this.map.trigger("click",t,this.getCoordinatesFromEvent(t))},dblclick:function(t){if(!0===this.dblclickZoom){var e=this.view.leftTopFromEvent(t);this.setZoom(this.model.getZoom()+1,e.left,e.top)}this.map.trigger("dblclick",t,this.getCoordinatesFromEvent(t))},mousedown:function(t){this.map.trigger("mousedown",t,this.getCoordinatesFromEvent(t))},mouseup:function(t){2===t.button?this.map.trigger("rightclick",t,this.getCoordinatesFromEvent(t)):this.map.trigger("mouseup",t,this.getCoordinatesFromEvent(t))},mousemove:function(t){this.map.trigger("mousemove",t)},mousewheel:function(t,e){if(!f||!0!==this.mouseWheelLock){if(f&&(this.mouseWheelLock=!0,setTimeout(T(function(){this.mouseWheelLock=!1},this),this.mouseWheelTimer)),!0===this.mousewheelZoom){var i=e>0?1:-1,n=this.view.leftTopFromEvent(t);this.setZoom(this.model.getZoom()+i,n.left,n.top),Z(t)}this.map.trigger("mousewheel",t,e)}},mouseout:function(t){this.map.trigger("mouseout",t)},mouseover:function(t){this.map.trigger("mouseover",t)},resize:function(t,e){var i=t,n=e;if(this.map.trigger("beforeresize",t,e),void 0===t&&void 0===e&&(i=this.map.div.width(),n=this.map.div.height()),this.model.setSize(i,n),this.map.isReady){this.setState(this.getCenter(),this.model.zoom);var o=this.model.getTiles(0,0);this.view.reset(),this.view.setTiles(o,this.model.centerX-this.model.topLeftCornerX,this.model.centerY+this.model.topLeftCornerY),this.refreshLayers(),this.mapdescr.newDisplayArea(),this.mapdescr.refresh(o)}this.map.trigger("resize",t,e)},touchmove:function(t){this.map.trigger("touchmove",t)},touchstart:function(t){p&&this.gestureZoom&&t.touches.length>1&&(this._dblTouch=!0,this._gestureStartEvent={pageX:(t.touches[0].pageX+t.touches[1].pageX)/2,pageY:(t.touches[0].pageY+t.touches[1].pageY)/2},this._gestureStartPosition=this.view.position()),this.map.trigger("touchstart",t)},touchend:function(t){p&&this._dblTouch&&(this.setZoom(this.model.getZoom()-1),this._dblTouch=!1),this.map.trigger("touchend",t)},gesturestart:function(t){if(this.gestureZoom)for(var e in this.layers)this.layers[e].isHidden||this.layers[e].hide();this.map.trigger("gesturestart",t)},gestureend:function(t,e){var i;if(this.gestureZoom)for(var n in this.view.setScale(1,this._gestureStartPosition.left,this._gestureStartPosition.top),t.scale>2?(i=this.view.leftTopFromEvent(this._gestureStartEvent),this.setZoom(this.model.getZoom()+1,i.left,i.top,!0)):t.scale<.5&&(i=this.view.leftTopFromEvent(this._gestureStartEvent),this.setZoom(this.model.getZoom()-1,i.left,i.top,!0)),this.layers)this.layers[n].show();this.map.trigger("gestureend",t)},gesturechange:function(t){if(this.gestureZoom){this._dblTouch=!1;var e=t.scale,i=this._gestureStartPosition,n=this.view.leftTopFromEvent(this._gestureStartEvent),o=i.left+(i.left-n.left)*(e-1),s=i.top+(i.top-n.top)*(e-1);this.view.setScale(e,o,s)}this.map.trigger("gesturechange",t)},onZoomSelection:function(t){this.setState(t.center,this.model.getBoundsZoomLevel(t))},addTileLayer:function(t,e){if(!this.model.viewModes[t.name]&&(t._refreshTask(this),this.model.addTileLayer(t),this.view.addTileLayer(t._realName,e),this.map.isReady)){var i=this.refreshTiles(t.name);this.mapdescr.refresh(i)}},removeTileLayer:function(t){var e=this.model.getTileLayers();if(b(e[t])){e[t]._stopRefreshTask(!0),this.view.removeTileLayer(e[t]._realName),this.model.removeTileLayer(t);var i=this.model.getTiles(0,0);this.mapdescr.newDisplayArea(),this.mapdescr.refresh(i)}},getTileLayers:function(){return this.model.getTileLayers()},hideTraffic:function(){b(this.trafficViewmode)&&(this.removeTileLayer(this.trafficViewmode.name),delete this.trafficViewmode)},showTraffic:function(t){var e="traffic_road_conditions";!0===t&&(e+=";traffic_events");var i=new pt(e);b(this.trafficViewmode)&&this.hideTraffic(),this.addTileLayer(i),this.trafficViewmode=i}}),Tt=_({initialize:function(){this.viewModes={},this.viewModes.default=new pt("standard"),this.refreshResolutions(),this.padding={left:0,top:0,right:0,bottom:0}},refreshResolutions:function(){var t=this.viewModes.default.slabSize;this.resolutions=[];for(var e=0,i=pt.mMaxZoomLevel;e<=i;e+=1)this.resolutions[e]=t*Math.pow(3,e)},setSize:function(t,e){this.width=t,this.height=e,this.halfWidth=t/2,this.halfHeight=e/2,this.computeTopLeftCorner()},getSize:function(){return new I(this.width,this.height)},setPadding:function(t){b(t.left)&&(this.padding.left=t.left),b(t.top)&&(this.padding.top=t.top),b(t.right)&&(this.padding.right=t.right),b(t.bottom)&&(this.padding.bottom=t.bottom)},getPadding:function(){return this.padding},setCenter:function(t){this.center=t,this.computeCenter()},computeCenter:function(){if(b(this.center)){var t=this.getResolution(),e=this.center;this.centerX=P(e._x*t),this.centerY=P(e._y*t)}},computeTopLeftCorner:function(){this.topLeftCornerX=P(this.halfWidth+(this.padding.left-this.padding.right)/2),this.topLeftCornerY=P(this.halfHeight+(this.padding.top-this.padding.bottom)/2)},getResolution:function(){return this.resolutions[this.zoom]},getMeterPerPixel:function(){return 6378140*Math.PI/this.getResolution()},setZoom:function(t,e,i,n){var o=parseInt(t);if(o==this.zoom||o<this.viewModes.default.minZoomLevel||o>this.viewModes.default.maxZoomLevel)return!1;if(0==n.left&&0==n.top||(this.center=this.offsetCenter(-n.left,-n.top),this.computeCenter()),e!=this.topLeftCornerX||i!=this.topLeftCornerY){var s=1-Math.pow(3,this.zoom-o);this.center=this.offsetCenter((e-this.topLeftCornerX)*s,(i-this.topLeftCornerY)*s),this.computeCenter()}return this.zoom=o,this.computeCenter(),!0},getZoom:function(){return parseInt(this.zoom)},offsetCenter:function(t,e){var i=this.getResolution(),n=this.centerX+t,o=this.centerY-e;return q.fromNormalized(n/i,o/i)},setState:function(t,e){this.center=t,this.zoom=e,this.computeCenter()},setViewMode:function(t){this.viewModes.default=t,this.refreshResolutions(),this.setBackgroundType(t.name)},getViewMode:function(){return this.viewModes.default},getPointXY:function(t,e){e||(e=new O(0,0));var i=this.getResolution();return e.x=P(t._x*i-this.centerX+this.topLeftCornerX),e.y=P(this.centerY+this.topLeftCornerY-t._y*i),e},getGeoPoint:function(t,e){var i=this.centerX-this.topLeftCornerX+t,n=this.centerY+this.topLeftCornerY-e,o=this.getResolution();return q.fromNormalized(i/o,n/o)},getBoundsZoomLevel:function(t){for(var e=this.width-this.padding.left-this.padding.right,i=this.height-this.padding.top-this.padding.bottom,n=t.getDeltaX(),o=t.getDeltaY(),s=pt.mMaxZoomLevel,r=this.resolutions,a=n*r[s],l=o*r[s];(a>e||l>i)&&s>0;)a=n*r[--s],l=o*r[s];return s},getTiles:function(t,e,i){var n={},o=this.zoom;if(b(o)){var s=this.viewModes.default.slabSize,r=this.centerX-this.topLeftCornerX-t,a=this.centerY+this.topLeftCornerY+e,l=P(r/s),h=P((r+this.width)/s),c=P(a/s),u=P((a-this.height)/s),d=pt.tileMaxIds[o][0],p=pt.tileMaxIds[o][1];for(var f in l<0&&(l=0),u<0&&(u=0),h>d&&(h=d),c>p&&(c=p),this.viewModes)if(!i||i===f){for(var m=[],g=l;g<=h;g+=1)for(var v=u;v<=c;v+=1)m.push(new dt(g,v,o,this.viewModes[f]));n[f]=m}}return n},addTileLayer:function(t){this.viewModes[t.name]=t},getTileLayers:function(){return this.viewModes},removeTileLayer:function(t){delete this.viewModes[t]},clearTileLayers:function(){this.viewModes={}},setBackgroundType:function(t){for(var e in this._bgType=t,this.viewModes)this.viewModes[e]._updateRealName(this)}}),St=_({_tiles:null,_pois:null,_providers:null,_zoomLevel:0,initialize:function(t,e){this._controller=t,this._tiles={},this._pois={},this._providers={};var i=this;t.map.addListener("click",function(t){n(t,{checkClickeable:!0})}),t.map.addListener("mousemove",function(t){n(t)});var n=function(e,n){n=n||{};var o=!1,s=t.map;if(!s.dragging){var r=t.view.position(),a=t.view.div.offset(),l=e.pageX-a.left-r.left,h=e.pageY-a.top-r.top;for(var c in i._pois)for(var u=i._pois[c],d=0;d<u.length;d+=1)!o&&u[d].isOver(l,h)?(n.checkClickeable&&u[d].isClickeable()&&s.trigger("bgpoiclick",u[d].item),("mousemove"===e.type&&!t.tooltipsOnClick||"click"===e.type&&t.tooltipsOnClick)&&u[d].openToolTip(e),o=!0):("click"===e.type||"mousemove"===e.type&&!t.tooltipsOnClick)&&u[d].closeToolTip()}};t.map.addListener("touchstart",function(e){setTimeout(function(){if(!t.map.dragging){var i={type:"click"};e.touches&&e.touches.length?(i.pageX=e.touches[0].pageX,i.pageY=e.touches[0].pageY):(i.pageX=e.pageX,i.pageY=e.pageY),n(i,{checkClickeable:!0})}},100)});var o=function(){for(var t in i._pois)for(var e=i._pois[t],n=0;n<e.length;n+=1)e[n].closeToolTip()};t.map.addListener("mouseout",function(){!t.tooltipsOnClick&&o()}),t.map.addListener("zoomstart",o)},newDisplayArea:function(){for(var t in this._tiles){if(this._pois[t])for(var e=0;e<this._pois[t].length;e+=1)this._pois[t][e].destroy();this._pois[t]=[],this._providers[t]=[]}this._controller.map.copyrights.setText(this._providers)},refresh:function(t){this._pois={},this._providers={};var e=this._controller.model.getTileLayers(),i=this._controller.map.getZoomLevel();for(var n in t){this._pois[n]=[],this._providers[n]=[],this._tiles[n]||(this._tiles[n]={});var o,s=[],r=e[n];this._zoomLevel=i;for(var a=0;a<t[n].length;a+=1)o=t[n][a],w(this._tiles[n][o.key])&&r.checkSy(o)&&r.checkSx(o)&&s.push(o.sx+","+o.sy);if(this._controller.map.copyrights.remove(),s.length>0){var l=new ot;l.configure(s.join(";"),this._controller.model.getZoom(),r);var h=this;!function(i,n){l.submit(function(o){n===h._controller.model.getZoom()&&(h._providers[i]=[],h._updateTilesList(h._tiles[i],o,e[i].name),h._refreshTilesInfos(t[i],i),h._controller.map.copyrights.setText(h._providers)),h._controller.map.trigger("refreshdescr")})}(n,this._controller.model.getZoom())}else this._refreshTilesInfos(t[n],n),this._controller.map.copyrights.setText(this._providers)}},getPois:function(){return this._pois},_refreshTilesInfos:function(t,e){var i={};this._providers[e]={},this._pois[e]=[];for(var n=0;n<t.length;n++)if(b(this._tiles[e][t[n].key])){var o=this._tiles[e][t[n].key];i[o.sid]=o.key;for(var s=0;s<o.items.length;s++){var r=o.items[s];this._pois[e].push(new ut(r,r.properties.type,this._controller,i[o.sid]))}for(var a=o.copyrights,l=0;l<a.length;l++)w(this._providers[e][a[l].name])&&(this._providers[e][a[l].name]={}),this._providers[e][a[l].name][o.key]=!0}},_updateTilesList:function(t,e,i){for(var n=0;n<e.length;n+=1){var o=e[n].sid.split("/");e[n].key=dt.prototype.getKey(o[1],o[2],o[0],i),t[e[n].key]=e[n]}}}),kt=(h.map.DescrService=_({request:0,initialize:function(){this.request=new ot},send:function(t,e,i){if(!t.bounds||!b(t.zoom)||!t.viewMode)throw"Mappy.api.route.DescrService : errors in options";this.request.configure(t.bounds,t.zoom,t.viewMode,"geoBounds"),K(this.request,e,i)}}),_({initialize:function(t,e){this.model=t,this.view=e},toGeolayerPixels:function(t,e){return this.model.getPointXY(t,e)},fromPixels:function(t,e){var i=this.view.position();return this.model.getGeoPoint(t-i.left,e-i.top)},fromGeolayerPixels:function(t,e){return this.model.getGeoPoint(t,e)}}));function Lt(t,e,i){if(document.createElement("canvas").getContext)return new Pt(t,e,i);if(!0===g.browser.msie){var n=new Et(t,i);if(document.namespaces){for(var o=!1,s=0;s<document.namespaces.length;s+=1){var r=document.namespaces(s);if("v"===r.name){if("urn:schemas-microsoft-com:vml"!==r.urn)break;o=!0}}o||document.namespaces.add("v","urn:schemas-microsoft-com:vml")}return n}return new zt(t,e,i)}var Ct=_({initialize:function(t,e,i){this.type=i,this.div=g('<div style="position:absolute;"></div>'),t&&t[0].ownerDocument!==this.div[0].ownerDocument&&(this.div=g(t[0].ownerDocument.createElement("div")),this.div.css({position:"absolute"})),t.append(this.div),this.div.hide(),this._delta=e||0,this.style=new Rt,this.lineCap="round",this.lineJoin="round",this.shadowColor="black",this.shadowBlur=0},setStyle:function(t){b(t)&&(this.style=t)},getStyle:function(){return this.style},refreshStyle:function(){},setBoundingBox:function(t){this._bbox=t,this.div.css("left",this._bbox.minX-this._delta),this.div.css("top",this._bbox.minY-this._delta)},clean:function(){this.div.hide(),delete this._bbox,this.div.empty()},removed:function(){this.div.remove()},buildPath:function(t){var e,i=t.length,n=[[]];if(i>1){var o=this._bbox,s=o.minX,r=o.minY,a=o.maxX,l=o.maxY,h=Mt;for(e=1;e<i;e+=1)h(s,r,a,l,t[e-1].x,t[e-1].y,t[e].x,t[e].y,n)}for(e=n.length-1;e>=0;e-=1)n[e].length<4&&n.splice(e,1);return n},buildPolygon:function(t){return function(t,e){t.length;for(var i,n,o,s,r=[],a=e.minX,l=e.minY,h=e.maxX,c=e.maxY,u=t[t.length-1],d=0,p=Math.round,f=0,m=t.length;f<m;f+=1){i=u,u=t[f],0===r.length&&i.x>=a&&i.x<=h&&i.y>=l&&i.y<=c&&(d+=1,r.push(p(i.x)),r.push(p(i.y)));var g=At(a,0,a,1,i.x,i.y,u.x,u.y),v=At(h,0,h,1,i.x,i.y,u.x,u.y),y=At(0,l,1,l,i.x,i.y,u.x,u.y),_=At(0,c,1,c,i.x,i.y,u.x,u.y);g>v&&(s=g,g=v,v=s),y>_&&(s=y,y=_,_=s),g>y&&(s=g,g=y,y=s),v>_&&(s=v,v=_,_=s),v>y&&(s=v,v=y,y=s),g>=0&&g<=1&&(n=i.x+(u.x-i.x)*g,o=i.y+(u.y-i.y)*g,n=Math.max(n,a),n=Math.min(n,h),o=Math.max(o,l),o=Math.min(o,c),r.push(p(n)),r.push(p(o))),v>=0&&v<=1&&(n=i.x+(u.x-i.x)*v,o=i.y+(u.y-i.y)*v,n=Math.max(n,a),n=Math.min(n,h),o=Math.max(o,l),o=Math.min(o,c),r.push(p(n)),r.push(p(o))),y>=0&&y<=1&&(n=i.x+(u.x-i.x)*y,o=i.y+(u.y-i.y)*y,n=Math.max(n,a),n=Math.min(n,h),o=Math.max(o,l),o=Math.min(o,c),r.push(p(n)),r.push(p(o))),_>=0&&_<=1&&(n=i.x+(u.x-i.x)*_,o=i.y+(u.y-i.y)*_,n=Math.max(n,a),n=Math.min(n,h),o=Math.max(o,l),o=Math.min(o,c),r.push(p(n)),r.push(p(o))),0!==r.length&&u.x>=a&&u.x<=h&&u.y>=l&&u.y<=c&&(d+=1,r.push(p(u.x)),r.push(p(u.y)))}return r.length>4&&(0!==d||function(t){for(var e=0,i=0,n=t.length-2;i<n;i+=2)e+=(t[i]+t[i+2])*(t[i+1]-t[i+3]);return e+=(t[i]+t[0])*(t[i+1]-t[1]),.5*Math.abs(e)}(r)>1)?r:[]}(t,this._bbox)}});function Mt(t,e,i,n,o,s,r,a,l){var h,c,u=!1,d=!1,p=!1,f=(a-s)/(r-o);if(r<o&&(c=r,r=o,o=c,c=a,a=s,s=c,p=!0),o<t){if(r<=t)return-1;s+=f*(t-o),o=t,u=!0}if(r>i){if(o>=i)return-1;a-=f*(r-i),r=i,d=!0}if(a<s&&(c=r,r=o,o=c,c=a,a=s,s=c,h=d,d=u,u=h,p=!p),s<e){if(a<=e)return-1;o+=(e-s)/f,s=e,u=1}if(a>n){if(s>=n)return-1;r-=(a-n)/f,a=n,d=1}p&&(c=r,r=o,o=c,c=a,a=s,s=c,h=d,d=u,u=h);var m=u+2*d,g=Math.round,v=l[l.length-1];0===m?(0===v.length&&(v.push(g(o)),v.push(g(s))),v.push(g(r)),v.push(g(a))):m>0&&(v.push(g(o)),v.push(g(s)),v.push(g(r)),v.push(g(a)),m>1&&l.push([]))}function At(t,e,i,n,o,s,r,a){var l,h,c,u,d,p,f=(a-s)*(i-t)-(n-e)*(r-o);return 0!==f?((n-e)*(o-t)-(i-t)*(s-e))/f:(h=e,u=n,d=r,p=a,((c=i)===(l=t)?d===l:p-d*(u-h)/(c-l)+(l*u-h*c)/(c-l)==0)?0:-1)}var Pt=_(Ct,{initialize:function(t,e,i){Ct.prototype.initialize.call(this,t,e,i);var n=g('<canvas name="mappy-route-layer"></canvas>');this.div.append(n);var o=n[0];this._ctx=o.getContext("2d")},getStrokeStyle:function(){var t=this.style.getStrokeStyle();return"rgba("+parseInt(t.substr(6,2),16)+", "+parseInt(t.substr(4,2),16)+", "+parseInt(t.substr(2,2),16)+", "+parseInt(t.substr(0,2),16)/256+")"},getFillStyle:function(){var t=this.style.getFillStyle();return"rgba("+parseInt(t.substr(6,2),16)+", "+parseInt(t.substr(4,2),16)+", "+parseInt(t.substr(2,2),16)+", "+parseInt(t.substr(0,2),16)/256+")"},refreshStyle:function(){switch(this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this.type){case"line":this.line(this.points);break;case"polygon":this.polygon(this.points);break;case"circle":this.circle(this.center,this.radius)}},setBoundingBox:function(t){Ct.prototype.setBoundingBox.call(this,t),this._ctx.canvas.width=this._bbox.maxX-this._bbox.minX+2*this._delta,this._ctx.canvas.height=this._bbox.maxY-this._bbox.minY+2*this._delta},_path:function(t){for(var e,i=this.buildPath(t),n=this._ctx,o=this._delta-this._bbox.minX,s=this._delta-this._bbox.minY,r=0;r<i.length;r+=1){e=i[r],n.beginPath(),n.moveTo(e[0]+o,e[1]+s);for(var a=2;a<e.length;a+=2)n.lineTo(e[a]+o,e[a+1]+s);this._ctx.stroke()}},line:function(t){this.points=t,b(this._bbox)&&(this._ctx.lineWidth=this.style.getLineWidth(),this._ctx.strokeStyle=this.getStrokeStyle(),this._ctx.lineCap=this.lineCap,this._ctx.lineJoin=this.lineJoin,this._ctx.shadowColor=this.style.getShadowColor(),this._ctx.shadowBlur=this.style.getShadowBlur(),this._path(t),this.div.show())},_polygon:function(t){var e=this.buildPolygon(t),i=this._ctx,n=this._delta-this._bbox.minX,o=this._delta-this._bbox.minY;i.beginPath(),i.moveTo(e[0]+n,e[1]+o);for(var s=2;s<e.length;s+=2)i.lineTo(e[s]+n,e[s+1]+o);i.fill(),i.closePath(),this.style.getLineWidth()>0&&i.stroke()},polygon:function(t){this.points=t,b(this._bbox)&&(this._ctx.strokeStyle=this.getStrokeStyle(),this._ctx.fillStyle=this.getFillStyle(),this._ctx.lineWidth=this.style.getLineWidth(),this._polygon(t),this.div.show())},circle:function(t,e){this.center=t,this.radius=e,b(this._bbox)&&(this._ctx.lineWidth=this.style.getLineWidth(),this._ctx.strokeStyle=this.getStrokeStyle(),this._ctx.fillStyle=this.getFillStyle(),this._ctx.beginPath(),this._ctx.arc(t.x-this._bbox.minX+this._delta,t.y-this._bbox.minY+this._delta,e,0,2*Math.PI,!0),this._ctx.fill(),this._ctx.stroke(),this.div.show())},clean:function(){this.points=[],this.div.hide(),delete this._bbox,this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}}),zt=_(Ct,{initialize:function(t,e,i){Ct.prototype.initialize.call(this,t,e,i)},getStrokeColor:function(){var t=this.style.getStrokeStyle();return"#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)},getStrokeOpacity:function(){var t=this.style.getStrokeStyle();return parseInt(t.substr(0,2),16)/256},getFillColor:function(){var t=this.style.getFillStyle();return"#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)},getFillOpacity:function(){var t=this.style.getFillStyle();return parseInt(t.substr(0,2),16)/256},refreshStyle:function(){if(b(this.div[0].firstChild))switch(this.type){case"line":this.div[0].firstChild.firstChild.setAttribute("stroke",this.getStrokeColor()),this.div[0].firstChild.firstChild.setAttribute("stroke-opacity",this.getStrokeOpacity()),this.div[0].firstChild.firstChild.setAttribute("stroke-width",this.style.getLineWidth());break;case"polygon":case"circle":this.div[0].firstChild.firstChild.setAttribute("stroke",this.getStrokeColor()),this.div[0].firstChild.firstChild.setAttribute("stroke-opacity",this.getStrokeOpacity()),this.div[0].firstChild.firstChild.setAttribute("stroke-width",this.style.getLineWidth()),this.div[0].firstChild.firstChild.setAttribute("fill",this.getFillColor()),this.div[0].firstChild.firstChild.setAttribute("fill-opacity",this.getFillOpacity())}},_init:function(){var t=this._bbox.maxX-this._bbox.minX+2*this._delta,e=this._bbox.maxY-this._bbox.minY+2*this._delta;return'<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+t+'" height="'+e+'" viewBox="'+(this._bbox.minX-this._delta)+" "+(this._bbox.minY-this._delta)+" "+t+" "+e+'">'},_end:function(t){t+="</svg>";var e=(new DOMParser).parseFromString(t,"text/xml");this.svg=e.childNodes[0],this.div.append(this.svg)},_path:function(t){for(var e,i='<path stroke-linejoin="'+this.lineJoin+'" stroke-linecap="'+this.lineCap+'" fill="none" d="',n=this.buildPath(t),o=0;o<n.length;o+=1)(e=n[o]).splice(0,0," M"),e.splice(3,0,"L"),i+=e.join(" ");return i+='"/>'},_polygon:function(t){var e='<polygon  points="';return e+=this.buildPolygon(t).join(" "),e+='"/>'},line:function(t){if(b(this._bbox)){var e=this._init();e+=this._path(t),this._end(e),this.refreshStyle(),this.div.show()}},polygon:function(t){if(b(this._bbox)){var e=this._init();e+=this._polygon(t),this._end(e),this.refreshStyle(),this.div.show()}},_circle:function(t,e){return'<circle cx="'+t.x+'" cy="'+t.y+'" r="'+e+'" />'},circle:function(t,e){if(b(this._bbox)){var i=this._init();i+=this._circle(t,e),this._end(i),this.refreshStyle(),this.div.show()}}}),Et=_(Ct,{initialize:function(t,e){Ct.prototype.initialize.call(this,t,0,e)},getStrokeColor:function(){var t=this.style.getStrokeStyle();return"#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)},getStrokeOpacity:function(){var t=this.style.getStrokeStyle();return parseInt(t.substr(0,2),16)/256},getFillColor:function(){var t=this.style.getFillStyle();return"#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)},getFillOpacity:function(){var t=this.style.getFillStyle();return parseInt(t.substr(0,2),16)/256},refreshStyle:function(){var t=this.div[0];t.onselectstart=function(){return event&&(event.returnValue=!1),!1};var e="circle"===this.type?"oval":"shape",i=t.getElementsByTagName(e);i.length>0&&(i[0].strokecolor=this.getStrokeColor(),i[0].fillcolor=this.getFillColor(),i[0].strokeweight=this.style.getLineWidth()+"px",0===this.style.getLineWidth()&&(i[0].stroked="false"));var n=t.getElementsByTagName("stroke");n.length>0&&(n[0].opacity=this.getStrokeOpacity());var o=t.getElementsByTagName("fill");o.length>0&&(o[0].opacity=this.getFillOpacity())},_path:function(t){for(var e,i='<v:shape coordorigin="0 0" coordsize="1 1" filled="false" style="position: absolute;width:1px; height:1px;behavior: url(#default#VML);" path="',n=this.buildPath(t),o=this._delta-this._bbox.minX,s=this._delta-this._bbox.minY,r=0;r<n.length;r+=1){e=n[r];for(var a=0;a<e.length;a+=2)e[a]+=o,e[a+1]+=s;e[0]="M"+e[0],e[2]=" L"+e[2],i+=e.join(" ")+" E "}return i+='"><v:stroke joinstyle="'+this.lineJoin+'" endcap = "'+this.lineCap+'"  style="behavior: url(#default#VML);"/></v:shape>'},_poly:function(t){for(var e='<v:shape coordorigin="0 0" coordsize="1 1" filled="true" style="position: absolute;width:1px; height:1px;behavior: url(#default#VML);" path="',i=this.buildPolygon(t),n=this._delta-this._bbox.minX,o=this._delta-this._bbox.minY,s=0;s<i.length;s+=2)i[s]+=n,i[s+1]+=o;return i[0]="M"+i[0],i[2]=" L"+i[2],e+=i.join(" ")+" X E ",e+='">',this.style.getLineWidth()>0&&(e+='<v:stroke joinstyle = "'+this.lineJoin+'" endcap = "'+this.lineCap+'"  style="behavior: url(#default#VML);"/>'),e+='<v:fill style="behavior: url(#default#VML);"></v:fill></v:shape>'},line:function(t){if(b(this._bbox)){var e=this._path(t);this.div[0].insertAdjacentHTML("beforeEnd",e),this.refreshStyle(),this.div.show()}},polygon:function(t){if(b(this._bbox)){var e=this._poly(t);this.div[0].insertAdjacentHTML("beforeEnd",e),this.refreshStyle(),this.div.show()}},circle:function(t,e){if(b(this._bbox)){var i="<v:oval style='position:relative;width:"+2*e+";height:"+2*e+";behavior: url(#default#VML);'>";i+='<v:fill style="behavior: url(#default#VML);"></v:fill>',i+="</v:oval>",this.div[0].insertAdjacentHTML("beforeEnd",i),this.refreshStyle(),this.div.show()}}}),Nt=_({isOnMap:!1,isHidden:!1,initialize:function(t,e,i){this.name=t,this.zIndex=e,this.div=g('<div name="'+t+'" class="layer"></div>'),this.div.css("z-index",e),this.div.css("position","absolute"),i||(i={}),i.hidden&&this.hide()},added:function(t){t.view.geolayer.append(this.div),this._controller=t,this.isOnMap=!0},newDisplayArea:function(){},removed:function(){this.div.remove(),this.isOnMap=!1},hide:function(){this.div.hide(),this.isHidden=!0},show:function(){this.div.show(),this.isHidden=!1},clean:function(){this.div.empty()}}),Dt=h.map.layer.MarkerLayer=_(Nt,{markers:null,clusters:null,markersCount:0,initialize:function(t,e){t=t||50,Nt.prototype.initialize.call(this,"markerLayer",t,e),this.markers=[],this.clusters=[]},added:function(t){Nt.prototype.added.call(this,t),this.div.mousedown(function(t){t.stopPropagation()}),u&&this.div[0].addEventListener("touchstart",function(t){t.stopPropagation()}),this._map=t.map,t.map.addListener("zoomstart",T(this._zoomStartHandler,this)),t.map.addListener("zoomend",T(this._zoomEndHandler,this));for(var e=0;e<this.markersCount;e+=1)!1===this.markers[e].isOnMap&&this.markers[e].added(this.div,t)},newDisplayArea:function(){var t;for(t=0;t<this.clusters.length;t+=1)this.clusters[t].removed();for(this.clusters=[],t=0;t<this.markersCount;t+=1)this.markers[t].destroyTail(),this.markers[t].setPosition()},addMarker:function(t){-1===g.inArray(t,this.markers)&&(this.isOnMap&&t.added(this.div,this._controller),this.markers.push(t),this.markersCount+=1)},addMarkers:function(t){for(var e=0;e<t.length;e+=1)this.addMarker(t[e])},_zoomStartHandler:function(){this.div.hide()},_zoomEndHandler:function(){!1===this.isHidden&&this.div.show()},removeMarker:function(t){var e=g.inArray(t,this.markers);return-1!==e&&(this.markers.splice(e,1),this.markersCount-=1,t.removed(),!0)},getMarkers:function(){return this.markers},closeAllPopup:function(){for(var t=this.markers,e=0,i=this.markersCount;e<i;e+=1)t[e].closePopUp()},clean:function(){for(;this.markersCount>0;)this.removeMarker(this.markers[0]);Nt.prototype.clean.call(this)},getBounds:function(){if(this.markersCount>0){for(var t=this.markers,e=new J(t[0].coordinates,t[0].coordinates),i=0;i<this.markersCount;i+=1)e.extend(t[i].coordinates);return e.refreshCenter(),e}return null},conglomerate:function(t,e){t=t||new W({cssClass:"default-cluster",image:o+"img/poi/anis_cluster.png",size:new I(34,34),iconAnchor:new O(17,17),popUpAnchor:new O(17,0)}),this.clusters=function(t,e,i,n,o){var s,r,a=100,l=o||5,h=[];if(t.length>0){var c=n.getSize();for(function(t){var i=0,n=0,o=[!1,!1];do{do{h.push(new vt(new F(t.minX+i*a,t.minY+n*a,t.minX+(i+1)*a,t.minY+(n+1)*a),e)),t.minX+(i+1)*a<=t.maxX?i+=1:o[0]=!0}while(!1===o[0]);o[0]=!1,t.minY+(n+1)*a<=t.maxY?(n+=1,i=0):o[1]=!0}while(!1===o[1])}(new F(0,0,c.width,c.height)),s=0;s<t.length;s+=1)for(r=0;r<h.length;r+=1)if(h[r].contains(t[s])){h[r].markers.push(t[s]);break}for(s=h.length-1;s>=0;s-=1)if(h[s].markers.length<l)h.splice(s,1);else{for(r=0;r<h[s].markers.length;r+=1)h[s].markers[r].hide();h[s].added(i,n.controller)}}return h}(this.markers,t,this.div,this._map,e)},explode:function(){!function(t){var e,i=[[0,-1],[-1,0],[1,0],[0,1],[0,0]],n=.95,o=.6,s=1e-6,r={Canvas:100,PictoCenterDist:3,PictoPictoOverlap:3,PictoPictoRepulsion:.5,PictoCenterOverlap:2,LineLineOverlap:10,CenterProximity:2},a=20,l=12,h=1,c=30,u=t.length;function d(e){for(var i=0;i<u;i+=1)if(e!==i&&t[e].center.dist(t[i].center)<t[e].radius+t[i].radius)return!0;return!1}function p(t){t.r=t.center.dist(t.picto)}function f(t,e,i,n){var o=t.x,s=t.y,r=e.x,a=e.y,l=i.x,h=i.y,c=n.x,u=n.y,d=((s-h)*(c-l)-(o-l)*(u-h))/((r-o)*(u-h)-(a-s)*(c-l)),p=((s-h)*(r-o)-(o-l)*(a-s))/((r-o)*(u-h)-(a-s)*(c-l));return{test:!(d<0||d>1||p<0||p>1),r:d,s:p}}function m(t,e,i){var n=i.x-e.x,o=i.y-e.y,r=t.x-e.x,a=t.y-e.y;if(Math.abs(n)+Math.abs(o)<2*s||r*n+a*o<0)return Math.sqrt(r*r+a*a);var l=t.x-i.x,h=t.y-i.y;return l*n+h*o>0?Math.sqrt(l*l+h*h):Math.abs(r*o-a*n)/Math.sqrt(n*n+o*o)}function g(e,i){var n,o,s,r,c,d=0;n=(t[i].r-a)/l,d+=n*=n*e.PictoCenterDist;for(var p=0;p<u;p+=1)if(p!==i){if((s=t[i].picto.dist(t[p].picto))<2*a&&(n=1-s/(2*a),d+=n*=n*e.PictoPictoRepulsion),s<t[i].radius+t[p].radius&&(n=1-s/(t[i].radius+t[p].radius),d+=n*=n*e.PictoPictoOverlap),o=1.2*t[i].radius,(r=t[i].picto.dist(t[p].center))<o&&(n=1-r/o,d+=n*=n*e.PictoCenterOverlap),h>0){var g=!0;if(t[i].center.dist(t[p].center)>h){var v=f(t[i].center,t[i].picto,t[p].center,t[p].picto);v.test?(n=1+(1-v.r)*t[i].r/(t[i].radius+h),d+=e.LineLineOverlap*n):g=!1}else g=!1;!1===g&&(c=m(t[i].picto,t[p].center,t[p].picto))<(o=1.5*t[i].radius+h)&&(n=1-c/o,d+=n*=n*e.LineLineOverlap)}r<t[i].r&&(n=1-r/t[i].r,d+=n*=n*e.CenterProximity/u)}return d}function v(){var a,l=0,h=.1*c,d=r,f=0;for(a=0;a<u;a+=1)if(t[a].d>s){for(var m=t[a].picto.clone(),y=0,_=i.length-1,b=Number.MAX_VALUE,w=0;w<i.length;w+=1){t[a].picto.x=m.x+t[a].d*i[w][0],t[a].picto.y=m.y+t[a].d*i[w][1],p(t[a]);var x=g(d,a);x<b&&(y=w,b=x)}y!==_?(t[a].picto.x=m.x+t[a].d*i[y][0],t[a].picto.y=m.y+t[a].d*i[y][1],p(t[a]),t[a].d*=n,f+=t[a].d):t[a].d*=o}if((f/=u)>h&&50!=++l)e=S(v,this);else for(l=0;l<u;l+=1){var T=t[l].getIcon();t[l].pos.x=t[l].picto.x-.5*T.size.width+T.iconAnchor.x,t[l].pos.y=t[l].picto.y-.5*T.size.height+T.iconAnchor.y,t[l].setMarkerPosition(),t[l].drawTail()}}!function(){var i;for(clearTimeout(e),i=0;i<u;i+=1){var n=t[i].getIcon();t[i].radius=.5*n.size.hypot(),t[i].center=t[i].pos.clone(),t[i].picto=new O(t[i].pos.x-n.iconAnchor.x+.5*n.size.width,t[i].pos.y-n.iconAnchor.y+.5*n.size.height),p(t[i]),t[i].d=c}for(i=0;i<u;i+=1)!1===d(i)&&(t[i].d=0);e=S(v,this)}()}(this.markers)},grid:function(){!function(t,e){var i=e.getCenter();function n(t){var e=t.pos.x+i.x,n=t.pos.y+i.y,o=Math.round(e/r),s=Math.round(n/r);if(o>=0&&o<l&&s>=0&&s<l){if(null==h[o][s])h[o][s]=t;else for(var a=!1,c=1;c<=2&&!a;c++)for(var u=-c;u<=c&&!a;u++)for(var d=-c;d<=c&&!a;d++)o+d>=0&&o+d<l&&s+u>=0&&s+u<l&&null==h[o+d][s+u]&&(s+=u,h[o+=d][s]=t,a=!0);t.pos.x=o*r-i.x,t.pos.y=s*r-i.y,t.setMarkerPosition()}}if(t.length>0){var o=t[0].getIcon().size,s=o.width,r=(o.height,s+2),a=e.getSize().width,l=Math.ceil(a/r)+1;if(l>0){for(var h=new Array(l),c=0;c<l;c+=1)h[c]=new Array(l);for(c=0;c<t.length;c+=1)n(t[c])}}}(this.markers,this._map)},reset:function(){this.newDisplayArea()}}),Ot=_(Nt,{_popUps:null,initialize:function(t){Nt.prototype.initialize.call(this,"popUpLayer",t),this._popUps=[]},added:function(t){Nt.prototype.added.call(this,t),this.div.mousedown(function(t){t.stopPropagation()}),this.div.dblclick(function(t){t.stopPropagation()}),this.div.mousewheel(function(t){t.stopPropagation()}),u&&this.div[0].addEventListener("touchstart",function(t){t.stopPropagation()}),t.map.addListener("zoomstart",T(this._zoomStartHandler,this)),t.map.addListener("zoomend",T(this._zoomEndHandler,this))},_zoomStartHandler:function(){this.hide()},_zoomEndHandler:function(){this.show()},addPopUp:function(t){t.added(this._controller),this._popUps.push(t)},removePopUp:function(t){var e=g.inArray(t,this._popUps);-1!==e&&(t.removed(),this._popUps.slice(e,1))}}),It=h.map.layer.ShapeLayer=_(Nt,{_shapes:null,_movedFromLastRefresh:null,initialize:function(t,e){t=t||50,Nt.prototype.initialize.call(this,"shapeLayer",t,e),this._shapes=[],this._movedFromLastRefresh=new O(0,0)},added:function(t){Nt.prototype.added.call(this,t);var e=t.map;e.addListener("zoomstart",T(this._zoomStartHandler,this)),e.addListener("zoomend",T(this._zoomEndHandler,this)),e.addListener("changeend",T(this._redrawShapes,this)),e.addListener("dragstart",T(this._dragStartHandler,this)),e.addListener("drag",T(this._dragHandler,this)),e.addListener("mousemove",T(this._mouseMoveHandler,this)),e.addListener("mouseout",T(this._mouseOutHandler,this)),e.addListener("mousedown",T(this._mouseDownHandler,this)),e.addListener("mouseup",T(this._mouseUpHandler,this)),this._addShapes()},newDisplayArea:function(){for(var t=0;t<this._shapes.length;t+=1)this._shapes[t].calcPoints();this._redrawShapes()},_zoomStartHandler:function(){this.div.hide()},_zoomEndHandler:function(){!1===this.isHidden&&this.div.show()},_mouseMoveHandler:function(t){var e=this._shapes;if(!1===this._controller.map.dragging)for(var i=0;i<e.length;i+=1){var n=e[i];n.hasListeners&&(n.isOver?!1===n.isInShape(t)&&(n.isOver=!1,n.trigger("mouseout",t)):n.isInShape(t)&&(n.isOver=!0,n.trigger("mouseover",t)))}},_mouseOutHandler:function(t){for(var e=0;e<this._shapes.length;e+=1)this._shapes[e].isOver&&(this._shapes[e].isOver=!1,this._shapes[e].trigger("mouseout",t))},_mouseDownHandler:function(t){for(var e=0;e<this._shapes.length;e+=1)this._shapes[e].isInShape(t)&&this._shapes[e].trigger("mousedown",t);Z(t)},_mouseUpHandler:function(t){for(var e=0;e<this._shapes.length;e+=1)this._shapes[e].isInShape(t)&&this._shapes[e].trigger("mouseup",t)},_dragStartHandler:function(t){this._startEvent=t},_dragHandler:function(t){var e=this._startEvent;null!==e&&(this._movedFromLastRefresh.x+=e.pageX-t.pageX,this._movedFromLastRefresh.y+=e.pageY-t.pageY,(Math.abs(this._movedFromLastRefresh.x)>500||Math.abs(this._movedFromLastRefresh.y)>500)&&this._redrawShapes(),this._startEvent=t)},_calcViewBox:function(){var t=this._controller.model.getSize(),e=this._controller.converter,i=e.fromPixels(t.width+500,-500),n=e.fromPixels(-500,t.height+500);(i._x>1||i._y<0||n._x>1||n._y<0||i._x<n._x)&&(i=new q(180,90),n=new q(-180,-90)),this.viewBox=new J(i,n)},_redrawShapes:function(t){if("drag"!==t){this._calcViewBox();for(var e=0;e<this._shapes.length;e+=1)this._shapes[e].draw(this.viewBox);this._movedFromLastRefresh=new O(0,0)}},_addShapes:function(){for(var t=0;t<this._shapes.length;t+=1)!1===this._shapes[t].isOnMap&&this._shapes[t].added(this.div,this._controller);this._controller.map.isReady&&this.newDisplayArea()},addShape:function(t){-1===g.inArray(t,this._shapes)&&(this.isOnMap&&(t.added(this.div,this._controller),this._controller.map.isReady&&(t.calcPoints(),t.draw(this.viewBox))),this._shapes.push(t))},removeShape:function(t){var e=g.inArray(t,this._shapes);return-1!==e&&(this._shapes[e].removed(),this._shapes.splice(e,1),!0)},clean:function(){for(;this._shapes.length>0;)this.removeShape(this._shapes[0]);Nt.prototype.clean.call(this)},getBounds:function(){if(this._shapes.length>0){for(var t,e=0;e<this._shapes.length;e+=1){var i=this._shapes[e].getBounds();b(i)&&(w(t)&&(t=new J(i.sw,i.sw)),t.extend(i.sw),t.extend(i.ne))}return t.refreshCenter(),t}return null},getShapes:function(){return this._shapes}}),Ft=h.map.layer.RoadbookLayer=_(It,{_style:null,_levels:null,_roadbook:null,_idRoute:null,_showAltRoute:null,_previewAltRoute:null,initialize:function(t,e,i){It.prototype.initialize.call(this,t),this._style=e||"none",this._idRoute=-1,this._showAltRoute=i||!1,this._previewAltRoute=!1},added:function(t){It.prototype.added.call(this,t),this._rblZoomEndListener=this._controller.map.addListener("zoomend",T(this._updateShapes,this))},_hasRoute:function(){return b(this._roadbook)&&null!==this._roadbook&&this._idRoute>=0},getRoute:function(){var t=!1;return this._hasRoute()&&(t=this._roadbook.routes[this._idRoute]),t},_updateShapes:function(){var t=this._controller.model.getZoom();if((this._hasRoute()||b(this._levels))&&It.prototype.clean.call(this),b(this._levels)){var e=this._levels.getShapes(t,this._style,!1,this.overShapeStyle);for(var i in e)this.addShape(e[i].clone())}if(this._hasRoute()){if((!0===this._showAltRoute||!1!==this._previewAltRoute)&&i!==this._idRoute)for(i=0;i<this._roadbook.routes.length;i++)if(i!==this._idRoute&&(!1===this._previewAltRoute||this._previewAltRoute===i)){e=this._roadbook.routes[i].polyline.getShapes(t,this._style,i!==this._idRoute,this.overShapeStyle);for(var n in e)this.addShape(e[n].clone())}if(this._hasRoute()){e=this.getRoute().polyline.getShapes(t,this._style,!1,this.overShapeStyle);for(var n in e)this.addShape(e[n].clone())}}},clean:function(){this._roadbook=null,It.prototype.clean.call(this),this._controller.map.removeListener(this._rblZoomEndListener)},setRoadbook:function(t){this._hasRoute()&&t.postKey===this._roadbook.postKey||(this._roadbook=t,this._idRoute=-1,this.showRoute(this._roadbook.getDefaultRoute().idRoute))},setPolylineLevels:function(t){this._levels=t,this._updateShapes()},setColorStyle:function(t){this._style!==t&&(this._style=t,this._updateShapes())},showRoute:function(t){this._idRoute!==t&&(this._idRoute=t,this._hasRoute()&&this._updateShapes())},setShowAltRoute:function(t){this._showAltRoute!==t&&(this._showAltRoute=t,this._updateShapes())},showAltRoute:function(t){b(t)&&this._previewAltRoute!==t&&this._previewAltRoute!==this._idRoute&&(this._previewAltRoute=t,this._updateShapes())},hideAltRoute:function(){!1!==this._previewAltRoute&&(this._previewAltRoute=!1,this._updateShapes())},getBounds:function(){return this._updateShapes(),It.prototype.getBounds.call(this)},setOverrideShapeStyle:function(t){g.isEmptyObject(t)||(this.overShapeStyle=g.extend({},t,{modified:!0}),this._updateShapes())}}),Rt=(h.map.layer.DirectionLayer=_(Ft,N,{EVENTS:["newroute","routedragged","routedragerror","waypointclick"],maxSteps:null,handlerMarker:null,isEnableActions:null,isShowIcons:null,_hideNewStepMarker:!1,_markerLayer:null,_movedFromLastRefresh:null,_routeService:null,_waypoints:null,_icons:{startIcon:new W({image:o+"img/poi/poi-route-start_png8.png",size:new O(37,37),iconAnchor:new O(18,18)}),endIcon:new W({image:o+"img/poi/poi-route-end_png8.png",size:new O(37,37),iconAnchor:new O(18,18)}),viaIcon:new W({image:o+"img/poi/poi-route-waypoint_png8.png",size:new O(25,25),iconAnchor:new O(12,12)})},_trafficEventIcons:{evt1:new W({image:o+"img/traffic/10309_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt2:new W({image:o+"img/traffic/10308_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt3:new W({image:o+"img/traffic/10305_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt4:new W({image:o+"img/traffic/10305_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt6:new W({image:o+"img/traffic/10306_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt7:new W({image:o+"img/traffic/10306_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt8:new W({image:o+"img/traffic/10305_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt9:new W({image:o+"img/traffic/10304_5.png",size:new O(16,20),iconAnchor:new O(8,20)}),evt11:new W({image:o+"img/traffic/10307_5.png",size:new O(16,20),iconAnchor:new O(8,20)})},initialize:function(t,e,i){Ft.prototype.initialize.call(this,t,e,i),N.prototype.initialize.apply(this),this._routeService=new ae,this.maxSteps=100,this.isShowIcons=!0,this.isEnableActions=!0,this._markerLayer=new Dt(t+1)},added:function(t){Ft.prototype.added.call(this,t),this._controller.map.addLayer(this._markerLayer),w(this._newStepMarker)&&(this._newStepMarker=this._createNewStepMarker(),this.handlerMarker=this._newStepMarker),this._dlZoomEndListener=this._controller.map.addListener("zoomend",T(this._updateShapes,this))},removed:function(){this._controller.removeLayer(this._markerLayer),Ft.prototype.removed.call(this)},setRoadbook:function(t){t!=this._roadbook&&(this.geocodingEnable=!1,this._idRoute=-1,Ft.prototype.setRoadbook.call(this,t))},showRoute:function(t){this._idRoute!==t&&(Ft.prototype.showRoute.call(this,t),this.getRoute().wayPoints.length<this.maxSteps+2&&(this._hideNewStepMarker=!1))},setWaypoints:function(t,e){this._waypoints=t,this._idRoute=e,this._updateMarkers()},_updateShapes:function(){!0===this.isOnMap&&(Ft.prototype._updateShapes.call(this),this._updateMarkers())},_createNewStepMarker:function(){var t,e,i=this._controller.map,n=new gt(new q(0,0),this._icons.viaIcon);this._hideNewStepMarker=!0;return n.addListener("dragstart",T(function(i){this.geocodingEnable=!0,e=t},this)),n.addListener("dragstop",T(function(t){var i=this.getRoute();this.geocodingEnable=!1;var n=this._newStepMarker;n.isOnMap&&(this._markerLayer.removeMarker(n),n.disableDraggable()),this._hideNewStepMarker=!0;var o=this;n.geocode(function(t){for(var n=[],s=0;s<i.wayPoints.length;s+=1)n.push(i.wayPoints[s]),s===e&&n.push(t[0]);o._loadNewRoadbook(n)}),this.trigger("routedragged")},this)),i.addListener("mousemove",T(function(e){if(!0!==this.isEnableActions)return!1;var n=this._newStepMarker,o=this.getRoute();if(b(n)&&!1===n.dragging&&!1===i.dragging&&!1===this._hideNewStepMarker&&!0===this._hasRoute()&&!o.isMultiModal()){var s,r,a=o.wayPoints;for(s=0;s<a.length;s+=1)if(a[s].marker.dragging)return!1;var l=1e6,h=this._shapes;for(s=0;s<h.length;s+=1){var c=h[s],u=c.getDistance(e);b(u)&&u.distance<l&&(t=c.getWayPointNum(),l=u.distance,r=u.position)}b(r)?(n.isOnMap||(this._markerLayer.addMarker(n),n.enableDraggable()),n.pos=r,n.setMarkerPosition()):n.isOnMap&&(this._markerLayer.removeMarker(n),n.disableDraggable())}return!1},this)),n},clean:function(){Ft.prototype.clean.call(this),this._cleanMarkers()},_createMarkerIcon:function(t,e){var i,n=t.Placemark.Point.coordinates,o={type:"",label:""};b(t.actions)&&b(t.actions[this._idRoute||0])&&(o=t.actions[this._idRoute||0]),i="start"===o.type?this.getStartIcon():"end"===o.type?this.getEndIcon():this.getViaIcon(),marker=new gt(new q(n[0],n[1]),i),marker.addToolTip(o.label),this._markerLayer.addMarker(marker),marker.addDraggable();var s=function(t,e,i){return function(){t._dragstopWaypointMarkerHandler(e,i)}}(this,e,marker);return marker.addListener("dragstop",s),marker},_dragstopWaypointMarkerHandler:function(t,e){if(!1!==this._enableActions){this.geocodingEnable=!1;var i=this;e.geocode(function(e){for(var n=i._roadbook.routes[i._idRoute],o=[],s=0;s<n.wayPoints.length;s+=1)o.push(n.wayPoints[s]);o[t]=e[0],i._loadNewRoadbook(o)}),this.trigger("routedragged")}},_updateMarkers:function(){if(this._hasRoute()||null!==this._waypoints){this._cleanMarkers();var t=this.getRoute(),e=!1!==t?t.wayPoints:this._waypoints;for(var i in e){var n=e[i],o=this;if(b(n.marker)){try{n.marker.disableDraggable()}catch(t){}this._markerLayer.removeMarker(n.marker),delete n.marker}n.marker=this._createMarkerIcon(n,i),function(t,e){e.marker.addListener("click",function(){o.trigger("waypointclick",t,e)})}(i,n),this._markerLayer.addMarker(n.marker),!0===this.isEnableActions&&n.marker.addDraggable()}var s=this.getRoute().actions;if(s&&s.length)for(i=0;i<s.length;i++)for(var r=s[i],a=0;a<r.pois.length;a++){var l=r.pois[a];if("traffic-event"===l.type&&-1!=l.codeAlert&&b(this._trafficEventIcons["evt"+l.codeAlert])){var h=new gt(l.coordinates,this._trafficEventIcons["evt"+l.codeAlert]);h.addToolTip(l.label),this._markerLayer.addMarker(h)}}}},_cleanMarkers:function(){this._markerLayer.clean()},setEnableActions:function(t){if(this.isEnableActions=!0===t,this._hasRoute())for(var e in this.getRoute().wayPoints){var i=e.marker;b(i)&&(this.isEnableActions?i.enableDraggable():i.disableDraggable())}},setShowIcons:function(t){this.isShowIcons=t,!0===t?(this._markerLayer.show(),this._updateMarkers()):this._markerLayer.hide()},_loadNewRoadbook:function(t){var e=this,i=g.extend(!0,{},this._roadbook.options);i.route=i.route||{},i.route.optim=0,this._routeService.loadRoute(t,i,function(t){e.setRoadbook(t),e.trigger("newroute",e.getRoute())},function(t){e.trigger("routedragerror",t)})},getStartIcon:function(){return this._icons.startIcon},setStartIcon:function(t){this._icons.startIcon=t},getEndIcon:function(){return this._icons.endIcon},setEndIcon:function(t){this._icons.endIcon=t},getViaIcon:function(){return this._icons.viaIcon},setViaIcon:function(t){this._icons.viaIcon=t},setIcons:function(t){this._icons=t},setTrafficEventsIcon:function(t){this._trafficEventIcons=t}}),h.map.shape.ShapeStyle=_({initialize:function(t){t=t||{},this.setLineWidth(b(t.lineWidth)?t.lineWidth:5),this.setShadowBlur(b(t.shadowBlur)?t.shadowBlur:0);var e=function(t){var e="#"===t.substr(0,1)?1:0,i=0,n=t.length>=8?t.substr(e+2*i++,2):"B2",o=t.substr(e+2*i++,2),s=t.substr(e+2*i++,2);return n+t.substr(e+2*i++,2)+s+o},i="B2FF0000";b(t.strokeStyle)&&(i=t.strokeStyle,b(t.colorType)&&"argb"===t.colorType&&(i=e(i))),this.setStrokeStyle(i);var n="B2FF0000";b(t.fillStyle)&&(n=t.fillStyle,b(t.colorType)&&"argb"===t.colorType&&(n=e(n))),this.setFillStyle(n);var o="black";b(t.shadowColor)&&(o=t.shadowColor,b(t.colorType)&&"argb"===t.colorType&&(o=e(o))),this.setShadowColor(o)},setLineWidth:function(t){this._lineWidth=t},setStrokeStyle:function(t){this._strokeStyle=t},setFillStyle:function(t){this._fillStyle=t},setShadowColor:function(t){this._shadowColor=t},setShadowBlur:function(t){this._shadowBlur=t},getLineWidth:function(){return this._lineWidth},getStrokeStyle:function(){return this._strokeStyle},getFillStyle:function(){return this._fillStyle},getShadowBlur:function(){return this._shadowBlur},getShadowColor:function(){return this._shadowColor},clone:function(){return new Rt({lineWidth:this._lineWidth,strokeStyle:this._strokeStyle,fillStyle:this._fillStyle,shadowColor:this._shadowColor,shadowBlur:this._shadowBlur})}})),jt=_(N,{EVENTS:["click","mouseover","mouseout","mousedown","mouseup"],isOnMap:!1,isOver:!1,initialize:function(t,e,i){var n;N.prototype.initialize.apply(this),this.type=i,this._style=e,this._coords=t;var o=t.length;if(o>0){var s;n=new J(t[0],t[0]);for(var r=0;r<o;r+=1)s=t[r],n.extend(s);n.refreshCenter()}this.boundingBox=n},added:function(t,e){this._controller=e,this._drawer=Lt(t,40,this.type),this._drawer.setStyle(this._style),this.isOnMap=!0},calcPoints:function(){for(var t=this._coords,e=[],i=this._controller.converter,n=0,o=t.length;n<o;n+=1)e.push(i.toGeolayerPixels(t[n]));if(e.length>2){var s=[];s.push(e[0]);for(n=2;n<e.length;n+=1)Math.abs((e[n-1].x-e[n].x)*(e[n-1].y-s[s.length-1].y)-(e[n-1].y-e[n].y)*(e[n-1].x-s[s.length-1].x))>=1&&s.push(e[n-1]);s.push(e[n-1]),this.points=s}else this.points=e},draw:function(t){this.clean();var e=this._controller.converter,i=t.intersect(this.boundingBox);if(b(i)){var n=e.toGeolayerPixels(i.ne),o=e.toGeolayerPixels(i.sw),s=new F(o.x,n.y,n.x,o.y);this._drawer.setBoundingBox(s)}},getCoordinates:function(){return this._coords},setStyle:function(t){this._style=t,this.isOnMap&&(this._drawer.setStyle(t),this._drawer.refreshStyle())},getStyle:function(){return this._style},clean:function(){this._drawer.clean()},removed:function(){this._drawer.removed(),this.isOnMap=!1},isInShape:function(){return!1},getBounds:function(){return this.boundingBox},clone:function(){return new jt(this._coords,this._style,this.type)}}),Bt=h.map.shape.Line=_(jt,{initialize:function(t,e){jt.prototype.initialize.call(this,t,e,"line")},draw:function(t){jt.prototype.draw.call(this,t),this._drawer.line(this.points)},isInShape:function(t){for(var e,i,n,o,s,r,a,l,h=this._drawer.div.offset(),c=this._drawer.div.position(),u=[t.pageX-h.left+c.left,t.pageY-h.top+c.top],d=this._drawer.getStyle().getLineWidth(),p=d/2*(d/2),f=this.points,m=1;m<f.length;m+=1)if(e=f[m].x-f[m-1].x,i=f[m].y-f[m-1].y,(a=(r=e*(n=u[0]-f[m-1].x)+i*(o=u[1]-f[m-1].y))/(s=e*e+i*i))<0?(a=0,0):a>1?(a=1,s):r*r/s,(l=[a*e-n,a*i-o])[0]*l[0]+l[1]*l[1]<=p)return!0;return!1},getDistance:function(t){for(var e,i,n,o,s,r,a,l,h,c,u,d,p=this._drawer.div.offset(),f=this._drawer.div.position(),m=t.pageX-p.left+f.left,g=t.pageY-p.top+f.top,v=1e3,y=this.points,_=1;_<y.length;_+=1)e=y[_].x-y[_-1].x,i=y[_].y-y[_-1].y,(a=(r=e*(n=m-y[_-1].x)+i*(o=g-y[_-1].y))/(s=e*e+i*i))<0?(a=0,0):a>1?(a=1,s):r*r/s,(u=(c=[(l=a*e)-n,(h=a*i)-o])[0]*c[0]+c[1]*c[1])<=v&&(v=u,d={position:new O(l+y[_-1].x,h+y[_-1].y),distance:u});return d}}),Zt=_(Bt,{_wayPointNum:0,initialize:function(t,e,i){Bt.prototype.initialize.call(this,t,e),this.setWayPointNum(i)},setWayPointNum:function(t){this._wayPointNum=t},getWayPointNum:function(){return this._wayPointNum},clone:function(){return new Zt(this._coords,this._style,this._wayPointNum)}}),Xt=h.map.shape.Polygon=_(jt,{initialize:function(t,e){jt.prototype.initialize.call(this,t,e,"polygon")},draw:function(t){jt.prototype.draw.call(this,t),this._drawer.polygon(this.points)},isInShape:function(t){var e,i=this._drawer.div.offset(),n=this._drawer.div.position(),o=[t.pageX-i.left+n.left,t.pageY-i.top+n.top],s=this.points,r=s.length,a=r-1,l=!1;for(e=0;e<r;e+=1)(s[e].y<o[1]&&s[a].y>=o[1]||s[a].y<o[1]&&s[e].y>=o[1])&&s[e].x+(o[1]-s[e].y)/(s[a].y-s[e].y)*(s[a].x-s[e].x)<o[0]&&(l=!l),a=e;return l}}),Ht=(h.map.shape.Circle=_(jt,{initialize:function(t,e,i){var n=6378137,o=n*n,s=40408299981544.36;function r(t,e,i){var r=i/n,a=Math.tan(t.y*Math.PI/180);a*=a;var l=e*Math.sqrt(o+s*a)/o;return new q(t.x+180*l/Math.PI,t.y+180*r/Math.PI)}jt.prototype.initialize.call(this,[],i,"circle"),this._coords=[],this._coords.push(t),this._coords.push(r(t,e,0)),this._coords.push(r(t,0,e)),this._coords.push(r(t,-e,0)),this._coords.push(r(t,0,-e)),this.boundingBox=new J(this._coords[0],this._coords[0]);for(var a=this._coords.length,l=0;l<a;l+=1)this.boundingBox.extend(this._coords[l]);this.boundingBox.refreshCenter()},added:function(t,e){this._controller=e,this._drawer=Lt(t,40,"circle"),this._drawer.setStyle(this._style),this.isOnMap=!0},draw:function(t){jt.prototype.draw.call(this,t);var e=this._controller.converter,i=e.toGeolayerPixels(this._coords[0]),n=e.toGeolayerPixels(this._coords[1]).x-i.x;this._drawer.circle(i,n)}}),h.map.shape.GPolyline=_(Bt,{initialize:function(t,e){var i=Yt(t);Bt.prototype.initialize.call(this,i,e)}}),h.map.shape.GPolylineDecoder=_({initialize:function(t){this._encoded=t,this._index=0},decode:function(){var t=this._encoded.length;this._index=0;for(var e=[];this._index<t;)e.push(this.g_decodeNextPoint());return e},g_decodeNextPoint:function(){var t,e=0,i=0;do{i|=(31&(t=this._encoded.charCodeAt(this._index++)-63))<<e,e+=5}while(t>=32);return(1&i)>0?~(i>>1):i>>1}})),Yt=function(t){for(var e=[],i=0,n=0,o=new Ht(t).decode(),s=0;s<o.length;s+=2)i+=1e-5*o[s],n+=1e-5*o[s+1],e.push(new q(n,i));return e},Wt=h.map.shape.GPolylineLevels=_({_shapes:null,_coords:null,_zoomLevels:null,_wayPointActionsPid:null,_stylesSections:null,_stylesDictionnary:null,_disableStyle:null,initialize:function(t,e,i){this._shapes=new Array,this._stylesDictionnary=e,this._coords=Yt(t.polyline),this._zoomLevels=function(t){for(var e=[],i=-1,n=new Ht(t).decode(),o=0;o<n.length;o++)i+=n[o],e.push(i);return e}(t["polyline-levels"]),this._stylesSections=this._getStylesSections(A(t["road-section-collection"]["road-sections"])),this._wayPointActionsPid=b(i)?i:[],this._disableStyle=new Rt({strokeStyle:"B2666666"})},_getStylesSections:function(t){var e=new Array;for(var i in t){var n=t[i].type;w(e[n])&&(e[n]=new Array);for(var o=t[i]["road-section"].split(" "),s=0,r=0;r<o.length;r+=2){var a=parseInt(o[r]);this._stylesDictionnary.existsShapeStyle(n,a)&&(e[n][parseInt(s)]=a),s=parseInt(o[r+1])}}return e},_doOverrideShapeStyle:function(t,e){if(!g.isEmptyObject(e)){b(e.lineWidth)&&t.setLineWidth(e.lineWidth);var i=function(t,e){return parseInt(255*e).toString(16)+t.substr(2,6)},n=b(e.strokeOpacity)?e.strokeOpacity:null,o=b(e.strokeStyle)?e.strokeStyle:t.getStrokeStyle();null!=n?o=i(o,n):w(e.strokeStyle)&&(o=null),null!==o&&t.setStrokeStyle(o);var s=b(e.fillOpacity)?e.fillOpacity:null,r=b(e.fillSytle)?e.fillSytle:t.getFillStyle();null!=s?r=i(r,s):w(e.fillSytle)&&(r=null),null!==r&&t.setFillStyle(r)}},getShapes:function(t,e,i,n){n=n||{};var o=-1;b(t)&&pt.mMaxZoomLevel>t&&(o=t);var s=e||"none";i&&(s+="_disable"),w(this._shapes[o])&&(this._shapes[o]=[]);var r=this._shapes[o][s];if(w(r)||!0===n.modified){r=[];var a=[],l=0,h=this._stylesSections[s]||[],c=this._disableStyle;!0!==i&&(c=this._stylesDictionnary.getShapeStyle(s,0)),this._doOverrideShapeStyle(c,n);for(var u=0;u<this._coords.length;u++){var d=!0!==i&&b(h[u]),p=g.inArray(u,this._wayPointActionsPid)>=0;if(!(0<=o&&o<this._zoomLevels[u]&&!d&&!p&&u<this._coords.length-1)){if(u>0&&(d||p)&&(a.push(this._coords[u]),r.push(new Zt(a,c,l)),a=new Array),d){var f=h[u];c=this._stylesDictionnary.getShapeStyle(s,f),this._doOverrideShapeStyle(c,n)}p&&l++,a.push(this._coords[u])}}r.push(new Zt(a,c,l)),this._shapes[o][s]=r}return n.modified=!1,r},getStyleId:function(t,e){var i=e||"none",n=parseInt(t),o=this._stylesSections[i]||[],s=o[o.length-1];for(var r in o)if(b(o[r])&&o[r]>n){s=o[r-1];break}return s}}),Ut=_({initialize:function(t){this._url=t.Icon.href,this._coords={nw:{x:parseFloat(t.LatLonBox.west),y:parseFloat(t.LatLonBox.north)},se:{x:parseFloat(t.LatLonBox.east),y:parseFloat(t.LatLonBox.south)}}},configure:function(t,e){this._map=e,this._map.addListener(this),this.container=t,this.img=g("<img style='position:absolute;' src='"+this._url+"'></img>"),this.container.append(this.img),this._map.isReady()&&(this.calcPosition(this._map.getZoomLevel()),this.setPosition())},draw:function(){this.setPosition()},setPosition:function(){this.img.css("left",this.points.nw[0]),this.img.css("top",this.points.nw[1]),this.img.css("width",this.points.se[0]-this.points.nw[0]),this.img.css("height",this.points.se[1]-this.points.nw[1])},calcPosition:function(t){this.points={},this.zoomLevel=t,this.points.nw=this._map.getDraggableLayersContainer().getMapLayer().getPosition(this._map.getDraggableLayersContainer().getMapLayer().getTileInfoFromCoordinates(this._coords.nw,this.zoomLevel)),this.points.se=this._map.getDraggableLayersContainer().getMapLayer().getPosition(this._map.getDraggableLayersContainer().getMapLayer().getTileInfoFromCoordinates(this._coords.se,this.zoomLevel))},onMapBuildBegin:function(t){var e=this._map.getZoomLevel();this.zoomLevel!==e&&(this.calcPosition(e),this.setPosition())}}),Vt=_(Bt,{initialize:function(t,e,i){this.Placemark=i;for(var n,o=t.coordinates,s=[],r=0,a=(o=o.split(/\s+/)).length;r<a;r+=1)2!==(n=o[r].split(",")).length&&3!==n.length||s.push(new q(n[0],n[1]));(e=e||{}).LineStyle=e.LineStyle||{};var l=new Rt({lineWidth:e.LineStyle.width,strokeStyle:e.LineStyle.color});Bt.prototype.initialize.call(this,s,l)}}),Gt=_(Xt,{initialize:function(t,e,i){this.Placemark=i;for(var n,o=t.outerBoundaryIs.LinearRing.coordinates,s=[],r=0,a=(o=o.split(/\s+/)).length;r<a;r+=1)2!==(n=o[r].split(",")).length&&3!==n.length||s.push(new q(n[0],n[1]));(e=e||{}).LineStyle=e.LineStyle||{},e.PolyStyle=e.PolyStyle||{};var l=new Rt({lineWidth:e.LineStyle.width,strokeStyle:e.LineStyle.color,fillStyle:e.PolyStyle.color});Xt.prototype.initialize.call(this,s,l)}}),qt=(h.map.shape.kml.KmlReader=_({initialize:function(){},getShapes:function(t,e){var i;for(i in!0!==e&&(this.shapes=[],this.styles={}),t)t.hasOwnProperty(i)&&"Style"===i&&this._computeStyle(t[i]);for(i in t)if(t.hasOwnProperty(i)){if("Document"===i||"Folder"===i)for(var n=g.makeArray(t[i]),o=0;o<n.length;o+=1)this.getShapes(n[o],!0);"GroundOverlay"===i&&this._computeGroundOverlay(t[i]),"Placemark"===i&&this._computePlacemark(t[i])}if(!0!==e)return this.shapes},_computeStyle:function(t){for(var e,i=g.makeArray(t),n=0;n<i.length;n+=1)b(i[n].id)?this.styles[i[n].id]=i[n]:b(i[n]["@attributes"])&&b(i[n]["@attributes"].id)&&(this.styles[i[n]["@attributes"].id]=i[n]),e=i[n];return e},_computeGroundOverlay:function(t){for(var e=g.makeArray(t),i=0;i<e.length;i+=1)this.shapes.push(new Ut(e[i]))},_computePlacemark:function(t){var e,i,n,o=g.makeArray(t);for(e=0;e<o.length;e+=1)if(b(o[e].Style)&&(n=this._computeStyle(o[e].Style)),b(o[e].styleUrl)&&(n=o[e].styleUrl.substring(1),n=this.styles[n]),b(o[e].Polygon)&&this.shapes.push(new Gt(o[e].Polygon,n,o[e])),b(o[e].LineString)&&this.shapes.push(new Vt(o[e].LineString,n,o[e])),b(o[e].MultiGeometry)){if(b(o[e].MultiGeometry.LineString)){var s=g.makeArray(o[e].MultiGeometry.LineString);for(i=0;i<s.length;i+=1)this.shapes.push(new Vt(s[i],n,o[e]))}if(b(o[e].MultiGeometry.Polygon)){var r=g.makeArray(o[e].MultiGeometry.Polygon);for(i=0;i<r.length;i+=1)this.shapes.push(new Gt(r[i],n,o[e]))}}}}),h.map.tools.ToolPosition=_({POSSIBLE_ANCHORS:["lt","rt","lb","rb"],DEFAULT_ANCHOR:"rb",DEFAULT_OFFSET:new O(0,0),initialize:function(t,e){b(t)&&-1!==g.inArray(t,this.POSSIBLE_ANCHORS)?this.anchor=t:this.anchor=this.DEFAULT_ANCHOR,b(e)?this.offset=e:this.offset=this.DEFAULT_OFFSET.clone()},clone:function(){return new qt(this.anchor,this.offset.clone())}})),$t=h.map.tools.Tool=_({isOnMap:!1,POSSIBLE_DIRECTIONS:["vertical","horizontal","none"],DEFAULT_DIRECTION:"horizontal",DEFAULT_POSITION:new qt,div:null,direction:null,position:null,initialize:function(t,e){this.setPosition(t),this.setDirection(e)},added:function(t){t.controller.view.div.append(this.div),this.div.css({position:"absolute","z-index":999}),this._map=t,this.isOnMap=!0},removed:function(){g(this.div)[0].parentNode&&g(this.div)[0].parentNode.removeChild(g(this.div)[0]),this.isOnMap=!1},setPosition:function(t){b(t)?this.position=t:this.position=this.DEFAULT_POSITION.clone()},setDirection:function(t){b(t)&&-1!==g.inArray(t,this.POSSIBLE_DIRECTIONS)?this.direction=t:this.direction=this.DEFAULT_DIRECTION},refreshPosition:function(){var t,e=this._map.miniMap;switch(t=b(e)&&e.position.anchor===this.position.anchor&&"none"!==this.direction?"horizontal"===this.direction?new O(e.position.offset.x,0):new O(0,e.position.offset.y):new O(0,0),this.position.anchor){case"lt":this.div.css({left:this.position.offset.x+t.x,top:this.position.offset.y+t.y});break;case"rt":this.div.css({right:this.position.offset.x+t.x,top:this.position.offset.y+t.y});break;case"lb":this.div.css({left:this.position.offset.x+t.x,bottom:this.position.offset.y+t.y});break;case"rb":this.div.css({right:this.position.offset.x+t.x,bottom:this.position.offset.y+t.y})}}}),Jt=_($t,{DEFAULT_DIRECTION:"horizontal",TEMPLATE:'<div class="copyright"><a href="javascript:void(0);" class="labels"></a><a href="javascript:void(0);" class="logos"></a></div>',PROVIDERS_LOGOS:{InterAtlas:"img/map/logo-iA-16x26.png",IGN:"img/map/logo-IGN-16x26.png"},tabProviders:[],tabProvidersLogos:[],initialize:function(){$t.prototype.initialize.call(this)},added:function(t){this.div=g(this.TEMPLATE),this.div.find("a").click(function(){window.open("http://corporate.mappy.com/conditions-dutilisation/copyright/","Copyright")}),$t.prototype.added.call(this,t)},remove:function(){this.tabProviders=[],this.tabProvidersLogos=[]},setText:function(t){for(var e in this.tabProvidersLogos=[],t)for(var i in t[e])if(t[e].hasOwnProperty(i)){for(var n=!1,s=0;s<this.tabProviders.length;s++)this.tabProviders[s]===i&&(n=!0);"Mappy"===i||n||this.tabProviders.push(i)}var r=this.tabProviders.join(" - ");for(var a in this.PROVIDERS_LOGOS)-1!=r.indexOf(a)&&this.tabProvidersLogos.push('<img src="'+o+this.PROVIDERS_LOGOS[a]+'" />');this.tabProviders.length>0?(this.div.find(".labels").css("margin-right",19*this.tabProvidersLogos.length+"px").html("&copy; Mappy - "+r),this.div.find(".logos").html(this.tabProvidersLogos.join(""))):this.div.find("a").empty()}}),Kt=h.map.tools.MiniMap=_($t,{ZOOM_DELTA:3,TEMPLATE:'<div class="minimap"><div class="minimap-content"><div style="position:absolute;left:0;top:0;" class="minimap-layer"></div><div class="minimap-rectangle"></div></div><div class="minimap-close"></div></div>',TEMPLATE_IE6:'<div class="minimap minimap-ie6"><div class="minimap-bg-ie6" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src=\''+o+'/img/tools/border_minimap.png\');"></div><div class="minimap-content"><div style="position:absolute;left:0;top:0;" class="minimap-layer"></div><div class="minimap-rectangle"></div></div><div class="minimap-close"><div class="minimap-close-ie6" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src=\''+o+"/img/tools/border_minimap.png');\"></div></div></div>",_tiles:[],_mapListeners:[],shift:null,initialize:function(t){$t.prototype.initialize.call(this,t),this.model=new Tt},added:function(t){this.div=g(v?this.TEMPLATE_IE6:this.TEMPLATE),$t.prototype.added.call(this,t),this.model.setSize(120,120);var e=this.div.find(".minimap-close"),i=this;e.click(function(){t.removeTool(i)});var n=new I(132,132);this.div.width(n.width),this.div.height(n.height),this._addRectangle(),this._mapListeners.push(t.addListener("resize",T(this._resizeHandler,this))),this._mapListeners.push(t.addListener("dragstart",T(this._dragStartHandler,this))),this._mapListeners.push(t.addListener("drag",T(this._dragHandler,this))),this._mapListeners.push(t.addListener("changeend",T(this._newDisplayArea,this))),this.tilelayer=this.div.find(".minimap-layer"),t.isReady&&this._newDisplayArea(),this.position.offset=new O(n.width,n.height),this.refreshPosition()},refreshPosition:function(){var t=this.div.find(".minimap-close");switch(this.position.anchor){case"lt":this.div.css({left:-6,top:-6}),t.css({right:0,bottom:0,"background-position":"-43px -43px"}),v&&t.find(".minimap-close-ie6").css({left:-43,top:-43});break;case"rt":this.div.css({right:-6,top:-6}),t.css({left:0,bottom:0,"background-position":"-66px -43px"}),v&&t.find(".minimap-close-ie6").css({left:-66,top:-43});break;case"lb":this.div.css({left:-6,bottom:-6}),t.css({right:0,top:0,"background-position":"-43px -66px"}),v&&t.find(".minimap-close-ie6").css({left:-43,top:-66});break;case"rb":this.div.css({right:-6,bottom:-6}),t.css({left:0,top:0,"background-position":"-66px -66px"}),v&&t.find(".minimap-close-ie6").css({left:-66,top:-66})}},removed:function(){for(var t=0;t<this._mapListeners.length;t+=1)this._map.removeListener(this._mapListeners[t]);$t.prototype.removed.call(this)},_newDisplayArea:function(){this._rectangle.show();var t=this._map.controller.converter.fromPixels(this._map.controller.model.halfWidth,this._map.controller.model.halfHeight);this.model.setState(t,Math.max(this._map.getZoomLevel()-this.ZOOM_DELTA,this.model.viewModes.default.minZoomLevel)),this.reset();var e=this.model.getTiles(0,0);this.setTiles(e,this.model.centerX-this.model.halfWidth,this.model.centerY+this.model.halfHeight),this.tiles=e.default,this._rectangle.css(this._rectPosInit),this.model.viewModes.default.minZoomLevel>this._map.getZoomLevel()-this.ZOOM_DELTA&&this._rectangle.hide()},setTiles:function(t,e,i){for(var n,o=0;o<t.default.length;o+=1)n=t.default[o],w(this.tiles[n.key])&&(n.create(e,i),n.append(this.tilelayer),this.tiles[n.key]=n)},refreshTiles:function(){var t=this.tilelayer.position(),e=this.model.getTiles(t.left,t.top);this.setTiles(e,this.model.centerX-this.model.halfWidth,this.model.centerY+this.model.halfHeight)},reset:function(){this.clean(),this.tilelayer.css({left:0,top:0})},clean:function(){var t=this.tiles;for(var e in t)t.hasOwnProperty(e)&&t[e].remove();this.tiles={}},_resizeHandler:function(){this._refreshRectangleSize(),this._newDisplayArea()},_dragStartHandler:function(t){this._dragStartEvent=t},_dragHandler:function(t){this._rectangle.css({left:this._rectPosInit.left+(this._dragStartEvent.pageX-t.pageX)/Math.pow(3,this.ZOOM_DELTA),top:this._rectPosInit.top+(this._dragStartEvent.pageY-t.pageY)/Math.pow(3,this.ZOOM_DELTA)})},_refreshRectangleSize:function(){var t=this._map.getSize();this._rectSize=new I(t.width/Math.pow(3,this.ZOOM_DELTA),t.height/Math.pow(3,this.ZOOM_DELTA)),this._rectangle.width(this._rectSize.width),this._rectangle.height(this._rectSize.height),this._rectPosInit={left:(this.model.width-this._rectSize.width)/2,top:(this.model.height-this._rectSize.height)/2},this._rectangle.css(this._rectPosInit)},_addRectangle:function(){var t;this._rectangle=this.div.find(".minimap-rectangle"),this._rectangle.css("position","absolute"),this._rectangle.css("opacity",.3),this._refreshRectangleSize();var e,i=this,n=function(){var e=[0,0],n=i._rectangle.position();if(n.left<-i._rectSize.width?e[0]=5:n.left>i.model.width&&(e[0]=-5),n.top<-i._rectSize.height?e[1]=5:n.top>i.model.height&&(e[1]=-5),e[0]||e[1]){t[0]+=e[0],t[1]+=e[1];var o=i.tilelayer.position();i.tilelayer.css({left:e[0]+o.left,top:e[1]+o.top}),i.refreshTiles()}};R(this._rectangle,{start:function(){t=[0,0],e=setInterval(n,10)},stop:function(){window.clearInterval(e);var n=i._rectangle.position(),o=new O(i._rectPosInit.left-n.left+t[0],i._rectPosInit.top-n.top+t[1]);o.x*=Math.pow(3,i.ZOOM_DELTA),o.y*=Math.pow(3,i.ZOOM_DELTA),i._map.slideBy(o)}})}}),Qt=(h.map.tools.Scale=_($t,{MAX_WIDTH:100,DEFAULT_DIRECTION:"horizontal",TEMPLATE:'<div class="tools-scale" style="height:30px;font-family:Arial,sans-serif;font-size: 11px;"><div style="position:relative;float:left;overflow:hidden;width:7px;height:18px;"><img src="{imagesPath}tools/sprite-scale.png"></img></div><div class="tools-scale-middle" style="position:relative;float:left;overflow:hidden;top:6px;height:7px;"><img style="position: absolute;top:-18px;left:0;height:25px;" src="{imagesPath}tools/sprite-scale.png"></img></div><div style="position:relative;float:left;overflow:hidden;width:7px;height:13px;"><img style="position: absolute;right:0;" src="{imagesPath}tools/sprite-scale.png"></img></div><div class="tools-scale-milesbar" style="position:absolute;overflow:hidden;width:7px;height:8px;top:10px;"><img style="position: absolute;left:-7px;top:-10px;" src="{imagesPath}tools/sprite-scale.png"></img></div><div class="tools-scale-meter" style="position: absolute; left:12px; top:-7px;"></div><div class="tools-scale-miles" style="position: absolute; left:12px; bottom:4px;"></div></div>',_mapListeners:[],initialize:function(t,e){$t.prototype.initialize.call(this,t,e)},added:function(t){var e=o+(v?"img_png8/":"img/");this.div=g(C(this.TEMPLATE,{imagesPath:e})),this.div.width(this.MAX_WIDTH+14),$t.prototype.added.call(this,t),this._mapListeners.push(t.addListener("changeend",T(this._compute,this))),t.isReady&&this._compute()},_compute:function(){var t,e,i,n,o=this._map.controller.model.getMeterPerPixel(),s=this.MAX_WIDTH*o;(e=this._calcRoundDistance(s))>1e3?(i="km",this.div.find(".tools-scale-meter").html(e/1e3+" "+i)):(i="m",this.div.find(".tools-scale-meter").html(e+" "+i));var r=e/o-6,a=this.div.find(".tools-scale-middle");a.width(r),a.find(":first-child").width(r);var l=.6213711*e/1e3;l<1?(n="yd",l*=1760):n="mi",t=this._calcRoundDistance(l),this.div.find(".tools-scale-miles").html(t+" "+n),this.div.find(".tools-scale-milesbar").css("left",t*(e/o)/l-6)},_calcRoundDistance:function(t){for(var e=[1,2,4,5,6,8,10],i=1;t/i>10;)i*=10;for(var n=e.length-1;n>=0;n-=1)if(t/i>=e[n])return e[n]*i},removed:function(){for(var t=0;t<this._mapListeners.length;t+=1)this._map.removeListener(this._mapListeners[t]);$t.prototype.removed.call(this)}}),h.map.tools.ToolBar=_($t,N,{DEFAULT_DIRECTION:"vertical",EVENTS:["movemiddleclick"],_mapListeners:[],initialize:function(t,e,i){e||(e=new qt("rb",new O(5,5))),$t.prototype.initialize.call(this,e,i),N.prototype.initialize.call(this),this.buttonList=M(t)?Qt.DEFAULT:t},added:function(t){this.div=g('<div class="tools-toolbar" style="position:absolute;z-index:999"></div>');var e=this.buttonList;$t.prototype.added.call(this,t);var i=!0;b(e.move)&&!1!==e.move&&(this._addMove(e.move.label,e.move.labelMiddle),i=!1),b(e.selection)&&!1!==e.selection&&(this._addZoomOnSelect(e.selection.label),i=!1),b(e.mouseWheelZoom)&&!1!==e.mouseWheelZoom&&(this._addZoomOnWheelSelection(e.mouseWheelZoom.label),i=!1),b(e.viewMode)&&!1!==e.viewMode&&(this._addViewModeSelector(i,e.viewMode.label,e.viewMode.lang),i=!1),b(e.zoom)&&!1!==e.zoom&&this._addPlus(i,e.zoom.label),b(e.slider)&&!1!==e.slider&&this._addSlider(e.slider.label),b(e.zoom)&&!1!==e.zoom&&this._addMinus(!e.miniMap,e.zoom.label),b(e.miniMap)&&!1!==e.miniMap&&(this._addMiniMap(e.miniMap.position,e.miniMap.label),i=!1)},_addToolTip:function(t,e){if(b(e)){var i=new V(this._map.controller.view.div,'<div style="margin:3px 6px">'+e+"</div>");t.mouseover(function(t){i.add(t),t.stopPropagation()}),t.mouseout(function(){i.remove()})}},_addMove:function(t,e){var i=g(v?'<div class="tools-move-ie6"><div style="filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src=\''+o+"img/tools/spriteToolbar.png');\"></div></div>":'<div class="tools-move"></div>'),n=this;if(i.click(function(t){var e,o=i.offset(),s=n._map.getSize();(o=[t.pageX-o.left-i.width()/2,t.pageY-o.top-(i.height()+2)/2])[0]<5&&o[0]>-5&&o[1]<5&&o[1]>-5?n.trigger("movemiddleclick"):(e=o[0]<5&&o[0]>-5&&(o[1]>5||o[1]<-5)?new O(0,-o[1]*s.height/(i.height()/2)):o[1]<5&&o[1]>-5&&(o[0]>5||o[0]<-5)?new O(-o[0]*s.width/(i.width()/2),0):new O(-o[0]*s.width/(i.width()/2),-o[1]*s.height/(i.height()/2)),n._map.slideBy(e))}),b(e)){var s=g('<div style="width:10px;height:10px;position:absolute;z-index:10;left:13px;top:14px;"></div>');i.append(s),this._addToolTip(s,e)}this.div.append(i),this._addToolTip(i,t)},_addMiniMap:function(t,e){var i=g(v?'<div class="tools-minimap-rounded-ie6"><div style="filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src=\''+o+"/img/tools/spriteToolbar.png');\"></div></div>":'<div class="tools-minimap-rounded"></div>'),n=this,s=new Kt(t);i.click(function(){b(n._map.miniMap)?n._map.removeTool(n._map.miniMap):n._map.addTool(s)}),this.div.append(i),this._addToolTip(i,e)},_addPlus:function(t,e){var i=this,n=g(v?"<div><div style=\"filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src='"+o+"/img/tools/spriteToolbar.png');\"></div></div>":"<div></div>");t?v?n.addClass("tools-plus-rounded-ie6"):n.addClass("tools-plus-rounded"):v?n.addClass("tools-plus-ie6"):n.addClass("tools-plus"),n.click(function(){i._map.zoomIn()}),this.div.append(n),this._addToolTip(n,e)},_addMinus:function(t,e){var i=this,n=g(v?"<div><div style=\"filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src='"+o+"/img/tools/spriteToolbar.png');\"></div></div>":"<div></div>");t?v?n.addClass("tools-minus-rounded-ie6"):n.addClass("tools-minus-rounded"):v?n.addClass("tools-minus-ie6"):n.addClass("tools-minus"),n.click(function(){i._map.zoomOut()}),this.div.append(n),this._addToolTip(n,e)},_addSlider:function(t){var e,i=this,n=this._map.getViewMode(),s=g(v?'<div class="tools-slider-ie6"><div class="tools-slider-bg-ie6" style="filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src=\''+o+"/img/tools/gdeBarreZoom_centre.png');\"></div></div>":'<div class="tools-slider"></div>');this.div.append(s);var r=function(t){n=t,b(e)&&e.destroy(),e=new U({container:s,min:n.minZoomLevel,max:n.maxZoomLevel,stop:function(t){i._map.setZoomLevel(t)}})};r(n),this._mapListeners.push(this._map.addListener("changeend",function(){var t=i._map.getViewMode();n!==t&&r(t),e.setValue(i._map.getZoomLevel())})),this._map.isReady&&e.setValue(this._map.getZoomLevel()),this._addToolTip(s,t),this._slider=e},_addZoomOnSelect:function(t){var e,i,n;v?(e="<div><div style=\"filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src='"+o+"/img/tools/spriteToolbar.png');\"></div></div>",i="tools-selection-selected-ie6",n="tools-selection-ie6"):(e="<div></div>",i="tools-selection-selected",n="tools-selection");var s=g(e),r=this._map;!1===r.isZoomSelectionEnabled()?s.addClass(n):s.addClass(i),this._mapListeners.push(r.addListener("controlchanged",function(t){"selectionZoom"===t&&(!1===r.isZoomSelectionEnabled()?(s.removeClass(i),s.addClass(n)):(s.removeClass(n),s.addClass(i)))})),s.click(function(){r.isZoomSelectionEnabled()?(r.disableZoomSelection(),r.enableDraggable()):r.enableZoomSelection()}),this.div.append(s),this._addToolTip(s,t)},_addZoomOnWheelSelection:function(t){var e=g(v?"<div><div style=\"filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src='"+o+"/img/tools/spriteToolbar.png');\"></div></div>":"<div></div>"),i=this,n=v?"tools-mousewheelzoom-enable-ie6":"tools-mousewheelzoom-enable",s=v?"tools-mousewheelzoom-disable-ie6":"tools-mousewheelzoom-disable";this._mapListeners.push(this._map.addListener("controlchanged",function(t){"scrollWheelZoom"===t&&(!1===i._map.isScrollWheelZoomEnabled()?(e.removeClass(n),e.addClass(s)):(e.removeClass(s),e.addClass(n)))})),!0===this._map.isScrollWheelZoomEnabled()?e.addClass(n):e.addClass(s),e.click(function(){!1===i._map.isScrollWheelZoomEnabled()?i._map.enableScrollWheelZoom():i._map.disableScrollWheelZoom()}),this.div.append(e),this._addToolTip(e,t)},_addViewModeSelector:function(t,e,i){var n=this._map,s=g(v?"<div><div style=\"filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true,sizingMethod=crop,src='"+o+"/img/tools/spriteToolbar.png');\"></div></div>":"<div></div>");function r(){var e=n.getViewMode().name;s.removeClass(),t?v?s.addClass("tools-viewmode-"+e+"-rounded-ie6"):s.addClass("tools-viewmode-"+e+"-rounded"):v?s.addClass("tools-viewmode-"+e+"-ie6"):s.addClass("tools-viewmode-"+e)}n.addListener("viewmodechanged",function(t){r()}),r();var a=g('<ul class="tools-viewmode-container"></ul>');function l(t){n.getViewMode().name!==t&&(n.setViewMode(new pt(t)),r()),a.hide(),event.stopPropagation()}a.hide();var h="EN"===i?"Map":"Plan",c=g('<li class="tools-viewmode-liste-standard">'+h+"</li>");c.click(function(t){l("standard")}),a.append(c);var u=g('<li class="tools-viewmode-liste-photo">Photo</li>');u.click(function(t){l("photo")}),a.append(u);var d=g('<li class="tools-viewmode-liste-hybrid">'+(h="EN"===i?"Hybrid":"Mixte")+"</li>");d.click(function(t){l("hybrid")}),a.append(d),s.append(a),s.mouseleave(function(){a.hide()}),s.mouseenter(function(){a.show()}),this.div.append(s),this._addToolTip(s,e)},removed:function(){b(this._slider)&&this._slider.destroy();for(var t=0;t<this._mapListeners.length;t+=1)this._map.removeListener(this._mapListeners[t]);$t.prototype.removed.call(this)}}));Qt.DEFAULT={miniMap:!0,move:!0,zoom:!0,mouseWheelZoom:!0,selection:!0,slider:!0,viewMode:!0};var te=_({name:null,num:null,nextRoad:null,label:null,town:null,countryCode:null,step:null,type:null,meter:null,sec:null,from:null,to:null,coordinates:null,pois:null,shields:null,route:null,initialize:function(t,e,i){this.coordinates=new q(t.x,t.y),this.sec=parseInt(t.sec),this.polylineIndex=parseInt(t["polyline-index"]),this.label=t.label,this.route=e,this.isHighway=i,this.name=t.name,this.num=t.num,this.wpNum=parseInt(t["wp-num"]||0),this.nextRoad=t["next-road"],this.exitNumber=t["exit-number"],this.town=t.town,this.country=t.country,this.countryCode=t["country-code"],this.type=t.type,this.meter=parseInt(t.meter||0),this.angle=t.angle,this.highwayEnter=1===parseInt(t["highway-enter"]),this.highwayExit=1===parseInt(t["highway-exit"]),b(t["free-bikes"])&&(this.freeBikes=parseInt(t["free-bikes"])),b(t["free-blocks"])&&(this.freeBlocks=parseInt(t["free-blocks"])),b(t["station-name"])&&(this.stationName=t["station-name"]),this.trafficState=parseInt(t.state),this.trafficVolatility=parseInt(t.volatility),this.route.isMultiModal()&&this.initializeRMM(t),this.pois=new Array,this.shields=new Array;var n=A(t.poi),o=["radar","brunnel","town","toll","pass","shield","traffic-event"];for(var s in n)"shield"===n[s].type?this.shields.push(new se(n[s],this)):-1!==g.inArray(n[s].type,o)&&this.pois.push(new oe(n[s],this))},initializeRMM:function(t){this.depDate=t.depDate,this.arrDate=t.arrDate,this.dataprovider=t.dataprovider,this.simpleLabel=t.simpleLabel,this.mode=t.mode,this.lineName=t.line,this.trainLine=t.trainLine,this.depStation=t.depStation,this.arrStation=t.arrStation,this.lineDir=t.lineDir,this.fareZone=t["fare-zone"],this.dataProvider=t.dataprovider}}),ee=h.route.StylesDictionnary=_({_styleTypes:null,_styles:null,_defaultStyle:null,_defaultStyleDef:null,initialize:function(){this._types=[],this._styles=[],this._defaultStyle=new Rt},addToDictionnary:function(t){if(!w(t)){var e,i,n,o=A(t.color);for(var s in o)i=o[s].type,w(this._styles[i])&&(this._styles[i]=new Array,this._types.push(i)),n=o[s].value,w(this._styles[i][n])&&(e={colorType:"argb",strokeStyle:o[s].color,fillStyle:o[s].color},this._styles[i][n]=new Rt(e))}},getAvailableStyleTypes:function(){return this._types},isStyleTypeAvailable:function(t){return b(this._styles[t])},existsShapeStyle:function(t,e){return b(this._styles[t])&&b(this._styles[t][e])},getShapeStyle:function(t,e){var i=this._defaultStyle;return b(this._styles[t])&&b(this._styles[t][e])&&(i=this._styles[t][e]),i}}),ie=_({idRoute:null,rank:null,actions:null,summary:null,polyline:null,wayPoints:null,roadbook:null,initialize:function(t,e,i){var n=["waypoint","start","end"];this.roadbook=e,this.rank=parseInt(t.rank),this.idRoute=parseInt(i);var o=A(t.actions.action);this.actions=new Array;var s=new Array;newGeoLocs=new Array,geocodedLocations=e.geocodedLocations;var r=!1;for(var a in o){var l=new te(o[a],this,r);if(this.actions.push(l),o[a]["highway-enter"]&&(r=!0),o[a]["highway-exit"]&&(r=!1),-1!==g.inArray(l.type,n)){if(b(l.wpNum)){var h=l.wpNum;w(geocodedLocations[h].actions)&&(geocodedLocations[h].actions=[]),geocodedLocations[h].actions[this.idRoute]=l,newGeoLocs.push(geocodedLocations[h])}"waypoint"===l.type&&s.push(l.polylineIndex)}}for(var c in newGeoLocs[0]=geocodedLocations[0],newGeoLocs[geocodedLocations.length-1]=geocodedLocations[geocodedLocations.length-1],e.geocodedLocations=newGeoLocs,this.wayPoints=newGeoLocs,this.summary=new re(t.summary,this),this.polyline=new Wt(t["polyline-definition"],e._styles,s),this.actions){var u=this.polyline.getStyleId(this.actions[c].polylineIndex,"vehicle-mode");!this.isMultiModal()&&w(this.actions[c].mode)&&0!==u&&(this.actions[c].mode=m[u])}},getShapes:function(t,e){return this.polyline.getShapes(t,e)},isMultiModal:function(){return!0===this.roadbook.options.multiModal},getHighwayLength:function(){if(this.summary.lengthOnFreeway)return this.summary.lengthOnFreeway;var t=0;for(var e in kmEnter=-1,this.actions){var i=this.actions[e];!0===i.highwayEnter&&-1===kmEnter&&(kmEnter=i.meter),!0===i.highwayExit&&(t+=i.meter-kmEnter,kmEnter=-1)}return t},toHtmlToPrint:function(t){return this.toHtml(!0,t)},toHtml:function(t,e){var i,n,s='<tr class="{trClass}">            <td class="number">{number}</td>            <td class="details">'+(t?'<img class="panel_print" style="{iconStyle}" src="'+(e||o+"img/roadbook/print").replace(/\/\s*$/,"")+'/{panelClass}.png"/>':'<div class="{panelClass}">')+'</div></td>            <td class="action">{action}</td>            <td class="time">{time}</td>            <td class="km">{km} km</td>        </tr>        {details}',r=[];for(i=0;i<this.actions.length;i+=1){var a=this.actions[i],l=(this.actions[i+1]?this.actions[i+1].from:a.to,a.shields),h=[];for(n=0;n<l.length;n+=1)h.push(l[n].toHtml());var c=a.pois,u=[];for(n=0;n<c.length;n+=1)u.push(C('<tr><td class="km">{meter} km</td><td><div class="panel {poiClass}"></div></td><td>{label}</td></tr>',{meter:c[n].meter/1e3,poiClass:c[n].type,label:c[n].label}));var d="";(h.length>0||u.length>0)&&/^\s*$/.test(h.join(""))&&/^\s*$/.test(u.join(""))&&(d=C('<tr class="details {trClass}">            <td></td>            <td></td>            <td colspan="3" class="shields">                <table>                    <tr>                        <td>{shields}</td>                        <td>{poi}</td>                    </tr>                </table>            </td>        </tr>',{trClass:i%2==0?"out":"in",shields:h.join(""),poi:C('<table class="pois">{pois}</table>',{pois:u.join("")})}));var p,f,m=!0;if("town-enter"===a.type||"town-exit"===a.type||"town-via"===a.type)p=unescape(escape(a.label).replace(new RegExp("("+escape(a.town)+")","gi"),X(a.town.toUpperCase()))),m=!1;else{var g=a.name?a.name:a.nextRoad;p=unescape(escape(a.label).replace(new RegExp("("+escape(g)+")","gi"),'<span class="bold">'+g+"</span>"))}f="connection"!==a.type?t?a.type:"panel "+a.type:"",r.push(C(s,{trClass:i%2==0?"out":"in",number:i+1,panelClass:f,action:p,iconStyle:m?"":"visibility:hidden",details:d,time:H(a.sec),km:a.meter/1e3})),f=""}return'<table class="roadbook">'+r.join("")+"</table>"}}),ne=_({options:null,geocodedLocations:null,routes:null,postKey:null,version:null,defaultRoute:null,_styles:null,initialize:function(t,e,i){b(i)&&(this.options=i),b(e)&&(this.geocodedLocations=e),this.postKey=t.postkey,this.version=t.version,this._styles=new ee,this._styles.addToDictionnary(t["color-dictionary"]),this.routes=new Array;var n=A(t.route);for(var o in n)this.routes.push(new ie(n[o],this,o));var s=this.routes[0];if(this.routes.length>1)for(o=1;o<this.routes.length;o++)s.rank>this.routes[o].rank&&(s=this._routes[o]);this.defaultRoute=s},getDefaultRoute:function(){return this.defaultRoute},getSummaries:function(){new Array;for(var t in this.routes)summaries.push(this.routes[t].summary);return summaries},getAvailableStyleTypes:function(){return this.styles.getAvailableStyleTypes()}}),oe=(_({category:null,country:null,town:null,type:null,meter:null,sec:null,from:null,to:null,name:null,num:null,pois:null,shields:null,initialize:function(t,e,i,n){this.category=e,this.country=i,this.town=n,this.type=t.type,this.meter=t.meter-0,this.sec=t.sec-0,this.from=t.from-0,this.to=t.to-0,this.name=t.name,this.num=t.num,this.pois=[],this.shields=[]}}),_({type:null,name:null,label:null,meter:null,sec:null,len:null,speedLimit:null,pop:null,cost:null,action:null,coordinates:null,codeAlert:null,initialize:function(t,e){this.action=t.action,this.type=t.type,this.name=t.name,this.label=t.label||t.comment,this.meter=parseFloat(t.meter||0),this.sec=parseInt(t.sec||0),this.len=parseInt(t.len||0),this.speedLimit=parseInt(t["speed-limit"]||0),this.pop=parseInt(t.pop||0),this.cost=parseInt(t.cost||0),b(t.x)&&b(t.y)&&(this.coordinates=new q(t.x,t.y)),this.codeAlert=parseInt(t["code-alert"]||-1)}})),se=_({index:null,meter:null,sec:null,lines:null,action:null,initialize:function(t,e){if(this.type=t.type,this.index=parseInt(e.from),this.meter=parseInt(t.meter),this.sec=parseInt(t.sec),this.lines=[],b(t.head)){for(var i,n=A(t.head.num),o=[],s=0;s<n.length;s++)i=n[s],o.push({type:"hat",color:i.color,"font-color":i["font-color"],value:i.value});this.lines.push({dir:o})}var r=A(t.lines.line);for(s=0;s<r.length;s++)this.lines.push(r[s]);this.action=e},toHtml:function(){for(var t=[],e=this.action.isHighway,i=!1,n="",s=0;s<this.lines.length;s+=1){for(var r="",a=g.makeArray(this.lines[s].dir),l=0;l<a.length;l+=1){var h=a[l];if("string"==typeof h)r+='<span class="name">'+h.toUpperCase()+"</span>";else if("hat"===h.type){var c=h.value&&h.value.charAt(0)&&h.value.charAt(0).toLowerCase()||"";t.push('<span class="num-'+c+'">'+h.value+"</span>")}else if("num"===h.type){r+='<span class="num-'+(c=h.value&&h.value.charAt(0)&&h.value.charAt(0).toLowerCase()||"")+'">'+h.value+"</span>"}else"exit"===h.type?(i=!0,r+='<img src="'+o+'img/roadbook/shield/exit_frame.gif"/><span style="position:relative;left:-25px;font-size:11px;top:-3px;">'+h.value+"</span>"):"exitname"===h.type?(i=!0,r+='<span class="exitname">'+h.value+'</span>&nbsp;<img src="'+o+'img/roadbook/shield/exit_arrow.gif"/>'):"picto"===h.type?r+='<img src="'+o+"img/roadbook/shield/picto"+parseInt(h.value,10)+'.gif"/>':"name"===h.type||"other"===h.type||"streetname"===h.type?r+='<span class="'+h.type+'">'+h.value.toUpperCase()+"</span>":"text"===h.type?r+='<span class="name">'+h.value.toUpperCase()+"</span>":"street"===h.type&&(r+='<span class="streetname">'+h.value.toUpperCase()+"</span>");l+1<a.length&&""!==r&&(r+="&nbsp;")}""!==r&&(n+="<li>"+r+"</li>")}return""===n&&t.length&&(g.each(t,function(t,e){n+="<li>"+e+"</li>"}),t=[]),'<div class="shield">'+(t.length?'<div class="hat">'+t.join("&nbsp")+"</div>":"")+(""!==n?"<ul"+(e&&!i?' class="highway"':"")+">"+n+"</ul>":"")+"</div>"}}),re=_({gasConsumption:null,gasName:null,length:null,lengthOnFreeway:0,time:null,vehicle:null,caravan:null,tolls:null,nbCorrespondances:null,correspondances:null,departDateTime:null,fareZone:null,arriveeDateTime:null,trafficGas:null,trafficTime:null,_route:null,initialize:function(t,e){this.initDefaultSummary(t,e),e.isMultiModal()&&this.initRMMSummary(t,e),b(t["urban-bike"])&&(this.urbanBike={length:parseInt(t["urban-bike"].length,10),time:parseInt(t["urban-bike"].time,10)}),this._route=e},initDefaultSummary:function(t,e){this.length=parseInt(t.length,10),this.time=parseInt(t.time,10),this.gasConsumption=parseFloat(t.gas),this.name=t.name,this.date=t.date;var i=e.roadbook,n=i.options;b(n)&&(b(n.vehicle)&&("bike"===i.options.vehicle?this.vehicle=i.options.vehicle:this.vehicle=n.vehicle),b(n.gas)&&(this.gasName=n.gas,this.gasCost=parseFloat(n.gascost,10)),this.caravan="1"===n.caravan),b(t.traffic)&&(this.trafficGas=parseFloat(t.traffic.gas,10),this.trafficTime=parseInt(t.traffic.time,10)),b(t["length-on-freeway"])&&(this.lengthOnFreeway=t["length-on-freeway"]);var o=[];if(b(t.tolls)&&b(t.tolls.toll)){o=A(t.tolls.toll);for(var s=0;s<o.length;s+=1)o[s].amount=parseFloat(o[s].amount)}this.tolls=o},initRMMSummary:function(t){this.nbCorrespondances=parseInt(t.nbCorrespondances,10),this.correspondances=t.correspondances,this.departDateTime=t.departDateTime,this.arriveeDateTime=t.arrDateTime,this.fareZone=t.fareZone,this.nextDeparture=t.nextDeparture||null,this.previousDeparture=t.previousDeparture||null,"bike"!==this.vehicle?this.vehicle="transport":this.vehicle="public_bike",void 0===this.date&&(this.date=t.arrDateTime)},toHtml:function(){var t=this._route.rank>0,e='<div class="summary-wrapper"><div class="';e+=t?"inactive-route":"active-route",e+=' route-bloc-summary">';var i,n,o="";if(void 0===this.name&&(o=" route-header-public-transport"),e+='<div class="route-header'+o+'">',e+=t?"<h3>Itin&eacute;raire alternatif</h3>":"<h3>R&eacute;sum&eacute; de l'itin&eacute;raire</h3>",void 0!==this.name&&(e+='<p class="route-title">En passant par <br /> '+this.name+"</p>"),e+="</div>",e+='<div class="route-summary">',e+="<ul>",e+="<li>",-1===this.date.indexOf(" "))n=(i=this.date.split(":"))[1]+"h"+i[2];else{var s=(i=this.date.split(" "))[1].split(":");n=s[0]+"h"+s[1]}var r=i[0].split("-");e+='<strong class="label">Date :</strong><p>'+(r[2]+"/"+r[1]+"/"+r[0])+" &agrave; "+n+"</p>",e+="</li>";var a=this.trafficTime&&this.trafficTime>this.time?this.trafficTime-this.time:void 0;e+="<li>",e+='<strong class="label">Dur&eacute;e :</strong>',e+="<p><strong>"+H(this.trafficTime?this.trafficTime:this.time)+"</strong>",b(a)&&(e+='<span class="time_delay">(dont '+H(a)+" de retard selon trafic)</span></p>"),e+="</li>",e+='<li class="marg6tb">',isNaN(this.length)||(e+='<strong class="label">Distance :</strong>',e+="<p><strong>"+Y(this.length)+"</strong>"),this.lengthOnFreeway>0&&(e+=" dont "+Y(this.lengthOnFreeway)+" sur voies rapides."),e+="</p>",e+="</li>",e+="<li>",e+='<strong class="label">V&eacute;hicule :</strong><p><strong>'+function(t){switch(t){case"ped":return"Pi&eacute;ton";case"comcar":return"Petite voiture";case"midcar":return"Voiture de taille moyenne";case"sedcar":return"Routi&egrave;re";case"luxcar":return"Grande routi&egrave;re";case"lt3.5":return"Poids Lourd, PTAC &lt; 3.5T";case"lt12":case"gt12":return"Poids Lourd, PTAC &gt; 12T";case"gt12a":return"Poids Lourd, PTAC &gt; 12T, articul&eacute;";case"mot":return"Moto";case"van":return"Van";case"coa":return"Caravane";case"transport":return"Transport en commun";case"bike":return"V&eacute;lo";case"public_bike":return"V&eacute;lo en libre service"}return""}(this.vehicle)+"</strong></p>",e+="</li>";var l,h,c=this.trafficGas?parseFloat(this.trafficGas,10):parseFloat(this.gasConsumption,10),u=c*this.gasCost;if(u>0&&(e+='<li class="gas_label">',e+='<strong class="label">Carburant :</strong>',e+="<strong>"+u.toFixed(2)+" &#8364; ("+Math.round(c)+"L)</strong>",e+="</li>"),this.tolls.length>0){for(var d=[],p=0;p<this.tolls.length;p+=1)h=this.tolls[p],d.push(h.country+" : <strong>"+h.amount+" "+h.currency+"</strong>");l=d.join(", ")}else l="Aucun";if(e+='<li class="tolls_short">',e+='<strong class="label">P&eacute;ages :</strong>',e+="<p>"+l+"</p>",e+="</li>",this.indemnities>0&&(e+='<li class="indemnities">',e+='<strong class="label">Indemnit&eacute;s :</strong>',e+="<p><strong>"+this.indemnities+" &#8364; </strong></p>",e+="</li>"),b(this.urbanBike)){for(var f,m,g=0;g<this._route.actions.length;g++){var v=this._route.actions[g];if(b(v.freeBikes)&&(f=v.freeBikes),b(v.freeBlocks)&&(m=v.freeBlocks),void 0!==f&&void 0!==m)break}e+='<li class="marg6t free_bikes">',e+='<strong class="label">V&eacute;los au d&eacute;part : </strong>',e+="<p><strong>"+f+"</strong></p>",e+="</li>",e+='<li class="free_blocks">',e+='<strong class="label">Points d\'attache libres : </strong>',e+="<p><strong>"+m+"</strong></p>",e+="</li>"}return e+="</ul>",e+="</div>",e+="</div>",e+="</div>"}}),ae=h.route.RouteService=_({initialize:function(){},loadRoute:function(t,e,i,n){var o=new D,s=[],r=this;o.addListener("empty",function(){for(var o=[],a=0;a<t.length;a+=1){if(w(s[a])&&g.isFunction(n))return void n(new Error("One location not found at step "+a+"."));o.push(s[a].getRidInfo())}var l=r._preProcessOptions(e,s);r._sendRequest(o,l,i,n,s)});var a=new ct;o.size=t.length;for(var l=0;l<t.length;l+=1)a.geocode(t[l],this._geocoderSuccessHandler(s,l,o),this._geocoderErrorHandler(o))},_geocoderSuccessHandler:function(t,e,i){return function(n){t[e]=n[0],i.removeTask()}},_geocoderErrorHandler:function(t){return function(){t.removeTask()}},_handleResponse:function(t,e,i,n){if(!t||!t.routes)throw{message:"Mappy.api.route.RouteService._handleResponse",errors:{route:"parse error",roadbook:"parse error"}};if("none"!==A(t.routes.route)[0].stats.error){var o=A(t.routes.route)[0].stats.error;throw{message:"Route : "+o+"; Roadbook : "+o,errors:{route:o,roadbook:o}}}return new ne(t.routes,n,this._getDefaultOptions(e))},_preProcessOptions:function(t,e){if("bike"===t.transport_mode&&5===t.rbver&&(t.multiModal=!0,t.forceItiAlt=!0),"mul"===t.mode){if(t.nbroutes=t.nbroutes||2,!0!==t.forceItiAlt){var i=e[0].Placemark.Point.coordinates,n=e[e.length-1].Placemark.Point.coordinates,o=new q(i[0],i[1]),s=new q(n[0],n[1]),r=o.getDistance(s),a=P(Math.sqrt(Math.pow(r.dx,2)+Math.pow(r.dy,2))/1e3),l=100,h=0;1!==t.infotraffic&&(l=10,h=2),(a<h||l<a)&&(delete t.mode,delete t.nbroutes)}b(t.forceItiAlt)&&delete t.forceItiAlt}return t},_sendRequest:function(t,e,i,n,o){var s,r=this;e.rbver=e.rbver||5,(s=!0===e.multiModal?new it:new nt).configure(t,e);K(s,function(t){var s;try{if(s=r._handleResponse(t,e,n,o),w(s))throw{message:"Mappy.api.route.RouteService._dispatchResponse",errors:{route:"roadbook error",roadbook:"roadbook error"}}}catch(t){if(!g.isFunction(n))throw t;return void n(t)}i(s)},n)},_getDefaultOptions:function(t){return g.extend(!0,{vehicle:"midcar",gas:"petrol",caravan:0},t)}})}();
